OBJECT Table 363 Analysis View
{
  OBJECT-PROPERTIES
  {
    Date=17.08.17;
    Time=10:28:40;
    Modified=Yes;
    Version List=NAVW19.00,NOS-26;
  }
  PROPERTIES
  {
    Permissions=TableData 365=rimd,
                TableData 366=rimd;
    DataCaptionFields=Code,Name;
    OnDelete=VAR
               AnalysisViewFilter@1000 : Record 364;
             BEGIN
               AnalysisViewReset;
               AnalysisViewFilter.SETRANGE("Analysis View Code",Code);
               AnalysisViewFilter.DELETEALL;
             END;

    CaptionML=[ENU=Analysis View;
               RUS=Аналитический отчет];
    LookupPageID=Page556;
  }
  FIELDS
  {
    { 1   ;   ;Code                ;Code10        ;CaptionML=[ENU=Code;
                                                              RUS=Код];
                                                   NotBlank=Yes }
    { 2   ;   ;Name                ;Text50        ;CaptionML=[ENU=Name;
                                                              RUS=Название] }
    { 3   ;   ;Account Source      ;Option        ;OnValidate=BEGIN
                                                                TESTFIELD(Blocked,FALSE);
                                                                IF ("Last Entry No." <> 0) AND ("Account Source" <> xRec."Account Source") THEN
                                                                  ValidateDelete(FIELDCAPTION("Account Source"));
                                                                VerificationForCashFlow;
                                                                AnalysisViewReset;
                                                                "Account Filter" := '';
                                                              END;

                                                   CaptionML=[ENU=Account Source;
                                                              RUS=Источник счета];
                                                   OptionCaptionML=[ENU=G/L Account,Cash Flow Account;
                                                                    RUS=Счет ГК,счет движения денежных средств];
                                                   OptionString=G/L Account,Cash Flow Account }
    { 4   ;   ;Last Entry No.      ;Integer       ;CaptionML=[ENU=Last Entry No.;
                                                              RUS=Номер посл. операции] }
    { 5   ;   ;Last Budget Entry No.;Integer      ;CaptionML=[ENU=Last Budget Entry No.;
                                                              RUS=Номер посл. операции бюджетирования] }
    { 6   ;   ;Last Date Updated   ;Date          ;CaptionML=[ENU=Last Date Updated;
                                                              RUS=Дата посл. обновления] }
    { 7   ;   ;Update on Posting   ;Boolean       ;OnValidate=BEGIN
                                                                VerificationForCashFlow;
                                                              END;

                                                   CaptionML=[ENU=Update on Posting;
                                                              RUS=Обновлять при учете];
                                                   Editable=No }
    { 8   ;   ;Blocked             ;Boolean       ;OnValidate=BEGIN
                                                                IF NOT Blocked AND "Refresh When Unblocked" THEN BEGIN
                                                                  ValidateDelete(FIELDCAPTION(Blocked));
                                                                  AnalysisViewReset;
                                                                  "Refresh When Unblocked" := FALSE;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Blocked;
                                                              RUS=Заблокировано] }
    { 9   ;   ;Account Filter      ;Code250       ;TableRelation=IF (Account Source=CONST(G/L Account)) "G/L Account"
                                                                 ELSE IF (Account Source=CONST(Cash Flow Account)) "Cash Flow Account";
                                                   OnValidate=VAR
                                                                AnalysisViewEntry@1000 : Record 365;
                                                                AnalysisViewBudgetEntry@1001 : Record 366;
                                                                GLAcc@1002 : Record 15;
                                                                CFAccount@1003 : Record 841;
                                                              BEGIN
                                                                TESTFIELD(Blocked,FALSE);
                                                                IF "Account Source" = "Account Source"::"G/L Account" THEN BEGIN
                                                                  IF ("Last Entry No." <> 0) AND (xRec."Account Filter" = '') AND ("Account Filter" <> '')
                                                                  THEN BEGIN
                                                                    ValidateModify(FIELDCAPTION("Account Filter"));
                                                                    GLAcc.SETFILTER("No.","Account Filter");
                                                                    IF GLAcc.FIND('-') THEN
                                                                      REPEAT
                                                                        GLAcc.MARK := TRUE;
                                                                      UNTIL GLAcc.NEXT = 0;
                                                                    GLAcc.SETRANGE("No.");
                                                                    IF GLAcc.FIND('-') THEN
                                                                      REPEAT
                                                                        IF NOT GLAcc.MARK THEN BEGIN
                                                                          AnalysisViewEntry.SETRANGE("Analysis View Code",Code);
                                                                          AnalysisViewEntry.SETRANGE("Account No.",GLAcc."No.");
                                                                          AnalysisViewEntry.DELETEALL;
                                                                          AnalysisViewBudgetEntry.SETRANGE("Analysis View Code",Code);
                                                                          AnalysisViewBudgetEntry.SETRANGE("G/L Account No.",GLAcc."No.");
                                                                          AnalysisViewBudgetEntry.DELETEALL;
                                                                        END;
                                                                      UNTIL GLAcc.NEXT = 0;
                                                                  END;
                                                                  IF ("Last Entry No." <> 0) AND ("Account Filter" <> xRec."Account Filter") AND (xRec."Account Filter" <> '')
                                                                  THEN  BEGIN
                                                                    ValidateDelete(FIELDCAPTION("Account Filter"));
                                                                    AnalysisViewReset;
                                                                  END;
                                                                END ELSE BEGIN
                                                                  IF ("Last Date Updated" <> 0D) AND (xRec."Account Filter" = '') AND ("Account Filter" <> '')
                                                                  THEN BEGIN
                                                                    ValidateModify(FIELDCAPTION("Account Filter"));
                                                                    CFAccount.SETFILTER("No.","Account Filter");
                                                                    IF CFAccount.FIND('-') THEN
                                                                      REPEAT
                                                                        CFAccount.MARK := TRUE;
                                                                      UNTIL CFAccount.NEXT = 0;
                                                                    CFAccount.SETRANGE("No.");
                                                                    IF CFAccount.FIND('-') THEN
                                                                      REPEAT
                                                                        IF NOT CFAccount.MARK THEN BEGIN
                                                                          AnalysisViewEntry.SETRANGE("Analysis View Code",Code);
                                                                          AnalysisViewEntry.SETRANGE("Account No.",CFAccount."No.");
                                                                          AnalysisViewEntry.DELETEALL;
                                                                        END;
                                                                      UNTIL CFAccount.NEXT = 0;
                                                                  END;
                                                                  IF ("Last Date Updated" <> 0D) AND ("Account Filter" <> xRec."Account Filter") AND
                                                                     (xRec."Account Filter" <> '')
                                                                  THEN BEGIN
                                                                    ValidateDelete(FIELDCAPTION("Account Filter"));
                                                                    AnalysisViewReset;
                                                                  END;
                                                                END;
                                                              END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Account Filter;
                                                              RUS=Фильтр по счету] }
    { 10  ;   ;Business Unit Filter;Code250       ;TableRelation="Business Unit";
                                                   OnValidate=VAR
                                                                BusUnit@1000 : Record 220;
                                                                AnalysisViewEntry@1001 : Record 365;
                                                                AnalysisViewBudgetEntry@1002 : Record 366;
                                                                TempBusUnit@1003 : TEMPORARY Record 220;
                                                              BEGIN
                                                                TESTFIELD(Blocked,FALSE);
                                                                IF ("Last Entry No." <> 0) AND (xRec."Business Unit Filter" = '') AND
                                                                   ("Business Unit Filter" <> xRec."Business Unit Filter")
                                                                THEN BEGIN
                                                                  ValidateModify(FIELDCAPTION("Business Unit Filter"));
                                                                  IF BusUnit.FIND('-') THEN
                                                                    REPEAT
                                                                      TempBusUnit := BusUnit;
                                                                      TempBusUnit.INSERT;
                                                                    UNTIL BusUnit.NEXT = 0;
                                                                  TempBusUnit.INIT;
                                                                  TempBusUnit.Code := '';
                                                                  TempBusUnit.INSERT;
                                                                  TempBusUnit.SETFILTER(Code,"Business Unit Filter");
                                                                  TempBusUnit.DELETEALL;
                                                                  TempBusUnit.SETRANGE(Code);
                                                                  IF TempBusUnit.FIND('-') THEN
                                                                    REPEAT
                                                                      AnalysisViewEntry.SETRANGE("Analysis View Code",Code);
                                                                      AnalysisViewEntry.SETRANGE("Business Unit Code",TempBusUnit.Code);
                                                                      AnalysisViewEntry.DELETEALL;
                                                                      AnalysisViewBudgetEntry.SETRANGE("Analysis View Code",Code);
                                                                      AnalysisViewBudgetEntry.SETRANGE("Business Unit Code",TempBusUnit.Code);
                                                                      AnalysisViewBudgetEntry.DELETEALL;
                                                                    UNTIL TempBusUnit.NEXT = 0
                                                                END;
                                                                IF ("Last Entry No." <> 0) AND (xRec."Business Unit Filter" <> '') AND
                                                                   ("Business Unit Filter" <> xRec."Business Unit Filter")
                                                                THEN BEGIN
                                                                  ValidateDelete(FIELDCAPTION("Business Unit Filter"));
                                                                  AnalysisViewReset;
                                                                END;
                                                              END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Business Unit Filter;
                                                              RUS=Фильтр по филиалу] }
    { 11  ;   ;Starting Date       ;Date          ;OnValidate=BEGIN
                                                                TESTFIELD(Blocked,FALSE);
                                                                IF CheckIfLastEntryOrDateIsSet AND ("Starting Date" <> xRec."Starting Date") THEN BEGIN
                                                                  ValidateDelete(FIELDCAPTION("Starting Date"));
                                                                  AnalysisViewReset;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Starting Date;
                                                              RUS=Дата начала] }
    { 12  ;   ;Date Compression    ;Option        ;InitValue=Day;
                                                   OnValidate=BEGIN
                                                                TESTFIELD(Blocked,FALSE);
                                                                IF CheckIfLastEntryOrDateIsSet AND ("Date Compression" <> xRec."Date Compression") THEN BEGIN
                                                                  ValidateDelete(FIELDCAPTION("Date Compression"));
                                                                  AnalysisViewReset;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Date Compression;
                                                              RUS=Сжатие по дате];
                                                   OptionCaptionML=[ENU=None,Day,Week,Month,Quarter,Year,Period;
                                                                    RUS=Нет,День,Неделя,Месяц,Квартал,Год,Период];
                                                   OptionString=None,Day,Week,Month,Quarter,Year,Period }
    { 13  ;   ;Dimension 1 Code    ;Code20        ;TableRelation=Dimension;
                                                   OnValidate=BEGIN
                                                                TESTFIELD(Blocked,FALSE);
                                                                IF Dim.CheckIfDimUsed("Dimension 1 Code",13,'',Code,0) THEN
                                                                  ERROR(Text000,Dim.GetCheckDimErr);
                                                                ModifyDim(FIELDCAPTION("Dimension 1 Code"),"Dimension 1 Code",xRec."Dimension 1 Code");
                                                                MODIFY;
                                                              END;

                                                   CaptionML=[ENU=Dimension 1 Code;
                                                              RUS=Код измерения 1] }
    { 14  ;   ;Dimension 2 Code    ;Code20        ;TableRelation=Dimension;
                                                   OnValidate=BEGIN
                                                                TESTFIELD(Blocked,FALSE);
                                                                IF Dim.CheckIfDimUsed("Dimension 2 Code",14,'',Code,0) THEN
                                                                  ERROR(Text000,Dim.GetCheckDimErr);
                                                                ModifyDim(FIELDCAPTION("Dimension 2 Code"),"Dimension 2 Code",xRec."Dimension 2 Code");
                                                                MODIFY;
                                                              END;

                                                   CaptionML=[ENU=Dimension 2 Code;
                                                              RUS=Код измерения 2] }
    { 15  ;   ;Dimension 3 Code    ;Code20        ;TableRelation=Dimension;
                                                   OnValidate=BEGIN
                                                                TESTFIELD(Blocked,FALSE);
                                                                IF Dim.CheckIfDimUsed("Dimension 3 Code",15,'',Code,0) THEN
                                                                  ERROR(Text000,Dim.GetCheckDimErr);
                                                                ModifyDim(FIELDCAPTION("Dimension 3 Code"),"Dimension 3 Code",xRec."Dimension 3 Code");
                                                                MODIFY;
                                                              END;

                                                   CaptionML=[ENU=Dimension 3 Code;
                                                              RUS=Код измерения 3] }
    { 16  ;   ;Dimension 4 Code    ;Code20        ;TableRelation=Dimension;
                                                   OnValidate=BEGIN
                                                                TESTFIELD(Blocked,FALSE);
                                                                IF Dim.CheckIfDimUsed("Dimension 4 Code",16,'',Code,0) THEN
                                                                  ERROR(Text000,Dim.GetCheckDimErr);
                                                                ModifyDim(FIELDCAPTION("Dimension 4 Code"),"Dimension 4 Code",xRec."Dimension 4 Code");
                                                                MODIFY;
                                                              END;

                                                   CaptionML=[ENU=Dimension 4 Code;
                                                              RUS=Код измерения 4] }
    { 17  ;   ;Include Budgets     ;Boolean       ;OnValidate=BEGIN
                                                                VerificationForCashFlow;

                                                                TESTFIELD(Blocked,FALSE);
                                                                IF ("Last Entry No." <> 0) AND (xRec."Include Budgets" = TRUE) AND ("Include Budgets" = FALSE)
                                                                THEN BEGIN
                                                                  ValidateDelete(FIELDCAPTION("Include Budgets"));
                                                                  AnalysisviewBudgetReset;
                                                                END;
                                                              END;

                                                   AccessByPermission=TableData 95=R;
                                                   CaptionML=[ENU=Include Budgets;
                                                              RUS=Включать бюджеты] }
    { 18  ;   ;Refresh When Unblocked;Boolean     ;CaptionML=[ENU=Refresh When Unblocked;
                                                              RUS=Обновить после разблокировки] }
    { 54001;  ;Use Allocation      ;Boolean       ;OnValidate=BEGIN
                                                                {
                                                                //NC PIF036 > MP
                                                                TESTFIELD(Blocked,FALSE);
                                                                IF ("Last Allocation Entry No." <> 0) AND (xRec."Use Allocation" = TRUE) AND (Rec."Use Allocation" = FALSE)
                                                                THEN BEGIN
                                                                  ValidateDelete(FIELDCAPTION("Use Allocation"));
                                                                  AnalysisViewAllocReset;
                                                                END;
                                                                //NC PIF036 < MP
                                                                }
                                                              END;

                                                   CaptionML=[ENU=Use Allocation;
                                                              RUS=Учитывать Распределения];
                                                   Description=NC PIF001 }
    { 54010;  ;Last Allocation Entry No.;Integer  ;CaptionML=[ENU=Last Allocation Entry No.;
                                                              RUS=Посл. Операция Распределения Но.];
                                                   Description=NC PIF036 }
    { 54020;  ;In Original Currency;Boolean       ;CaptionML=[ENU=In Original Currency;
                                                              RUS=В Оригинальной Валюте] }
    { 54021;  ;Use Special Value for Dim. 1;Boolean;
                                                   CaptionML=[ENU=Use Special Value for Dim. 1;
                                                              RUS=Использовать расчётное значение для Измерения 1];
                                                   Description=NC NCS-1701 USE }
    { 54022;  ;Use Special Value for Dim. 2;Boolean;
                                                   CaptionML=[ENU=Use Special Value for Dim. 2;
                                                              RUS=Использовать расчётное значение для Измерения 2];
                                                   Description=NC NCS-1701 USE }
    { 54023;  ;Use Special Value for Dim. 3;Boolean;
                                                   CaptionML=[ENU=Use Special Value for Dim. 3;
                                                              RUS=Использовать расчётное значение для Измерения 3];
                                                   Description=NC NCS-1701 USE }
    { 54024;  ;Use Special Value for Dim. 4;Boolean;
                                                   CaptionML=[ENU=Use Special Value for Dim. 4;
                                                              RUS=Использовать расчётное значение для Измерения 4];
                                                   Description=NC NCS-1701 USE }
    { 54025;  ;Table Dim. 1        ;Text30        ;OnLookup=BEGIN
                                                              //NC NCS-1701 > USE
                                                              // CLEAR(TempObject);
                                                              // TempObject.SETRANGE(Type,TempObject.Type::Table);
                                                              //
                                                              // IF "Table Dim. 1"<>'' THEN BEGIN
                                                              //  TempObject2.SETRANGE(Type,TempObject.Type::Table);
                                                              //  TempObject2.SETRANGE(Name,"Table Dim. 1");
                                                              //  IF TempObject2.FINDFIRST THEN
                                                              //    IF TempObject.GET(TempObject2.Type,TempObject2."Company Name",TempObject2.ID) THEN;
                                                              // END;
                                                              //
                                                              // IF FORM.RUNMODAL(FORM::Objects,TempObject) = ACTION::LookupOK THEN BEGIN
                                                              //  IF TempObject."Company Name"='' THEN
                                                              //    VALIDATE("Table Dim. 1", TempObject.Name)
                                                              //  ELSE
                                                              //    VALIDATE("Table Dim. 1", TempObject."Company Name"+'$'+TempObject.Name)
                                                              // END;
                                                              //NC NCS-1701 < USE
                                                            END;

                                                   CaptionML=[ENU=Table Name Dim. 1 Special Value;
                                                              RUS=Таблица Расчётного Значения Измерения 1];
                                                   Description=NC NCS-1701 USE }
    { 54026;  ;Table Dim. 2        ;Text30        ;OnLookup=BEGIN
                                                              //NC NCS-1701 > USE
                                                              // CLEAR(TempObject);
                                                              // TempObject.SETRANGE(Type,TempObject.Type::Table);
                                                              //
                                                              // IF "Table Dim. 2"<>'' THEN BEGIN
                                                              //  TempObject2.SETRANGE(Type,TempObject.Type::Table);
                                                              //  TempObject2.SETRANGE(Name,"Table Dim. 2");
                                                              //  IF TempObject2.FINDFIRST THEN
                                                              //    IF TempObject.GET(TempObject2.Type,TempObject2."Company Name",TempObject2.ID) THEN;
                                                              // END;
                                                              //
                                                              // IF FORM.RUNMODAL(FORM::Objects,TempObject) = ACTION::LookupOK THEN BEGIN
                                                              //  IF TempObject."Company Name"='' THEN
                                                              //    VALIDATE("Table Dim. 2", TempObject.Name)
                                                              //  ELSE
                                                              //    VALIDATE("Table Dim. 2", TempObject."Company Name"+'$'+TempObject.Name)
                                                              //
                                                              // END;
                                                              //NC NCS-1701 < USE
                                                            END;

                                                   CaptionML=[ENU=Table Name Dim. 2 Special Value;
                                                              RUS=Таблица Расчётного Значения Измерения 2];
                                                   Description=NC NCS-1701 USE }
    { 54027;  ;Table Dim. 3        ;Text30        ;OnLookup=BEGIN
                                                              //NC NCS-1701 > USE
                                                              // CLEAR(TempObject);
                                                              // TempObject.SETRANGE(Type,TempObject.Type::Table);
                                                              //
                                                              // IF "Table Dim. 3"<>'' THEN BEGIN
                                                              //  TempObject2.SETRANGE(Type,TempObject.Type::Table);
                                                              //  TempObject2.SETRANGE(Name,"Table Dim. 3");
                                                              //  IF TempObject2.FINDFIRST THEN
                                                              //    IF TempObject.GET(TempObject2.Type,TempObject2."Company Name",TempObject2.ID) THEN;
                                                              // END;
                                                              //
                                                              // IF FORM.RUNMODAL(FORM::Objects,TempObject) = ACTION::LookupOK THEN BEGIN
                                                              //  IF TempObject."Company Name"='' THEN
                                                              //    VALIDATE("Table Dim. 3", TempObject.Name)
                                                              //  ELSE
                                                              //    VALIDATE("Table Dim. 3", TempObject."Company Name"+'$'+TempObject.Name)
                                                              //
                                                              // END;
                                                              //NC NCS-1701 < USE
                                                            END;

                                                   CaptionML=[ENU=Table Name Dim. 3 Special Value;
                                                              RUS=Таблица Расчётного Значения Измерения 3];
                                                   Description=NC NCS-1701 USE }
    { 54028;  ;Table Dim. 4        ;Text30        ;OnLookup=BEGIN
                                                              //NC NCS-1701 > USE
                                                              // CLEAR(TempObject);
                                                              // TempObject.SETRANGE(Type,TempObject.Type::Table);
                                                              //
                                                              // IF "Table Dim. 4"<>'' THEN BEGIN
                                                              //  TempObject2.SETRANGE(Type,TempObject.Type::Table);
                                                              //  TempObject2.SETRANGE(Name,"Table Dim. 4");
                                                              //  IF TempObject2.FINDFIRST THEN
                                                              //    IF TempObject.GET(TempObject2.Type,TempObject2."Company Name",TempObject2.ID) THEN;
                                                              // END;
                                                              //
                                                              // IF FORM.RUNMODAL(FORM::Objects,TempObject) = ACTION::LookupOK THEN BEGIN
                                                              //  IF TempObject."Company Name"='' THEN
                                                              //    VALIDATE("Table Dim. 4", TempObject.Name)
                                                              //  ELSE
                                                              //    VALIDATE("Table Dim. 4", TempObject."Company Name"+'$'+TempObject.Name)
                                                              //
                                                              // END;
                                                              //NC NCS-1701 < USE
                                                            END;

                                                   CaptionML=[ENU=Table Name Dim. 4 Special Value;
                                                              RUS=Таблица Расчётного Значения Измерения 4];
                                                   Description=NC NCS-1701 USE }
    { 54100;  ;Field Dim. 1        ;Text30        ;OnLookup=BEGIN
                                                              //NC NCS-1701 > USE
                                                              // CLEAR(TempField);
                                                              // TempField.SETRANGE(TableName,"Table Dim. 1");
                                                              //
                                                              // IF "Field Dim. 1"<>'' THEN BEGIN
                                                              //  TempField2.SETRANGE(TableName,"Table Dim. 1");
                                                              //  TempField2.SETRANGE(FieldName,"Field Dim. 1");
                                                              //  IF TempField2.FINDFIRST THEN
                                                              //    IF TempField.GET(TempField2.TableNo,TempField2."No.") THEN ;
                                                              // END;
                                                              //
                                                              // IF FORM.RUNMODAL(FORM::"Field List",TempField) = ACTION::LookupOK THEN BEGIN
                                                              //  VALIDATE("Field Dim. 1", TempField.FieldName);
                                                              // END;
                                                              //NC NCS-1701 < USE
                                                            END;

                                                   CaptionML=[ENU=Field Name Special Dim. 1 Value;
                                                              RUS=Поле Расчётного Значения Измерения 1];
                                                   NotBlank=Yes;
                                                   Description=NC NCS-1701 USE }
    { 54101;  ;Field Dim. 2        ;Text30        ;OnLookup=BEGIN
                                                              //NC NCS-1701 > USE
                                                              // CLEAR(TempField);
                                                              //
                                                              // TempField.SETRANGE(TableName,"Table Dim. 2");
                                                              //
                                                              // IF "Field Dim. 2"<>'' THEN BEGIN
                                                              //  TempField2.SETRANGE(TableName,"Table Dim. 2");
                                                              //  TempField2.SETRANGE(FieldName,"Field Dim. 2");
                                                              //  IF TempField2.FINDFIRST THEN
                                                              //    IF TempField.GET(TempField2.TableNo,TempField2."No.") THEN ;
                                                              // END;
                                                              //
                                                              // IF FORM.RUNMODAL(FORM::"Field List",TempField) = ACTION::LookupOK THEN BEGIN
                                                              //  VALIDATE("Field Dim. 2", TempField.FieldName);
                                                              // END;
                                                              //NC NCS-1701 < USE
                                                            END;

                                                   CaptionML=[ENU=Field Name Special Dim. 2 Value;
                                                              RUS=Поле Расчётного Значения Измерения 2];
                                                   NotBlank=Yes;
                                                   Description=NC NCS-1701 USE }
    { 54102;  ;Field Dim. 3        ;Text30        ;OnLookup=BEGIN
                                                              //NC NCS-1701 > USE
                                                              // CLEAR(TempField);
                                                              // TempField.SETRANGE(TableName,"Table Dim. 1");
                                                              //
                                                              // IF "Field Dim. 3"<>'' THEN BEGIN
                                                              //  TempField2.SETRANGE(TableName,"Table Dim. 3");
                                                              //  TempField2.SETRANGE(FieldName,"Field Dim. 3");
                                                              //  IF TempField2.FINDFIRST THEN
                                                              //    IF TempField.GET(TempField2.TableNo,TempField2."No.") THEN ;
                                                              // END;
                                                              //
                                                              // IF FORM.RUNMODAL(FORM::"Field List",TempField) = ACTION::LookupOK THEN BEGIN
                                                              //  VALIDATE("Field Dim. 3", TempField.FieldName);
                                                              // END;
                                                              //NC NCS-1701 < USE
                                                            END;

                                                   CaptionML=[ENU=Field Name Special Dim. 3 Value;
                                                              RUS=Поле Расчётного Значения Измерения 3];
                                                   NotBlank=Yes;
                                                   Description=NC NCS-1701 USE }
    { 54103;  ;Field Dim. 4        ;Text30        ;OnLookup=BEGIN
                                                              //NC NCS-1701 > USE
                                                              // CLEAR(TempField);
                                                              // TempField.SETRANGE(TableName,"Table Dim. 4");
                                                              //
                                                              // IF "Field Dim. 4"<>'' THEN BEGIN
                                                              //  TempField2.SETRANGE(TableName,"Table Dim. 4");
                                                              //  TempField2.SETRANGE(FieldName,"Field Dim. 4");
                                                              //  IF TempField2.FINDFIRST THEN
                                                              //    IF TempField.GET(TempField2.TableNo,TempField2."No.") THEN ;
                                                              // END;
                                                              //
                                                              // IF FORM.RUNMODAL(FORM::"Field List",TempField) = ACTION::LookupOK THEN BEGIN
                                                              //  VALIDATE("Field Dim. 4", TempField.FieldName);
                                                              // END;
                                                              //NC NCS-1701 < USE
                                                            END;

                                                   CaptionML=[ENU=Field Name Special Dim. 4 Value;
                                                              RUS=Поле Расчётного Значения Измерения 4];
                                                   NotBlank=Yes;
                                                   Description=NC NCS-1701 USE }
  }
  KEYS
  {
    {    ;Code                                    ;Clustered=Yes }
    {    ;Account Source                           }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      Text000@1000 : TextConst 'ENU=%1\You cannot use the same dimension twice in the same analysis view.;RUS=%1\Нельзя дважды использовать одно измерение в одном аналитическом отчете.';
      Text001@1001 : TextConst 'ENU=The dimension %1 is used in the analysis view %2 %3.;RUS=Измерение %1 используется в аналитическом отчете %2 %3.';
      Text002@1002 : TextConst 'ENU=" You must therefore retain the dimension to keep consistency between the analysis view and the G/L entries.";RUS=" Поэтому необходимо сохранить измерение для поддержки соответствия между аналитическим отчетом и операциями ГК."';
      Text004@1004 : TextConst 'ENU=All analysis views must be updated with the latest G/L entries and G/L budget entries.;RUS=Все аналитические отчеты необходимо обновить по последним финансовым и операциям бюджета ГК.';
      Text005@1005 : TextConst 'ENU=" Both blocked and unblocked analysis views must be updated.";RUS=" Как заблокированные, так и не заблокированные аналитические отчеты должны быть обновлены."';
      Text007@1007 : TextConst 'ENU=" Note, you must remove the checkmark in the blocked field before updating the blocked analysis views.\";RUS=" Обратите внимание, необходимо удалить блокировку перед обновлением аналитических отчетов.\"';
      Text008@1008 : TextConst 'ENU=Currently, %1 analysis views are not updated.;RUS=На данный момент не обновлено аналитических отчетов %1.';
      Text009@1009 : TextConst 'ENU=" Do you wish to update these analysis views?";RUS=" Обновить эти аналитические отчеты?"';
      Text010@1010 : TextConst 'ENU=All analysis views must be updated with the latest G/L entries.;RUS=Все аналитические отчеты необходимо обновить по последним операциям ГК.';
      Text011@1011 : TextConst 'ENU=If you change the contents of the %1 field, the analysis view entries will be deleted.;RUS=Если изменить содержимое поля %1, операции аналитического отчета будут удалены.';
      Text012@1012 : TextConst 'ENU=\You will have to update again.\\Do you want to enter a new value in the %1 field?;RUS=\Потребуется повторное обновление.\\Ввести новое значение в поле %1?';
      Text013@1013 : TextConst 'ENU=The update has been interrupted in response to the warning.;RUS=Обновление прервано из-за предупреждения.';
      Text014@1014 : TextConst 'ENU=If you change the contents of the %1 field, the analysis view entries will be changed as well.\\;RUS=Если изменить содержимое поля %1, операции аналитического отчета также будут изменены.\\';
      Text015@1015 : TextConst 'ENU=Do you want to enter a new value in the %1 field?;RUS=Ввести новое значение в поле %1?';
      AnalysisViewEntry@1016 : Record 365;
      NewAnalysisViewEntry@1017 : Record 365;
      AnalysisViewBudgetEntry@1018 : Record 366;
      NewAnalysisViewBudgetEntry@1019 : Record 366;
      Dim@1020 : Record 348;
      Text016@1003 : TextConst 'ENU=%1 is not applicable for source type %2.;RUS=%1 недопустим для исходного типа %2.';
      Text017@1006 : TextConst 'ENU=When you enable %1, you need to update the analysis view. Do you want to update the analysis view now?;RUS=При включении %1 необходимо обновить просмотр аналитики. Обновить просмотр аналитики?';

    LOCAL PROCEDURE ModifyDim@2(DimFieldName@1000 : Text[100];DimValue@1001 : Code[20];xDimValue@1002 : Code[20]);
    BEGIN
      IF CheckIfLastEntryOrDateIsSet AND (DimValue <> xDimValue) THEN BEGIN
        IF DimValue <> '' THEN BEGIN
          ValidateDelete(DimFieldName);
          AnalysisViewReset;
        END;
        IF DimValue = '' THEN BEGIN
          ValidateModify(DimFieldName);
          CASE DimFieldName OF
            FIELDCAPTION("Dimension 1 Code"):
              BEGIN
                AnalysisViewEntry.SETFILTER("Dimension 1 Value Code",'<>%1','');
                IF "Account Source" = "Account Source"::"G/L Account" THEN
                  AnalysisViewBudgetEntry.SETFILTER("Dimension 1 Value Code",'<>%1','');
              END;
            FIELDCAPTION("Dimension 2 Code"):
              BEGIN
                AnalysisViewEntry.SETFILTER("Dimension 2 Value Code",'<>%1','');
                IF "Account Source" = "Account Source"::"G/L Account" THEN
                  AnalysisViewBudgetEntry.SETFILTER("Dimension 2 Value Code",'<>%1','');
              END;
            FIELDCAPTION("Dimension 3 Code"):
              BEGIN
                AnalysisViewEntry.SETFILTER("Dimension 3 Value Code",'<>%1','');
                IF "Account Source" = "Account Source"::"G/L Account" THEN
                  AnalysisViewBudgetEntry.SETFILTER("Dimension 3 Value Code",'<>%1','');
              END;
            FIELDCAPTION("Dimension 4 Code"):
              BEGIN
                AnalysisViewEntry.SETFILTER("Dimension 4 Value Code",'<>%1','');
                IF "Account Source" = "Account Source"::"G/L Account" THEN
                  AnalysisViewBudgetEntry.SETFILTER("Dimension 4 Value Code",'<>%1','');
              END;
          END;
          AnalysisViewEntry.SETRANGE("Analysis View Code",Code);
          IF "Account Source" = "Account Source"::"G/L Account" THEN
            AnalysisViewBudgetEntry.SETRANGE("Analysis View Code",Code);
          IF AnalysisViewEntry.FIND('-') THEN
            REPEAT
              AnalysisViewEntry.DELETE;
              NewAnalysisViewEntry := AnalysisViewEntry;
              CASE DimFieldName OF
                FIELDCAPTION("Dimension 1 Code"):
                  NewAnalysisViewEntry."Dimension 1 Value Code" := '';
                FIELDCAPTION("Dimension 2 Code"):
                  NewAnalysisViewEntry."Dimension 2 Value Code" := '';
                FIELDCAPTION("Dimension 3 Code"):
                  NewAnalysisViewEntry."Dimension 3 Value Code" := '';
                FIELDCAPTION("Dimension 4 Code"):
                  NewAnalysisViewEntry."Dimension 4 Value Code" := '';
              END;
              InsertAnalysisViewEntry;
            UNTIL AnalysisViewEntry.NEXT = 0;
          IF "Account Source" = "Account Source"::"G/L Account" THEN
            IF AnalysisViewBudgetEntry.FIND('-') THEN
              REPEAT
                AnalysisViewBudgetEntry.DELETE;
                NewAnalysisViewBudgetEntry := AnalysisViewBudgetEntry;
                CASE DimFieldName OF
                  FIELDCAPTION("Dimension 1 Code"):
                    NewAnalysisViewBudgetEntry."Dimension 1 Value Code" := '';
                  FIELDCAPTION("Dimension 2 Code"):
                    NewAnalysisViewBudgetEntry."Dimension 2 Value Code" := '';
                  FIELDCAPTION("Dimension 3 Code"):
                    NewAnalysisViewBudgetEntry."Dimension 3 Value Code" := '';
                  FIELDCAPTION("Dimension 4 Code"):
                    NewAnalysisViewBudgetEntry."Dimension 4 Value Code" := '';
                END;
                InsertAnalysisViewBudgetEntry;
              UNTIL AnalysisViewBudgetEntry.NEXT = 0;
        END;
      END;
    END;

    LOCAL PROCEDURE InsertAnalysisViewEntry@1();
    BEGIN
      IF NOT NewAnalysisViewEntry.INSERT THEN BEGIN
        NewAnalysisViewEntry.FIND;
        NewAnalysisViewEntry.Amount := NewAnalysisViewEntry.Amount + AnalysisViewEntry.Amount;
        IF "Account Source" = "Account Source"::"G/L Account" THEN BEGIN
          NewAnalysisViewEntry."Debit Amount" :=
            NewAnalysisViewEntry."Debit Amount" + AnalysisViewEntry."Debit Amount";
          NewAnalysisViewEntry."Credit Amount" :=
            NewAnalysisViewEntry."Credit Amount" + AnalysisViewEntry."Credit Amount";
          NewAnalysisViewEntry."Add.-Curr. Debit Amount" :=
            NewAnalysisViewEntry."Add.-Curr. Debit Amount" + AnalysisViewEntry."Add.-Curr. Debit Amount";
          NewAnalysisViewEntry."Add.-Curr. Credit Amount" :=
            NewAnalysisViewEntry."Add.-Curr. Credit Amount" + AnalysisViewEntry."Add.-Curr. Credit Amount";
        END;
        NewAnalysisViewEntry.MODIFY;
      END;
    END;

    LOCAL PROCEDURE InsertAnalysisViewBudgetEntry@6();
    BEGIN
      IF NOT NewAnalysisViewBudgetEntry.INSERT THEN BEGIN
        NewAnalysisViewBudgetEntry.FIND;
        NewAnalysisViewBudgetEntry.Amount := NewAnalysisViewBudgetEntry.Amount + AnalysisViewBudgetEntry.Amount;
        NewAnalysisViewBudgetEntry.MODIFY;
      END;
    END;

    PROCEDURE AnalysisViewReset@5();
    VAR
      AnalysisViewEntry@1000 : Record 365;
    BEGIN
      AnalysisViewEntry.SETRANGE("Analysis View Code",Code);
      AnalysisViewEntry.DELETEALL;
      "Last Entry No." := 0;
      "Last Date Updated" := 0D;
      AnalysisviewBudgetReset;
    END;

    PROCEDURE CheckDimensionsAreRetained@3(ObjectType@1000 : Integer;ObjectID@1001 : Integer;OnlyIfIncludeBudgets@1002 : Boolean);
    BEGIN
      RESET;
      IF OnlyIfIncludeBudgets THEN
        SETRANGE("Include Budgets",TRUE);
      IF FIND('-') THEN
        REPEAT
          CheckDimIsRetained(ObjectType,ObjectID,"Dimension 1 Code",Code,Name);
          CheckDimIsRetained(ObjectType,ObjectID,"Dimension 2 Code",Code,Name);
          CheckDimIsRetained(ObjectType,ObjectID,"Dimension 3 Code",Code,Name);
          CheckDimIsRetained(ObjectType,ObjectID,"Dimension 4 Code",Code,Name);
        UNTIL NEXT = 0;
    END;

    LOCAL PROCEDURE CheckDimIsRetained@8(ObjectType@1000 : Integer;ObjectID@1001 : Integer;DimCode@1002 : Code[20];AnalysisViewCode@1003 : Code[10];AnalysisViewName@1004 : Text[50]);
    VAR
      SelectedDim@1005 : Record 369;
    BEGIN
      IF DimCode <> '' THEN
        IF NOT SelectedDim.GET(USERID,ObjectType,ObjectID,'',DimCode) THEN
          ERROR(
            Text001 +
            Text002,
            DimCode,AnalysisViewCode,AnalysisViewName);
    END;

    PROCEDURE CheckViewsAreUpdated@4();
    VAR
      GLEntry@1000 : Record 17;
      CFForecastEntry@1005 : Record 847;
      GLBudgetEntry@1001 : Record 96;
      UpdateAnalysisView@1002 : Codeunit 410;
      NoNotUpdated@1003 : Integer;
      RunCheck@1004 : Boolean;
    BEGIN
      IF "Account Source" = "Account Source"::"G/L Account" THEN
        RunCheck := GLEntry.FINDLAST OR GLBudgetEntry.FINDLAST
      ELSE
        RunCheck := CFForecastEntry.FINDLAST;

      IF RunCheck THEN BEGIN
        NoNotUpdated := 0;
        RESET;
        IF FIND('-') THEN
          REPEAT
            IF ("Account Source" = "Account Source"::"Cash Flow Account") OR
               (("Last Entry No." < GLEntry."Entry No.") OR
                "Include Budgets" AND ("Last Budget Entry No." < GLBudgetEntry."Entry No."))
            THEN
              NoNotUpdated := NoNotUpdated + 1;
          UNTIL NEXT = 0;
        IF NoNotUpdated > 0 THEN
          IF CONFIRM(
               Text004 +
               Text005 +
               Text007 +
               Text008 +
               Text009,TRUE,NoNotUpdated)
          THEN BEGIN
            IF FIND('-') THEN
              REPEAT
                IF Blocked THEN BEGIN
                  "Refresh When Unblocked" := TRUE;
                  "Last Budget Entry No." := 0;
                  MODIFY;
                END ELSE
                  UpdateAnalysisView.Update(Rec,2,TRUE);
              UNTIL NEXT = 0;
          END ELSE
            ERROR(Text010);
      END;
    END;

    PROCEDURE UpdateLastEntryNo@7();
    VAR
      GLEntry@1000 : Record 17;
    BEGIN
      IF GLEntry.FINDLAST THEN BEGIN
        SETRANGE(Blocked,FALSE);
        IF FIND('-') THEN
          REPEAT
            "Last Entry No." := GLEntry."Entry No.";
            MODIFY;
          UNTIL NEXT = 0;
        SETRANGE(Blocked);
      END;
    END;

    PROCEDURE ValidateDelete@10(FieldName@1000 : Text);
    VAR
      Question@1001 : Text;
    BEGIN
      Question := STRSUBSTNO(
          Text011 +
          Text012,FieldName);
      IF NOT DIALOG.CONFIRM(Question,TRUE) THEN
        ERROR(Text013);
    END;

    PROCEDURE AnalysisviewBudgetReset@9();
    VAR
      AnalysisViewBudgetEntry@1000 : Record 366;
    BEGIN
      AnalysisViewBudgetEntry.SETRANGE("Analysis View Code",Code);
      AnalysisViewBudgetEntry.DELETEALL;
      "Last Budget Entry No." := 0;
    END;

    LOCAL PROCEDURE ValidateModify@11(FieldName@1000 : Text);
    VAR
      Question@1001 : Text;
    BEGIN
      Question := STRSUBSTNO(
          Text014 +
          Text015,FieldName);
      IF NOT DIALOG.CONFIRM(Question,TRUE) THEN
        ERROR(Text013);
    END;

    PROCEDURE CopyAnalysisViewFilters@12(ObjectType@1000 : Integer;ObjectID@1001 : Integer;AnalysisViewCode@1002 : Code[10]);
    VAR
      SelectedDim@1003 : Record 369;
      GLAcc@1004 : Record 15;
      CFAcc@1007 : Record 841;
      BusUnit@1005 : Record 220;
      DimensionCode@1006 : Text[30];
    BEGIN
      IF GET(AnalysisViewCode) THEN BEGIN
        IF "Account Filter" <> '' THEN BEGIN
          IF "Account Source" = "Account Source"::"G/L Account" THEN
            DimensionCode := GLAcc.TABLECAPTION
          ELSE
            DimensionCode := CFAcc.TABLECAPTION;

          IF SelectedDim.GET(
               USERID,ObjectType,ObjectID,AnalysisViewCode,DimensionCode)
          THEN BEGIN
            IF SelectedDim."Dimension Value Filter" = '' THEN BEGIN
              SelectedDim."Dimension Value Filter" := "Account Filter";
              SelectedDim.MODIFY;
            END;
          END ELSE BEGIN
            SelectedDim.INIT;
            SelectedDim."User ID" := USERID;
            SelectedDim."Object Type" := ObjectType;
            SelectedDim."Object ID" := ObjectID;
            SelectedDim."Analysis View Code" := AnalysisViewCode;
            SelectedDim."Dimension Code" := DimensionCode;
            SelectedDim."Dimension Value Filter" := "Account Filter";
            SelectedDim.INSERT;
          END;
        END;
        IF "Business Unit Filter" <> '' THEN
          IF SelectedDim.GET(
               USERID,ObjectType,ObjectID,AnalysisViewCode,BusUnit.TABLECAPTION)
          THEN BEGIN
            IF SelectedDim."Dimension Value Filter" = '' THEN BEGIN
              SelectedDim."Dimension Value Filter" := "Business Unit Filter";
              SelectedDim.MODIFY;
            END;
          END ELSE BEGIN
            SelectedDim.INIT;
            SelectedDim."User ID" := USERID;
            SelectedDim."Object Type" := ObjectType;
            SelectedDim."Object ID" := ObjectID;
            SelectedDim."Analysis View Code" := AnalysisViewCode;
            SelectedDim."Dimension Code" := BusUnit.TABLECAPTION;
            SelectedDim."Dimension Value Filter" := "Business Unit Filter";
            SelectedDim.INSERT;
          END;
      END;
    END;

    LOCAL PROCEDURE VerificationForCashFlow@15();
    BEGIN
      IF "Account Source" <> "Account Source"::"Cash Flow Account" THEN
        EXIT;

      IF "Include Budgets" THEN
        ERROR(Text016,FIELDCAPTION("Include Budgets"),"Account Source");

      IF "Update on Posting" THEN
        ERROR(Text016,FIELDCAPTION("Update on Posting"),"Account Source");
    END;

    LOCAL PROCEDURE CheckIfLastEntryOrDateIsSet@14() : Boolean;
    BEGIN
      IF "Account Source" = "Account Source"::"G/L Account" THEN
        EXIT("Last Entry No." <> 0);

      EXIT("Last Date Updated" <> 0D);
    END;

    PROCEDURE SetUpdateOnPosting@13(NewUpdateOnPosting@1000 : Boolean);
    BEGIN
      IF "Update on Posting" = NewUpdateOnPosting THEN
        EXIT;

      IF NOT "Update on Posting" AND NewUpdateOnPosting THEN
        IF NOT CONFIRM(STRSUBSTNO(Text017,FIELDCAPTION("Update on Posting")),FALSE) THEN
          EXIT;

      "Update on Posting" := NewUpdateOnPosting;
      IF "Update on Posting" THEN BEGIN
        MODIFY;
        CODEUNIT.RUN(CODEUNIT::"Update Analysis View",Rec);
        FIND;
      END;
    END;

    BEGIN
    END.
  }
}

