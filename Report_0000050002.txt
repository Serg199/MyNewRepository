OBJECT Report 50002 Consolidate Excel
{
  OBJECT-PROPERTIES
  {
    Date=27.03.17;
    Time=14:17:59;
    Modified=Yes;
    Version List=;
  }
  PROPERTIES
  {
    CaptionML=[ENU=Consolidate Excel;
               RUS=á†£‡„ß®‚Ï Excel];
    ProcessingOnly=Yes;
  }
  DATASET
  {
  }
  REQUESTPAGE
  {
    PROPERTIES
    {
    }
    CONTROLS
    {
    }
  }
  LABELS
  {
  }
  CODE
  {
    VAR
      TmpïlBuffer@1210001 : TEMPORARY Record 370;
      ConsDateImportSetup@1210006 : Record 50015;
      PreBuffer@1210005 : Record 50007;
      ConsBuffer@1210116 : Record 50008;
      current_row@1210000 : Integer;
      ConsSource@1210002 : Code[20];
      ConsSourceFile@1210003 : Text[150];
      ConsSourceSheet@1210004 : Text[50];
      ConsSourceCode@1210009 : Code[20];
      IsError@1210008 : Boolean;
      EntryNo@1210007 : Integer;
      ExportConsSource1@1210109 : Code[20];
      ImportBufferMgt@1210108 : Codeunit 50003;
      EntryFrom@1210107 : Integer;
      EntryTo@1210106 : Integer;
      ConsolidationSource@1210105 : Record 50001;
      RegisterNo@1210104 : Integer;
      "------------ -----------------"@1210103 : Integer;
      H1_StructureUnit@1210102 : Text[20];
      H2_ImportDate@1210101 : Date;
      H3_ImportTime@1210100 : Time;
      H4_StartDate@1210099 : Date;
      H5_EndDate@1210098 : Date;
      "------------------------------"@1210097 : Integer;
      D6_OperationNo@1210096 : Integer;
      D7_DocumentType@1210095 : Text[30];
      D8_DocumentNo@1210094 : Code[20];
      D9_DocumentDate@1210093 : Date;
      D10_DebetAccNo@1210092 : Code[20];
      D11_CreditAccNo@1210091 : Code[20];
      D12_Basis@1210090 : Text[50];
      D13_DebetCurrencyCode@1210089 : Code[10];
      D13_CreditCurrencyCode@1210088 : Code[10];
      D14_AmountRUR@1210087 : Decimal;
      D15_DebetOriginalAmount@1210086 : Decimal;
      D15_CreditOriginalAmount@1210085 : Decimal;
      DebitIntContragent@1210084 : Integer;
      CreditIntContragent@1210083 : Integer;
      D17_UsefulPeriod@1210082 : Decimal;
      D18_FAClassCode@1210081 : Text[50];
      D19_Quantity@1210080 : Integer;
      D20_DebitDim1_Value@1210079 : Code[20];
      D21_DebitDim1_ValueName@1210078 : Text[50];
      D22_DebitDim2_Value@1210077 : Code[20];
      D23_DebitDim2_ValueName@1210076 : Text[50];
      D24_DebitDim3_Value@1210075 : Code[20];
      D25_DebitDim3_ValueName@1210074 : Text[50];
      D26_DebitDim4_Value@1210073 : Code[20];
      D27_DebitDim4_ValueName@1210072 : Text[50];
      D28_DebitDim5_Value@1210071 : Code[20];
      D29_DebitDim5_ValueName@1210070 : Text[50];
      D30_DebitDim6_Value@1210069 : Code[20];
      D31_DebitDim6_ValueName@1210068 : Text[50];
      D32_DebitDim7_Value@1210067 : Code[20];
      D33_DebitDim7_ValueName@1210066 : Text[50];
      D34_DebitDim8_Value@1210065 : Code[20];
      D35_DebitDim8_ValueName@1210064 : Text[50];
      D36_DebitDim9_Value@1210063 : Code[20];
      D37_DebitDim9_ValueName@1210062 : Text[50];
      D38_DebitDim10_Value@1210061 : Code[20];
      D39_DebitDim10_ValueName@1210060 : Text[50];
      D40_DebitDim11_Value@1210059 : Code[20];
      D41_DebitDim11_ValueName@1210058 : Text[50];
      DebitDim12_Value@1210057 : Code[20];
      DebitDim12_ValueName@1210056 : Text[50];
      DebitDim13_Value@1210055 : Code[20];
      DebitDim13_ValueName@1210054 : Text[50];
      DebitDim14_Value@1210053 : Code[20];
      DebitDim14_ValueName@1210052 : Text[50];
      DebitDim15_Value@1210051 : Code[20];
      DebitDim15_ValueName@1210050 : Text[50];
      DebitDim16_Value@1210049 : Code[20];
      DebitDim16_ValueName@1210048 : Text[50];
      D42_CreditDim1_Value@1210047 : Code[20];
      D43_CreditDim1_ValueName@1210046 : Text[50];
      D44_CreditDim2_Value@1210045 : Code[20];
      D45_CreditDim2_ValueName@1210044 : Text[50];
      D46_CreditDim3_Value@1210043 : Code[20];
      D47_CreditDim3_ValueName@1210042 : Text[50];
      D48_CreditDim4_Value@1210041 : Code[20];
      D49_CreditDim4_ValueName@1210040 : Text[50];
      D50_CreditDim5_Value@1210039 : Code[20];
      D51_CreditDim5_ValueName@1210038 : Text[50];
      D52_CreditDim6_Value@1210037 : Code[20];
      D53_CreditDim6_ValueName@1210036 : Text[50];
      D54_CreditDim7_Value@1210035 : Code[20];
      D55_CreditDim7_ValueName@1210034 : Text[50];
      D56_CreditDim8_Value@1210033 : Code[20];
      D57_CreditDim8_ValueName@1210032 : Text[50];
      D58_CreditDim9_Value@1210031 : Code[20];
      D59_CreditDim9_ValueName@1210030 : Text[50];
      D60_CreditDim10_Value@1210029 : Code[20];
      D61_CreditDim10_ValueName@1210028 : Text[50];
      D62_CreditDim11_Value@1210027 : Code[20];
      D63_CreditDim11_ValueName@1210026 : Text[50];
      CreditDim12_Value@1210025 : Code[20];
      CreditDim12_ValueName@1210024 : Text[50];
      CreditDim13_Value@1210023 : Code[20];
      CreditDim13_ValueName@1210022 : Text[50];
      CreditDim14_Value@1210021 : Code[20];
      CreditDim14_ValueName@1210020 : Text[50];
      CreditDim15_Value@1210019 : Code[20];
      CreditDim15_ValueName@1210018 : Text[50];
      CreditDim16_Value@1210017 : Code[20];
      CreditDim16_ValueName@1210016 : Text[50];
      OrigDocumentDate@1210120 : Date;
      "------ --------- ---------"@1210015 : Integer;
      Indicator@1210014 : Dialog;
      j@1210013 : Integer;
      ConsolidationSetup@1210012 : Record 50000;
      TravelExpenses@1210010 : Boolean;
      Text00001@1210114 : TextConst 'RUS="ç• ß†ØÆ´•≠≠Æ Æ°Ôß†‚•´Ï≠Æ• ØÆ´• ¢ ß†£Æ´Æ¢™• ‰†©´†! "';
      Text00002@1210113 : TextConst 'RUS=á†£‡„ß™† ®ß ‰†©´† „·Ø•Ë≠Æ ¢ÎØÆ´≠•≠†!';
      Text00003@1210112 : TextConst 'RUS=Ñ´Ô ·‚‡„™‚„‡≠Æ£Æ ØÆ§‡†ß§•´•≠®Ô %1 ÆØ‡•§•´•≠Æ °Æ´ÏË• 1 ®·‚ÆÁ≠®™† ™Æ≠·Æ´®§†Ê®®';
      Text00004@1210111 : TextConst 'RUS=Ñ´Ô ·‚‡„™‚„‡≠Æ£Æ ØÆ§‡†ß§•´•≠®Ô %1 ≠• ÆØ‡•§•´•≠ ®·‚ÆÁ≠®™ ™Æ≠·Æ´®§†Ê®®';
      Text00005@1210110 : TextConst 'RUS=í‡•°„•‚·Ô ‰†©´ §´Ô §´Ô ®·‚ÆÁ≠®™† %1, † ¢Î°‡†≠≠Î© ‰†©´ ØÆ ®·‚ÆÁ≠®™„ %2';
      Text00006@1210011 : TextConst 'RUS=Ç ‰†©´• %1  „™†ß†≠ ®·‚ÆÁ≠®™ ™Æ≠·Æ´®§†Ê®® %2. Ç §†≠≠Æ© ™Æ¨Ø†≠®® ≠•‚ ‚†™Æ£Æ ®·‚ÆÁ≠®™†.';
      OperationNo@1210115 : Integer;
      LastBufferDocID@1210117 : Integer;
      LastBufferOperationNo@1210118 : Integer;
      DimValue3@1210119 : Code[20];
      DimValue15@1210121 : Code[20];
      Description2@1210122 : Text[50];

    PROCEDURE SetSource@1210000(NewConsSource@1210002 : Code[20];NewConsSourceFile@1210001 : Text[150];NewConsSourceSheet@1210000 : Text[50];NewLoadingDate@1210003 : Date;NewStructureUnit@1210004 : Code[20];NewDimValue3@1210005 : Code[20];NewDimValue15@1210006 : Code[20]);
    BEGIN
      ConsSource := NewConsSource;
      ConsSourceFile := NewConsSourceFile;
      ConsSourceSheet := NewConsSourceSheet;
      H1_StructureUnit :=NewStructureUnit;
      H2_ImportDate := WORKDATE;
      H3_ImportTime :=TIME;
      H4_StartDate := NewLoadingDate;
      H5_EndDate := NewLoadingDate;
      DimValue3 := NewDimValue3;
      DimValue15 := NewDimValue15;
      current_row :=2;
    END;

    PROCEDURE ProcessBuffer@1000000000();
    VAR
      IComma@1210000 : Integer;
    BEGIN

      Indicator.OPEN('á†£‡„ß™† §†≠≠ÎÂ ®ß ‰†©´† ¢ Ø‡•§°„‰•‡' + '\' +
                     '######1##########################################################'  + '\' +
                     'ó®·´Æ ß†£‡„¶•≠≠ÎÂ ·‚‡Æ™'    + '\' +
                     '######2##########################################################');

      Indicator.UPDATE(1, ConsSourceFile);
      TmpïlBuffer.RESET;
      IF TmpïlBuffer.FIND('-') THEN BEGIN
        REPEAT
        IF TmpïlBuffer."Row No." >1 THEN BEGIN
          IF TmpïlBuffer."Row No."<>current_row THEN  BEGIN
            InitPreBuffer;
            CheckFileData;
            ImportPreBuffer;
            PreBuffer.INSERT(TRUE);
            ClearValue;
            j +=1;
            Indicator.UPDATE(2, j);
          END;

          ConsDateImportSetup.SETRANGE(ConsDateImportSetup."Cons. Source No.",ConsSource);
          ConsDateImportSetup.SETRANGE("Excel Column No.",TmpïlBuffer."Column No.");
          IF ConsDateImportSetup.FINDFIRST THEN BEGIN
            CASE ConsDateImportSetup."Filed No." OF
               PreBuffer.FIELDNO("Entry No."):
                 EVALUATE(D6_OperationNo,TmpïlBuffer."Cell Value as Text");
               PreBuffer.FIELDNO("Document Type"):
                 D7_DocumentType :=TmpïlBuffer."Cell Value as Text";
               PreBuffer.FIELDNO("Document No."):
                 D8_DocumentNo :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,20);
               PreBuffer.FIELDNO("Document Date"):
                 EVALUATE(D9_DocumentDate,TmpïlBuffer."Cell Value as Text");
               PreBuffer.FIELDNO("Debit G/L Account No."):
                 BEGIN
                   IF GetNumber(TmpïlBuffer."Cell Value as Text") <> 0 THEN
                     D10_DebetAccNo := FORMAT(GetNumber(TmpïlBuffer."Cell Value as Text"))
                   ELSE
                     D10_DebetAccNo :=TmpïlBuffer."Cell Value as Text";

                 END;
               PreBuffer.FIELDNO("Credit G/L Account No."):
                 BEGIN
                   IF GetNumber(TmpïlBuffer."Cell Value as Text") <> 0 THEN
                     D11_CreditAccNo := FORMAT(GetNumber(TmpïlBuffer."Cell Value as Text"))
                   ELSE
                     D11_CreditAccNo :=TmpïlBuffer."Cell Value as Text";

                 END;
               PreBuffer.FIELDNO(Description):
                 D12_Basis :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,50);
               PreBuffer.FIELDNO("Debit Currency Code"):
                 D13_DebetCurrencyCode :=TmpïlBuffer."Cell Value as Text";
               PreBuffer.FIELDNO("Credit Currency Code"):
                 D13_CreditCurrencyCode :=TmpïlBuffer."Cell Value as Text";
               PreBuffer.FIELDNO(PreBuffer."Amount (LCY)"):
                 EVALUATE(D14_AmountRUR,TmpïlBuffer."Cell Value as Text");
               PreBuffer.FIELDNO(PreBuffer."Debit Original Amount"):
                 EVALUATE(D15_DebetOriginalAmount,TmpïlBuffer."Cell Value as Text");
               PreBuffer.FIELDNO(PreBuffer."Credit Original Amount"):
                 EVALUATE(D15_CreditOriginalAmount,TmpïlBuffer."Cell Value as Text");
               {
               PreBuffer.FIELDNO(PreBuffer."Debit Int Contragent"):
                 EVALUATE(DebitIntContragent,TmpïlBuffer."Cell Value as Text");
               PreBuffer.FIELDNO(PreBuffer."ëredit Int Contragent"):
                 EVALUATE(CreditIntContragent,TmpïlBuffer."Cell Value as Text");
               }
               {
               PreBuffer.FIELDNO(PreBuffer."No. of Depreciation Months"):
                 EVALUATE(D17_UsefulPeriod,TmpïlBuffer."Cell Value as Text");
               PreBuffer.FIELDNO(PreBuffer."FA Class Code"):
                 D18_FAClassCode :=TmpïlBuffer."Cell Value as Text";

               PreBuffer.FIELDNO(PreBuffer.Quantity):
                 EVALUATE(D19_Quantity,TmpïlBuffer."Cell Value as Text");
               PreBuffer.FIELDNO(PreBuffer."Debit Dimension 1 Value Code"):
                 D20_DebitDim1_Value :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,20);
               PreBuffer.FIELDNO(PreBuffer."Debit Dimension 1 Name"):
                 D21_DebitDim1_ValueName :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,50);
               PreBuffer.FIELDNO(PreBuffer."Debit Dimension 2 Value Code"):
                 D22_DebitDim2_Value :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,20);
               PreBuffer.FIELDNO(PreBuffer."Debit Dimension 2 Name"):
                 D23_DebitDim2_ValueName :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,50);
               PreBuffer.FIELDNO(PreBuffer."Debit Dimension 3 Value Code"):
                 D24_DebitDim3_Value :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,20);
               PreBuffer.FIELDNO(PreBuffer."Debit Dimension 3 Name"):
                 D25_DebitDim3_ValueName :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,50);
               PreBuffer.FIELDNO(PreBuffer."Debit Dimension 4 Value Code"):
                 D26_DebitDim4_Value :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,20);
               PreBuffer.FIELDNO(PreBuffer."Debit Dimension 4 Name"):
                 D27_DebitDim4_ValueName :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,50);
               PreBuffer.FIELDNO(PreBuffer."Debit Dimension 5 Value Code"):
                 D28_DebitDim5_Value :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,20);
               PreBuffer.FIELDNO(PreBuffer."Debit Dimension 5 Name"):
                 D29_DebitDim5_ValueName :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,50);
               PreBuffer.FIELDNO(PreBuffer."Debit Dimension 6 Value Code"):
                 D30_DebitDim6_Value :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,20);
               PreBuffer.FIELDNO(PreBuffer."Debit Dimension 6 Name"):
                 D31_DebitDim6_ValueName :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,50);
               PreBuffer.FIELDNO(PreBuffer."Debit Dimension 7 Value Code"):
                 D32_DebitDim7_Value :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,20);
               PreBuffer.FIELDNO(PreBuffer."Debit Dimension 7 Name"):
                 D33_DebitDim7_ValueName :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,50);
               PreBuffer.FIELDNO(PreBuffer."Debit Dimension 8 Value Code"):
                 D34_DebitDim8_Value :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,20);
               PreBuffer.FIELDNO(PreBuffer."Debit Dimension 8 Name"):
                 D35_DebitDim8_ValueName :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,50);
               PreBuffer.FIELDNO(PreBuffer."Debit Dimension 9 Value Code"):
                 D36_DebitDim9_Value :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,20);
               PreBuffer.FIELDNO(PreBuffer."Debit Dimension 9 Name"):
                 D37_DebitDim9_ValueName :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,50);
               PreBuffer.FIELDNO(PreBuffer."Debit Dimension 10 Value Code"):
                 D38_DebitDim10_Value :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,20);
               PreBuffer.FIELDNO(PreBuffer."Debit Dimension 10 Name"):
                 D39_DebitDim10_ValueName :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,50);
               PreBuffer.FIELDNO(PreBuffer."Debit Dimension 11 Value Code"):
                 D40_DebitDim11_Value :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,20);
               PreBuffer.FIELDNO(PreBuffer."Debit Dimension 11 Name"):
                 D41_DebitDim11_ValueName :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,50);
               PreBuffer.FIELDNO(PreBuffer."Debit Dimension 12 Value Code"):
                 DebitDim12_Value :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,20);
               PreBuffer.FIELDNO(PreBuffer."Debit Dimension 12 Name"):
                 DebitDim12_ValueName :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,50);
               PreBuffer.FIELDNO(PreBuffer."Debit Dimension 13 Value Code"):
                 DebitDim13_Value :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,20);
               PreBuffer.FIELDNO(PreBuffer."Debit Dimension 13 Name"):
                 DebitDim13_ValueName :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,50);
               PreBuffer.FIELDNO(PreBuffer."Debit Dimension 14 Value Code"):
                 DebitDim14_Value :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,20);
               PreBuffer.FIELDNO(PreBuffer."Debit Dimension 14 Name"):
                 DebitDim14_ValueName :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,50);
               PreBuffer.FIELDNO(PreBuffer."Debit Dimension 15 Value Code"):
                 DebitDim15_Value :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,20);
               PreBuffer.FIELDNO(PreBuffer."Debit Dimension 15 Name"):
                 DebitDim15_ValueName :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,50);
               PreBuffer.FIELDNO(PreBuffer."Debit Dimension 16 Value Code"):
                 DebitDim16_Value :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,20);
               PreBuffer.FIELDNO(PreBuffer."Debit Dimension 16 Name"):
                 DebitDim16_ValueName :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,50);
               PreBuffer.FIELDNO(PreBuffer."Credit Dimension 1 Value Code"):
                 D42_CreditDim1_Value :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,20);
               PreBuffer.FIELDNO(PreBuffer."Credit Dimension 1 Name"):
                 D43_CreditDim1_ValueName :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,50);
               PreBuffer.FIELDNO(PreBuffer."Credit Dimension 2 Value Code"):
                 D44_CreditDim2_Value :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,20);
               PreBuffer.FIELDNO(PreBuffer."Credit Dimension 2 Name"):
                 D45_CreditDim2_ValueName :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,50);
               PreBuffer.FIELDNO(PreBuffer."Credit Dimension 3 Value Code"):
                 D46_CreditDim3_Value :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,20);
               PreBuffer.FIELDNO(PreBuffer."Credit Dimension 3 Name"):
                 D47_CreditDim3_ValueName :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,50);
               PreBuffer.FIELDNO(PreBuffer."Credit Dimension 4 Value Code"):
                 D48_CreditDim4_Value :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,20);
               PreBuffer.FIELDNO(PreBuffer."Credit Dimension 4 Name"):
                 D49_CreditDim4_ValueName :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,50);
               PreBuffer.FIELDNO(PreBuffer."Credit Dimension 5 Value Code"):
                 D50_CreditDim5_Value :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,20);
               PreBuffer.FIELDNO(PreBuffer."Credit Dimension 5 Name"):
                 D51_CreditDim5_ValueName :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,50);
               PreBuffer.FIELDNO(PreBuffer."Credit Dimension 6 Value Code"):
                 D52_CreditDim6_Value :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,20);
               PreBuffer.FIELDNO(PreBuffer."Credit Dimension 6 Name"):
                 D53_CreditDim6_ValueName :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,50);
               PreBuffer.FIELDNO(PreBuffer."Credit Dimension 7 Value Code"):
                 D54_CreditDim7_Value :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,20);
               PreBuffer.FIELDNO(PreBuffer."Credit Dimension 7 Name"):
                 D55_CreditDim7_ValueName :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,50);
               PreBuffer.FIELDNO(PreBuffer."Credit Dimension 8 Value Code"):
                 D56_CreditDim8_Value :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,20);
               PreBuffer.FIELDNO(PreBuffer."Credit Dimension 8 Name"):
                 D57_CreditDim8_ValueName :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,50);
               PreBuffer.FIELDNO(PreBuffer."Credit Dimension 9 Value Code"):
                 D58_CreditDim9_Value :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,20);
               PreBuffer.FIELDNO(PreBuffer."Credit Dimension 9 Name"):
                 D59_CreditDim9_ValueName :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,50);
               PreBuffer.FIELDNO(PreBuffer."Credit Dimension 10 Value Code"):
                 D60_CreditDim10_Value :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,20);
               PreBuffer.FIELDNO(PreBuffer."Credit Dimension 10 Name"):
                 D61_CreditDim10_ValueName :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,50);
               PreBuffer.FIELDNO(PreBuffer."Credit Dimension 11 Value Code"):
                 D62_CreditDim11_Value :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,20);
               PreBuffer.FIELDNO(PreBuffer."Credit Dimension 11 Name"):
                 D63_CreditDim11_ValueName :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,50);
               PreBuffer.FIELDNO(PreBuffer."Credit Dimension 12 Value Code"):
                 CreditDim12_Value :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,20);
               PreBuffer.FIELDNO(PreBuffer."Credit Dimension 12 Name"):
                 CreditDim12_ValueName :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,50);
               PreBuffer.FIELDNO(PreBuffer."Credit Dimension 13 Value Code"):
                 CreditDim13_Value :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,20);
               PreBuffer.FIELDNO(PreBuffer."Credit Dimension 13 Name"):
                 CreditDim13_ValueName :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,50);
               PreBuffer.FIELDNO(PreBuffer."Credit Dimension 14 Value Code"):
                 CreditDim14_Value :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,20);
               PreBuffer.FIELDNO(PreBuffer."Credit Dimension 14 Name"):
                 CreditDim14_ValueName :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,50);
               PreBuffer.FIELDNO(PreBuffer."Credit Dimension 15 Value Code"):
                 CreditDim15_Value :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,20);
               PreBuffer.FIELDNO(PreBuffer."Credit Dimension 15 Name"):
                 CreditDim15_ValueName :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,50);
               PreBuffer.FIELDNO(PreBuffer."Credit Dimension 16 Value Code"):
                 CreditDim16_Value :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,20);
               PreBuffer.FIELDNO(PreBuffer."Credit Dimension 16 Name"):
                 CreditDim16_ValueName :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,50);
               PreBuffer.FIELDNO(PreBuffer."Travel Expenses"):
                 EVALUATE(TravelExpenses,TmpïlBuffer."Cell Value as Text");
               PreBuffer.FIELDNO("Original Doc. Date"):
                 EVALUATE(OrigDocumentDate,TmpïlBuffer."Cell Value as Text");
               PreBuffer.FIELDNO(PreBuffer."Description 2"):
                 Description2 :=COPYSTR(TmpïlBuffer."Cell Value as Text",1,50);
               }
            END;
          END;
          current_row:=TmpïlBuffer."Row No.";
        END;

        UNTIL TmpïlBuffer.NEXT()=0;
        IF TmpïlBuffer."Row No."+1<>current_row THEN  BEGIN
          InitPreBuffer;
          CheckFileData;
          ImportPreBuffer;
          PreBuffer.INSERT(TRUE);
          ClearValue;
          j +=1;
          Indicator.UPDATE(2, j);
        END;
      END;
      Indicator.CLOSE;
    END;

    PROCEDURE InitPreBuffer@1210021();
    BEGIN
      //NC PIF001 > DP
      PreBuffer.INIT;
      PreBuffer."Entry No." := EntryNo;
      PreBuffer."Operation No." := OperationNo;
      PreBuffer."Structure Unit" := H1_StructureUnit;
      {
      PreBuffer."Import Date" := WORKDATE;
      PreBuffer."Import Time" := TIME;
      PreBuffer."Begining Date" := H4_StartDate;
      PreBuffer."Ending Date" := H5_EndDate;
      PreBuffer."Document No." := D8_DocumentNo;
      PreBuffer."Document Date" := D9_DocumentDate;
      PreBuffer."Document ID" := FORMAT(OperationNo);
      }
      IF DimValue3<>'' THEN BEGIN
        D24_DebitDim3_Value := DimValue3;
        D46_CreditDim3_Value := DimValue3;
      END;

      IF DebitDim15_Value='' THEN BEGIN
        DebitDim15_Value := DimValue15;
      END;

      IF CreditDim15_Value='' THEN BEGIN
        CreditDim15_Value := DimValue15;
      END;

      IF D9_DocumentDate=0D THEN
        D9_DocumentDate := H4_StartDate;

      IF D14_AmountRUR<0 THEN BEGIN
        D11_CreditAccNo := D10_DebetAccNo;
        D10_DebetAccNo := ConsolidationSource."Corresponding G/L Account No.";

        IF D15_DebetOriginalAmount<0 THEN BEGIN
          //D15_DebetOriginalAmount :=ABS(D15_DebetOriginalAmount);

          D15_CreditOriginalAmount := ABS(D15_DebetOriginalAmount);
          D13_CreditCurrencyCode := D13_DebetCurrencyCode;
          D15_DebetOriginalAmount :=0;
          D13_DebetCurrencyCode :='';
        END;
        D14_AmountRUR := ABS(D14_AmountRUR)
      END ELSE BEGIN
        D11_CreditAccNo := ConsolidationSource."Corresponding G/L Account No.";
        D15_CreditOriginalAmount := 0;
        //D13_CreditCurrencyCode :='';
      END;

      EntryNo += 1;
      OperationNo += 1000;
      //NC PIF001 < DP
    END;

    PROCEDURE CheckFileData@1210048();
    VAR
      FAAnalytics@1210000 : Boolean;
      ConsMgt@1210001 : Codeunit 50000;
      ErrOper@1210002 : Text[50];
      ErrDoc@1210003 : Text[20];
      ErrMessage@1210004 : Text[150];
    BEGIN
      //NC PIF001 > DP
      {
      IF D6_OperationNo = 0 THEN BEGIN
        PreBuffer."Error in Import" := TRUE;
        PreBuffer."Error Description" := 'ç• ß†ØÆ´≠•≠Æ Æ°Ôß†‚•´Ï≠Æ• ØÆ´•: éØ•‡†Ê®Ô çÆ.';
      END;
      IF D7_DocumentType = '' THEN BEGIN
        PreBuffer."Error in Import" := TRUE;
        PreBuffer."Error Description" := 'ç• ß†ØÆ´≠•≠Æ Æ°Ôß†‚•´Ï≠Æ• ØÆ´•: í®Ø ÑÆ™„¨•≠‚†';
      END;

      IF D8_DocumentNo = '' THEN BEGIN
        PreBuffer."Error in Import" := TRUE;
        PreBuffer."Error Description" := 'ç• ß†ØÆ´≠•≠Æ Æ°Ôß†‚•´Ï≠Æ• ØÆ´•: çÆ ÑÆ™„¨•≠‚†';
      END;
      IF D9_DocumentDate = 0D THEN BEGIN
        PreBuffer."Error in Import" := TRUE;
        PreBuffer."Error Description" := 'ç• ß†ØÆ´≠•≠Æ Æ°Ôß†‚•´Ï≠Æ• ØÆ´•: Ñ†‚† ÑÆ™„¨•≠‚†';
      END;
      IF D10_DebetAccNo = '' THEN BEGIN
        PreBuffer."Error in Import" := TRUE;
        PreBuffer."Error Description" := 'ç• ß†ØÆ´≠•≠Æ Æ°Ôß†‚•´Ï≠Æ• ØÆ´•: Ñ•°•‚ ëÁ•‚ çÆ.';
      END;
      IF D11_CreditAccNo  = '' THEN BEGIN
        PreBuffer."Error in Import" := TRUE;
        PreBuffer."Error Description" := 'ç• ß†ØÆ´≠•≠Æ Æ°Ôß†‚•´Ï≠Æ• ØÆ´•: ä‡•§®‚ ëÁ•‚ çÆ.';
      END;
      IF (D14_AmountRUR = 0) AND ((D13_DebetCurrencyCode = '') OR (D13_CreditCurrencyCode = '')) THEN BEGIN
        PreBuffer."Error in Import" := TRUE;
        PreBuffer."Error Description" := 'ç• „™†ß†≠ äÆ§ Ç†´Ó‚Î ® ë„¨¨† ¢ ê„°´ÔÂ ‡†¢≠† 0.';
      END;
      IF ((D15_DebetOriginalAmount = 0) AND (D13_DebetCurrencyCode <> '') OR
          (D15_CreditOriginalAmount = 0) AND (D13_CreditCurrencyCode <> ''))
      THEN BEGIN
        PreBuffer."Error in Import" := TRUE;
        PreBuffer."Error Description" := 'ì™†ß†≠ äÆ§ Ç†´Ó‚Î ® ë„¨¨† ¢ ¢†´Ó‚• ‡†¢≠† 0.';
      END;

      IF PreBuffer."Error in Import" THEN BEGIN
        ErrOper := FORMAT(PreBuffer."Operation No.") + ' / ' + FORMAT(PreBuffer."Document Date");
        ErrDoc := PreBuffer."Document No.";
        ErrMessage := PreBuffer."Error Description";
        ConsMgt.CreateErrorLogEntry(PreBuffer."Cons. Source Code", RegisterNo,0,0,
          FORMAT(PreBuffer."Operation No."),PreBuffer."Document Date",'',ErrDoc,ErrMessage,'');
      END;

      FAAnalytics := FALSE;
      IF (D34_DebitDim8_Value <> '') OR (D56_CreditDim8_Value <> '') THEN
        FAAnalytics := TRUE;
      IF (D32_DebitDim7_Value <> '') OR (D54_CreditDim7_Value <> '') THEN
        FAAnalytics := TRUE;
      IF (D40_DebitDim11_Value <> '') OR (D62_CreditDim11_Value <> '') THEN
        FAAnalytics := TRUE;
      IF (D38_DebitDim10_Value <> '') OR (D60_CreditDim10_Value <> '') THEN
        FAAnalytics := TRUE;

      IF FAAnalytics THEN
        PreBuffer."FA Operation" := TRUE;
      }
      //NC PIF001 < DP
    END;

    PROCEDURE ImportPreBuffer@1210110();
    VAR
      FAType@1210000 : Integer;
      IComma1@1210001 : Integer;
    BEGIN
      //NC PIF001 > DP
      {
      PreBuffer."Cons. Source Code" := ConsSource;
      PreBuffer."Export Cons. Source Code" := ExportConsSource1;

      IF D6_OperationNo<>0 THEN
        PreBuffer."Operation No." := D6_OperationNo;

      PreBuffer."Document Type" := D7_DocumentType;
      PreBuffer."Document No." := D8_DocumentNo;
      PreBuffer."Document Date" := D9_DocumentDate;

      PreBuffer."Debit G/L Account No." := D10_DebetAccNo;
      PreBuffer."Credit G/L Account No." := D11_CreditAccNo;
      PreBuffer.Description := D12_Basis;
      PreBuffer."Debit Currency Code" := D13_DebetCurrencyCode;
      PreBuffer."Amount (LCY)" := D14_AmountRUR;

      PreBuffer."Debit Original Amount" := D15_DebetOriginalAmount;
      PreBuffer."Credit Currency Code" := D13_CreditCurrencyCode;
      PreBuffer."Credit Original Amount" := D15_CreditOriginalAmount;


      PreBuffer."Debit Int Contragent" := DebitIntContragent;
      PreBuffer."ëredit Int Contragent" := CreditIntContragent;

      PreBuffer."No. of Depreciation Months" := D17_UsefulPeriod;
      PreBuffer."FA Class Code" := D18_FAClassCode;
      PreBuffer.Quantity := D19_Quantity;

      PreBuffer."Debit Dimension 1 Value Code" := D20_DebitDim1_Value;
      PreBuffer."Debit Dimension 1 Name" := D21_DebitDim1_ValueName;
      PreBuffer."Debit Dimension 2 Value Code" := D22_DebitDim2_Value;
      PreBuffer."Debit Dimension 2 Name" := D23_DebitDim2_ValueName;
      PreBuffer."Debit Dimension 3 Value Code" := D24_DebitDim3_Value;
      PreBuffer."Debit Dimension 3 Name" := D25_DebitDim3_ValueName;
      PreBuffer."Debit Dimension 4 Value Code" := D26_DebitDim4_Value;
      PreBuffer."Debit Dimension 4 Name" := D27_DebitDim4_ValueName;
      PreBuffer."Debit Dimension 5 Value Code" := D28_DebitDim5_Value;
      PreBuffer."Debit Dimension 5 Name" := D29_DebitDim5_ValueName;
      PreBuffer."Debit Dimension 6 Value Code" := D30_DebitDim6_Value;
      PreBuffer."Debit Dimension 6 Name" := D31_DebitDim6_ValueName;
      PreBuffer."Debit Dimension 7 Value Code" := D32_DebitDim7_Value;
      PreBuffer."Debit Dimension 7 Name" := D33_DebitDim7_ValueName;
      PreBuffer."Debit Dimension 8 Value Code" := D34_DebitDim8_Value;
      PreBuffer."Debit Dimension 8 Name" := D35_DebitDim8_ValueName;
      PreBuffer."Debit Dimension 9 Value Code" := D36_DebitDim9_Value;
      PreBuffer."Debit Dimension 9 Name" := D37_DebitDim9_ValueName;
      PreBuffer."Debit Dimension 10 Value Code" := D38_DebitDim10_Value;
      PreBuffer."Debit Dimension 10 Name" := D39_DebitDim10_ValueName;
      PreBuffer."Debit Dimension 11 Value Code" := D40_DebitDim11_Value;
      PreBuffer."Debit Dimension 11 Name" := D41_DebitDim11_ValueName;
      PreBuffer."Debit Dimension 12 Value Code" := DebitDim12_Value;
      PreBuffer."Debit Dimension 12 Name" := DebitDim12_ValueName;
      PreBuffer."Debit Dimension 13 Value Code" := DebitDim13_Value;
      PreBuffer."Debit Dimension 13 Name" := DebitDim13_ValueName;
      PreBuffer."Debit Dimension 14 Value Code" := DebitDim14_Value;
      PreBuffer."Debit Dimension 14 Name" := DebitDim14_ValueName;
      PreBuffer."Debit Dimension 15 Value Code" := DebitDim15_Value;
      PreBuffer."Debit Dimension 15 Name" := DebitDim15_ValueName;
      PreBuffer."Debit Dimension 16 Value Code" := DebitDim16_Value;
      PreBuffer."Debit Dimension 16 Name" := DebitDim16_ValueName;

      PreBuffer."Credit Dimension 1 Value Code" := D42_CreditDim1_Value;
      PreBuffer."Credit Dimension 1 Name" := D43_CreditDim1_ValueName;
      PreBuffer."Credit Dimension 2 Value Code" := D44_CreditDim2_Value;
      PreBuffer."Credit Dimension 2 Name" := D45_CreditDim2_ValueName;
      PreBuffer."Credit Dimension 3 Value Code" := D46_CreditDim3_Value;
      PreBuffer."Credit Dimension 3 Name" := D47_CreditDim3_ValueName;
      PreBuffer."Credit Dimension 4 Value Code" := D48_CreditDim4_Value;
      PreBuffer."Credit Dimension 4 Name" := D49_CreditDim4_ValueName;
      PreBuffer."Credit Dimension 5 Value Code" := D50_CreditDim5_Value;
      PreBuffer."Credit Dimension 5 Name" := D51_CreditDim5_ValueName;
      PreBuffer."Credit Dimension 6 Value Code" := D52_CreditDim6_Value;
      PreBuffer."Credit Dimension 6 Name" := D53_CreditDim6_ValueName;
      PreBuffer."Credit Dimension 7 Value Code" := D54_CreditDim7_Value;
      PreBuffer."Credit Dimension 7 Name" := D55_CreditDim7_ValueName;
      PreBuffer."Credit Dimension 8 Value Code" := D56_CreditDim8_Value;
      PreBuffer."Credit Dimension 8 Name" := D57_CreditDim8_ValueName;
      PreBuffer."Credit Dimension 9 Value Code" := D58_CreditDim9_Value;
      PreBuffer."Credit Dimension 9 Name" := D59_CreditDim9_ValueName;
      PreBuffer."Credit Dimension 10 Value Code" := D60_CreditDim10_Value;
      PreBuffer."Credit Dimension 10 Name" := D61_CreditDim10_ValueName;
      PreBuffer."Credit Dimension 11 Value Code" := D62_CreditDim11_Value;
      PreBuffer."Credit Dimension 11 Name" := D63_CreditDim11_ValueName;
      PreBuffer."Credit Dimension 12 Value Code" := CreditDim12_Value;
      PreBuffer."Credit Dimension 12 Name" := CreditDim12_ValueName;
      PreBuffer."Credit Dimension 13 Value Code" := CreditDim13_Value;
      PreBuffer."Credit Dimension 13 Name" := CreditDim13_ValueName;
      PreBuffer."Credit Dimension 14 Value Code" := CreditDim14_Value;
      PreBuffer."Credit Dimension 14 Name" := CreditDim14_ValueName;
      PreBuffer."Credit Dimension 15 Value Code" := CreditDim15_Value;
      PreBuffer."Credit Dimension 15 Name" := CreditDim15_ValueName;
      PreBuffer."Credit Dimension 16 Value Code" := CreditDim16_Value;
      PreBuffer."Credit Dimension 16 Name" := CreditDim16_ValueName;

      PreBuffer."Consolidation Register" := RegisterNo;

      //éØ‡•§•´Ô•¨ í®Ø éØ•‡†Ê®® éë

      IF PreBuffer."FA Operation" THEN
        FAType := CalcFAEntryType(ConsSource, D10_DebetAccNo, D11_CreditAccNo)
      ELSE
        FAType := -1;

      //≠• £‡„ß®¨ ·„¨¨Æ¢Î• ‡†ß≠®ÊÎ, ¢™´ÓÁ†•¨Î• ¢ Ø•‡¢Æ≠†Á†´Ï≠„Ó ·‚Æ®¨Æ·‚Ï éÇÄ
      IF PreBuffer."FA Operation" AND ((PreBuffer."Credit Dimension 14 Value Code" <> '') OR
         (PreBuffer."Debit Dimension 14 Value Code" <> ''))
      THEN
        FAType := 8;

      IF FAType <> - 1 THEN BEGIN
        PreBuffer."FA Operation Type" := FAType;
        //Ö·´® ‚®Ø = ç• ®¨ØÆ‡‚®‡Æ¢†‚Ï, ‚Æ£§† "á†£‡„¶•≠†"
        IF PreBuffer."FA Operation Type" = PreBuffer."FA Operation Type"::"8" THEN BEGIN
          PreBuffer."FA Operation Exported" := TRUE;
          PreBuffer."FA Operation Processed" := TRUE;
        END;
      END;

      //§Æ°†¢´•≠®• ™Æ§Æ¢ ®ß¨•‡•≠®© ®ß ≠†·‚‡Æ•™
      ConsolidationSource.GET(ConsSource);
      PreBuffer."Dimension 1 Code" :=    ConsolidationSource."Shortcut Dimension 1 Code";
      PreBuffer."Dimension 2 Code" :=    ConsolidationSource."Shortcut Dimension 2 Code";
      PreBuffer."Dimension 3 Code" :=    ConsolidationSource."Shortcut Dimension 3 Code";
      PreBuffer."Dimension 4 Code" :=    ConsolidationSource."Shortcut Dimension 4 Code";
      PreBuffer."Dimension 5 Code" :=    ConsolidationSource."Shortcut Dimension 5 Code";
      PreBuffer."Dimension 6 Code" :=    ConsolidationSource."Shortcut Dimension 6 Code";
      PreBuffer."Dimension 7 Code" :=    ConsolidationSource."Shortcut Dimension 7 Code";
      PreBuffer."Dimension 8 Code" :=    ConsolidationSource."Shortcut Dimension 8 Code";
      PreBuffer."Dimension 9 Code" :=    ConsolidationSource."Shortcut Dimension 9 Code";
      PreBuffer."Dimension 10 Code" :=    ConsolidationSource."Shortcut Dimension 10 Code";
      PreBuffer."Dimension 11 Code" :=    ConsolidationSource."Shortcut Dimension 11 Code";
      PreBuffer."Dimension 12 Code" :=    ConsolidationSource."Shortcut Dimension 12 Code";
      PreBuffer."Dimension 13 Code" :=    ConsolidationSource."Shortcut Dimension 13 Code";
      PreBuffer."Dimension 14 Code" :=    ConsolidationSource."Shortcut Dimension 14 Code";
      PreBuffer."Dimension 15 Code" :=    ConsolidationSource."Shortcut Dimension 15 Code";
      PreBuffer."Dimension 16 Code" :=    ConsolidationSource."Shortcut Dimension 16 Code";
      PreBuffer."Travel Expenses" := TravelExpenses;
      PreBuffer."Original Doc. Date" := OrigDocumentDate;
      PreBuffer."Description 2" := Description2;
      }
      //NC PIF001 < DP
    END;

    PROCEDURE InitEntryNo@1210002();
    VAR
      PreBuffer1@1210000 : Record 50007;
    BEGIN
      //NC PIF001 > DP
      PreBuffer1.SETRANGE("Cons. Source Code", ConsSource);
      IF PreBuffer1.FIND('+') THEN BEGIN
        EntryNo := PreBuffer1."Entry No." + 1;
        OperationNo := PreBuffer1."Operation No." + 1000 + LastBufferOperationNo;
      END ELSE BEGIN
        EntryNo := 1;
        OperationNo := 1000 + LastBufferOperationNo;
      END;
      //NC PIF001 < DP
    END;

    PROCEDURE CreateConsRegister@1000000007(ConsSource@1000000004 : Code[20];FromEntryNo@1000000002 : Integer;ToEntryNo@1000000003 : Integer;FromDate@1000000000 : Date;ToDate@1000000001 : Date;RegisterNo1@1210002 : Integer);
    VAR
      ConsolSource1@1000000008 : Record 50001;
      ConsolidationSetup@1210000 : Record 50000;
      ConsRegister@1210001 : Record 50005;
    BEGIN
      //NC PIF001 > DP
      IF FromEntryNo > ToEntryNo THEN
        FromEntryNo := ToEntryNo;
      ConsRegister.INIT;
      ConsRegister."No." := RegisterNo1;
      ConsRegister."Cons. Source Code" := ConsSource;
      ConsRegister."Consolidation Date" := TODAY;
      ConsRegister."User ID" := USERID;
      ConsRegister."From Entry No." := FromEntryNo;
      ConsRegister."To Entry No." := ToEntryNo;
      ConsRegister."From Posting Date" := FromDate;
      ConsRegister."To Posting Date" := ToDate;
      ConsolidationSetup.GET;
      ConsolSource1.GET(ConsSource);
      ConsRegister."Gen. Journal Template" := ConsolidationSetup."Gen. Jnl. Template";
      ConsRegister."Gen. Journal Batch" := ConsolSource1."Gen. Journal Batch";
      ConsRegister."Closed Period Journal Template" := ConsolidationSetup."Gen. Jnl. Template";
      ConsRegister."Closed Period Journal Batch" := ConsolSource1."Closed Period Journal Batch";
      ConsRegister."Reposted Journal Template" :=  ConsolidationSetup."Gen. Jnl. Template";
      ConsRegister."Reposted Journal Batch" := ConsolSource1."Reposted Journal Batch";
      ConsRegister."Removed Journal Template" := ConsolidationSetup."Gen. Jnl. Template";
      ConsRegister."Removed Journal Batch" := ConsolSource1."Removed Journal Batch";
      ConsRegister."Load From File" := ConsSourceFile;
      ConsRegister.INSERT(TRUE);
      //NC PIF001 < DP
    END;

    PROCEDURE GetNextRegisterNo@1000000006(ConsSource@1210000 : Code[20]) : Integer;
    VAR
      ConsRegister@1000000002 : Record 50005;
    BEGIN
      //NC PIF001 > DP
      ConsRegister.RESET;
      ConsRegister.SETRANGE("Cons. Source Code", ConsSource);
      IF ConsRegister.FIND('+') THEN
        EXIT(ConsRegister."No." + 1)
      ELSE
        EXIT(1);
      //NC PIF001 < DP
    END;

    PROCEDURE FindLastBufferEntry@1210016(ConsSourceCode@1210001 : Code[20]) LastEntyNo : Integer;
    VAR
      Buffer@1210000 : Record 50008;
    BEGIN
      //NC PIF001 > DP
      Buffer.SETRANGE("Cons. Source Code", ConsSourceCode);
      IF Buffer.FIND('+') THEN
        EXIT(Buffer."Entry No.")
      ELSE
        EXIT(0);
      //NC PIF001 < DP
    END;

    PROCEDURE CalcFAEntryType@1210023(ConsSource1@1210001 : Code[20];DebitAcc@1210002 : Code[20];CreditAcc@1210003 : Code[20]) OperationType : Integer;
    VAR
      FATrasformSetup@1210000 : Record 50004;
      ConsolidationSource1@1210004 : Record 50001;
    BEGIN
      //NC PIF001 > DP
      ConsolidationSource1.GET(ConsSource1);
      //ConsolidationSource1.TESTFIELD("FA Import Company Name");
      //FATrasformSetup.CHANGECOMPANY(ConsolidationSource1."FA Import Company Name");
      //FATrasformSetup.SETRANGE("Consolidation Source Code", ConsSource1);
      FATrasformSetup.SETRANGE("Extern. Debit Acc. No.", DebitAcc);
      FATrasformSetup.SETRANGE("Extern. Credit Acc. No.", CreditAcc);
      IF FATrasformSetup.FIND('-') THEN
        EXIT(FATrasformSetup."FA Operation Type");
      //FATrasformSetup.SETRANGE("Consolidation Source Code", '');
      FATrasformSetup.SETRANGE("Extern. Debit Acc. No.", DebitAcc);
      FATrasformSetup.SETRANGE("Extern. Credit Acc. No.", CreditAcc);
      IF FATrasformSetup.FIND('-') THEN
        EXIT(FATrasformSetup."FA Operation Type");
      EXIT(-1);
      //NC PIF001 < DP
    END;

    PROCEDURE SetConsSource@1210001(ConsSource1@1210000 : Code[20]);
    BEGIN
      //NC PIF001 > DP
      ConsSourceCode := ConsSource1;
      //NC PIF001 < DP
    END;

    PROCEDURE ClearValue@1210015();
    BEGIN
      CLEAR(D6_OperationNo);
      CLEAR(D7_DocumentType);
      CLEAR(D8_DocumentNo);
      CLEAR(D9_DocumentDate);
      CLEAR(D10_DebetAccNo);
      CLEAR(D11_CreditAccNo);
      CLEAR(D12_Basis);
      CLEAR(D13_DebetCurrencyCode);
      CLEAR(D13_CreditCurrencyCode);
      CLEAR(D14_AmountRUR);
      CLEAR(D15_DebetOriginalAmount);
      CLEAR(D15_CreditOriginalAmount);
      CLEAR(DebitIntContragent);
      CLEAR(CreditIntContragent);
      CLEAR(D17_UsefulPeriod);
      CLEAR(D18_FAClassCode);
      CLEAR(D19_Quantity);
      CLEAR(D20_DebitDim1_Value);
      CLEAR(D21_DebitDim1_ValueName);
      CLEAR(D22_DebitDim2_Value);
      CLEAR(D23_DebitDim2_ValueName);
      CLEAR(D24_DebitDim3_Value);
      CLEAR(D25_DebitDim3_ValueName);
      CLEAR(D26_DebitDim4_Value);
      CLEAR(D27_DebitDim4_ValueName);
      CLEAR(D28_DebitDim5_Value);
      CLEAR(D29_DebitDim5_ValueName);
      CLEAR(D30_DebitDim6_Value);
      CLEAR(D31_DebitDim6_ValueName);
      CLEAR(D32_DebitDim7_Value);
      CLEAR(D33_DebitDim7_ValueName);
      CLEAR(D34_DebitDim8_Value);
      CLEAR(D35_DebitDim8_ValueName);
      CLEAR(D36_DebitDim9_Value);
      CLEAR(D37_DebitDim9_ValueName);
      CLEAR(D38_DebitDim10_Value);
      CLEAR(D39_DebitDim10_ValueName);
      CLEAR(D40_DebitDim11_Value);
      CLEAR(D41_DebitDim11_ValueName);
      CLEAR(DebitDim12_Value);
      CLEAR(DebitDim12_ValueName);
      CLEAR(DebitDim13_Value);
      CLEAR(DebitDim13_ValueName);
      CLEAR(DebitDim14_Value);
      CLEAR(DebitDim14_ValueName);
      CLEAR(DebitDim15_Value);
      CLEAR(DebitDim15_ValueName);
      CLEAR(DebitDim16_Value);
      CLEAR(DebitDim16_ValueName);
      CLEAR(D42_CreditDim1_Value);
      CLEAR(D43_CreditDim1_ValueName);
      CLEAR(D44_CreditDim2_Value);
      CLEAR(D45_CreditDim2_ValueName);
      CLEAR(D46_CreditDim3_Value);
      CLEAR(D47_CreditDim3_ValueName);
      CLEAR(D48_CreditDim4_Value);
      CLEAR(D49_CreditDim4_ValueName);
      CLEAR(D50_CreditDim5_Value);
      CLEAR(D51_CreditDim5_ValueName);
      CLEAR(D52_CreditDim6_Value);
      CLEAR(D53_CreditDim6_ValueName);
      CLEAR(D54_CreditDim7_Value);
      CLEAR(D55_CreditDim7_ValueName);
      CLEAR(D56_CreditDim8_Value);
      CLEAR(D57_CreditDim8_ValueName);
      CLEAR(D58_CreditDim9_Value);
      CLEAR(D59_CreditDim9_ValueName);
      CLEAR(D60_CreditDim10_Value);
      CLEAR(D61_CreditDim10_ValueName);
      CLEAR(D62_CreditDim11_Value);
      CLEAR(D63_CreditDim11_ValueName);
      CLEAR(CreditDim12_Value);
      CLEAR(CreditDim12_ValueName);
      CLEAR(CreditDim13_Value);
      CLEAR(CreditDim13_ValueName);
      CLEAR(CreditDim14_Value);
      CLEAR(CreditDim14_ValueName);
      CLEAR(CreditDim15_Value);
      CLEAR(CreditDim15_ValueName);
      CLEAR(CreditDim16_Value);
      CLEAR(CreditDim16_ValueName);
      CLEAR(TravelExpenses);
    END;

    PROCEDURE StartLoad@1000000001();
    BEGIN
      //NC PIF001 > DP
      IsError := FALSE;
      PreBuffer.DELETEALL;
      LastBufferOperationNo := FindLastBufferOperNo(ConsSource);
      InitEntryNo;

      IF H1_StructureUnit = '' THEN
        IsError := TRUE;
      IF H2_ImportDate = 0D THEN
        IsError := TRUE;
      IF H3_ImportTime = 0T THEN
        IsError := TRUE;
      IF H4_StartDate = 0D THEN
        IsError := TRUE;
      IF H5_EndDate = 0D THEN
        IsError := TRUE;
      IF IsError THEN
        ERROR(Text00001);
      ConsolidationSource.SETRANGE("Structure Unit", H1_StructureUnit);
      ConsolidationSource.SETRANGE(Blocked, FALSE);
      ConsolidationSource.SETRANGE("Import Format", ConsolidationSource."Import Format"::FromExtSystem);
      IF ConsolidationSource.COUNT > 1 THEN
        ERROR(Text00003);
      IF ConsolidationSource.COUNT = 0 THEN
        ERROR(Text00004);
      ConsolidationSource.FINDFIRST;
      //IF ConsolidationSource."Receive Company" <> COMPANYNAME THEN
      //  ERROR(Text00006, ConsSourceFile, ConsolidationSource.Code);
      ConsSource := ConsolidationSource.Code;

      IF (ConsSourceCode <> ConsSource) AND (ConsSourceCode <> '') THEN
        ERROR(Text00005,ConsSourceCode,ConsSource);
      ExportConsSource1 := ConsolidationSource."Export Cons. Source";
      RegisterNo := GetNextRegisterNo(ConsSource);

      TmpïlBuffer.RESET;
      TmpïlBuffer.DELETEALL();
      TmpïlBuffer.OpenBook(ConsSourceFile,ConsSourceSheet);
      TmpïlBuffer.ReadSheet();
      ProcessBuffer();

      //è•‡•≠Æ· ß†Ø®·•© ®ß Ø‡•§°„‰•‡† ¢ °„‰•‡
      EntryFrom := FindLastBufferEntry(ConsSource) + 1;
      ImportBufferMgt.ImportBufferFromPreBuffer(H4_StartDate, H5_EndDate, H1_StructureUnit, ConsSource, TRUE, RegisterNo);
      ImportBufferMgt.ComparePreBufferwithBuffer(H4_StartDate, H5_EndDate, H1_StructureUnit, RegisterNo, ConsSource);
      EntryTo := FindLastBufferEntry(ConsSource);
      CreateConsRegister(ConsSource,EntryFrom, EntryTo,H4_StartDate,H5_EndDate,RegisterNo);

      ConsolidationSource."Last Consolidation Date" := TODAY;
      ConsolidationSource."Last Consolidation Time" := TIME;
      ConsolidationSource."Last G/L Entry No." := EntryTo;
      ConsolidationSource.MODIFY;
    END;

    PROCEDURE FindLastBufferDocID@1210003(ConsSourceCode@1210001 : Code[20]) LastEntyNo : Integer;
    VAR
      Buffer@1210000 : Record 50008;
      DocID@1210002 : Integer;
    BEGIN
      //NC PIF001 > DP
      Buffer.SETRANGE("Cons. Source Code", ConsSourceCode);
      IF Buffer.FIND('+') THEN BEGIN
        EVALUATE(DocID,Buffer."Document ID");
        EXIT(DocID);
      END ELSE
        EXIT(0);
      //NC PIF001 < DP
    END;

    PROCEDURE FindLastBufferOperNo@1210004(ConsSourceCode@1210001 : Code[20]) LastEntyNo : Integer;
    VAR
      Buffer@1210000 : Record 50008;
      DocID@1210002 : Integer;
    BEGIN
      //NC PIF001 > DP
      Buffer.SETRANGE("Cons. Source Code", ConsSourceCode);
      IF Buffer.FIND('+') THEN BEGIN
        EXIT(Buffer."Operation No.");
      END ELSE
        EXIT(0);
      //NC PIF001 < DP
    END;

    PROCEDURE GetNumber@1210005(txtNumber@1210000 : Text[100]) : Integer;
    VAR
      txtTempNumber@1210001 : Text[100];
      intPos@1210003 : Integer;
      IntResult@1210002 : Integer;
    BEGIN
      //NC PIF001.3 > DP
      txtTempNumber := txtNumber;
      WHILE (STRPOS(txtTempNumber, ' ') <> 0) DO BEGIN
        intPos := STRPOS(txtTempNumber, ' ');
        txtTempNumber := COPYSTR(txtTempNumber, 1, intPos-1) + COPYSTR(txtTempNumber, intPos+1);
      END;
      IF EVALUATE(IntResult, txtTempNumber) THEN
        EXIT(IntResult);
      WHILE (STRPOS(txtTempNumber, ',') <> 0) DO BEGIN
        intPos := STRPOS(txtTempNumber,',');
        txtTempNumber := COPYSTR(txtTempNumber, 1, intPos-1) + COPYSTR(txtTempNumber, intPos+1);
      END;
      IF EVALUATE(IntResult, txtTempNumber) THEN
        EXIT(IntResult)
      ELSE
        EXIT(0);
      //NC PIF001.3 < DP
    END;

    BEGIN
    END.
  }
  RDLDATA
  {
  }
}

