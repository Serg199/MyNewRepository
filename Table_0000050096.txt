OBJECT Table 50096 Agreement Detail
{
  OBJECT-PROPERTIES
  {
    Date=23.05.17;
    Time=18:35:43;
    Modified=Yes;
    Version List=NOS-26;
  }
  PROPERTIES
  {
    OnInsert=BEGIN
               CASE "Source Type" OF
                 "Source Type"::Customer: BEGIN
                   CustomerAgreement.GET("Source No.", "Agreement No.");
                   CustomerAgreement.TESTFIELD("Agreement Type",CustomerAgreement."Agreement Type"::Loans);
                   "Currency Code" := CustomerAgreement."Currency Code";
                 END;
                 "Source Type"::Vendor: BEGIN
                   VendorAgreement.GET("Source No.", "Agreement No.");
                   VendorAgreement.TESTFIELD("Agreement Type",VendorAgreement."Agreement Type"::Loans);
                   "Currency Code" := VendorAgreement."Currency Code";
                 END;
               END;

               SynchroniseIt(1); // TD BMN 23.11.2012 NCS-712
             END;

    OnModify=BEGIN
               SynchroniseIt(1); // TD BMN 23.11.2012 NCS-712
             END;

    OnDelete=BEGIN
               //NC MLN09.2 > DP
               CASE "Source Type" OF
                 "Source Type"::Customer: BEGIN
                   CustLedgEntry.RESET;
                   CustLedgEntry.SETRANGE("Customer No.","Source No.");
                   CustLedgEntry.SETRANGE("Agreement No.","Agreement No.");
                   CustLedgEntry.SETRANGE("Agreement Condition No.","Condition No.");
                   IF CustLedgEntry.FINDFIRST THEN
                     ERROR(Text001);
                 END;
                 "Source Type"::Vendor: BEGIN
                   VendLedgEntry.RESET;
                   VendLedgEntry.SETRANGE("Vendor No.","Source No.");
                   VendLedgEntry.SETRANGE("Agreement No.","Agreement No.");
                   VendLedgEntry.SETRANGE("Agreement Condition No.","Condition No.");
                   IF VendLedgEntry.FINDFIRST THEN
                     ERROR(Text001);
                 END;
               END;

               AgreementSchedule.RESET;
               AgreementSchedule.SETRANGE("Source Type","Source Type");
               AgreementSchedule.SETRANGE("Source No.","Source No.");
               AgreementSchedule.SETRANGE("Agreement No.","Agreement No.");
               AgreementSchedule.SETRANGE("Agreement Condition No.","Condition No.");
               AgreementSchedule.DELETEALL;
               //NC MLN09.2 < DP
             END;

    CaptionML=[ENU=Agreement Details;
               RUS=Договор Условия];
    LookupPageID=Page50175;
  }
  FIELDS
  {
    { 1   ;   ;Source Type         ;Option        ;CaptionML=[ENU=Source Type;
                                                              RUS=Источник Тип];
                                                   OptionCaptionML=[ENU=Customer,Vendor;
                                                                    RUS=Клиент,Поставщик];
                                                   OptionString=Customer,Vendor }
    { 10  ;   ;Source No.          ;Code20        ;TableRelation=IF (Source Type=CONST(Customer)) Customer.No.
                                                                 ELSE IF (Source Type=CONST(Vendor)) Vendor.No.;
                                                   CaptionML=[ENU=Source No.;
                                                              RUS=Источник Но.] }
    { 20  ;   ;Agreement No.       ;Code20        ;TableRelation=IF (Source Type=CONST(Customer)) "Customer Agreement".No. WHERE (Customer No.=FIELD(Source No.))
                                                                 ELSE IF (Source Type=CONST(Vendor)) "Vendor Agreement".No. WHERE (Vendor No.=FIELD(Source No.));
                                                   CaptionML=[ENU=Agreement No.;
                                                              RUS=Договор Но.] }
    { 25  ;   ;Agreement Type      ;Option        ;CaptionML=[ENU=Agreement Type;
                                                              RUS=Договор Тип];
                                                   OptionCaptionML=[ENU=Standard,Trade,Loans;
                                                                    RUS=Стандартный,Торговый,Кредиты и Займы];
                                                   OptionString=Standard,Trade,Loans;
                                                   Description=NC TR198 DP }
    { 30  ;   ;Condition No.       ;Integer       ;CaptionML=[ENU=Condition No.;
                                                              RUS=Условие Но.] }
    { 35  ;   ;Use Default         ;Boolean       ;CaptionML=[ENU=Use Default;
                                                              RUS=Используется по умолчанию];
                                                   Description=MLN09.4 }
    { 40  ;   ;Condition Type      ;Option        ;CaptionML=[ENU=Condition Type;
                                                              RUS=Тип Условия];
                                                   OptionCaptionML=[ENU=New,Change;
                                                                    RUS=Новое,Изменение];
                                                   OptionString=New,Change }
    { 50  ;   ;Action Date         ;Date          ;CaptionML=[ENU=Action Date;
                                                              RUS=Дата Действия] }
    { 60  ;   ;Finish Date         ;Date          ;CaptionML=[ENU=Finish Date;
                                                              RUS=Дата Окончания] }
    { 65  ;   ;Posting Group       ;Code10        ;TableRelation=IF (Source Type=CONST(Customer)) "Customer Posting Group"
                                                                 ELSE IF (Source Type=CONST(Vendor)) "Vendor Posting Group";
                                                   CaptionML=[ENU=Posting Group;
                                                              RUS=Учетная Группа] }
    { 70  ;   ;Currency Code       ;Code10        ;TableRelation=Currency;
                                                   CaptionML=[ENU=Currency Code;
                                                              RUS=Код Валюты] }
    { 80  ;   ;Amount              ;Decimal       ;CaptionML=[ENU=Amount;
                                                              RUS=Сумма] }
    { 90  ;   ;Quant.Days in Year  ;Option        ;CaptionML=[ENU=Quant.Days in Year;
                                                              RUS=Кол-во Дней в Году];
                                                   OptionCaptionML=[ENU=360,365,Fact;
                                                                    RUS=360,365,Факт];
                                                   OptionString=360,365,Fact }
    { 100 ;   ;Interest Calc. Periodicity;Option  ;CaptionML=[ENU=Percent Calc. Periodicity;
                                                              RUS=Периодичность Начисления Процентов];
                                                   OptionCaptionML=[ENU=Month,Quarter,Year;
                                                                    RUS=Месяц,Квартал,Год];
                                                   OptionString=Month,Quarter,Year }
    { 105 ;   ;Interest Calc. Starting Date;Date  ;CaptionML=[ENU=Interest Calc. Starting Date;
                                                              RUS=Проценты Начисление Первая Дата];
                                                   Description=MLN09.4 }
    { 110 ;   ;Interest Rate       ;Decimal       ;CaptionML=[ENU=Interest Rate;
                                                              RUS=Процентная Ставка];
                                                   DecimalPlaces=2:7 }
    { 125 ;   ;Ext. Interest Rate Code;Code20     ;TableRelation="Financial Instrument".No.;
                                                   OnValidate=VAR
                                                                FI@1000000001 : Record 50021;
                                                                FIType@1000000000 : Record 50051;
                                                              BEGIN
                                                                //NC MLN06 > DP
                                                                IF FI.GET("Ext. Interest Rate Code") THEN
                                                                  IF FIType.GET(FI."Type FI") THEN
                                                                    FIType.TESTFIELD("Loan Ext. Interest Rate",TRUE);
                                                                //NC MLN06 < DP
                                                              END;

                                                   OnLookup=VAR
                                                              FI@1000000000 : Record 50021;
                                                              FIType@1000000001 : Record 50051;
                                                              FITypeFilters@1000000002 : Text[1024];
                                                            BEGIN
                                                              //NC MLN06 > DP
                                                              FITypeFilters :='';
                                                              FIType.RESET;
                                                              FIType.SETRANGE("Loan Ext. Interest Rate",TRUE);
                                                              IF FIType.FINDSET THEN
                                                                REPEAT
                                                                  IF FITypeFilters ='' THEN
                                                                    FITypeFilters := FIType.Code
                                                                  ELSE
                                                                    FITypeFilters := FITypeFilters +'|'+ FIType.Code;
                                                                UNTIL FIType.NEXT=0;

                                                              FI.RESET;
                                                              IF FITypeFilters<>'' THEN
                                                                FI.SETFILTER("Type FI",FITypeFilters);
                                                              IF "Ext. Interest Rate Code"<>'' THEN
                                                                IF FI.GET("Ext. Interest Rate Code") THEN;

                                                              IF PAGE.RUNMODAL(0, FI) = ACTION::LookupOK THEN
                                                                "Ext. Interest Rate Code" := FI."No.";
                                                              //NC MLN06 < DP
                                                            END;

                                                   CaptionML=[ENU=Ext. Interest Rate Code;
                                                              RUS=Внешний Индекс Код] }
    { 130 ;   ;Fix Ext. Interest Rate Date;Date   ;CaptionML=[ENU=Fix Ext. Interest Rate Date;
                                                              RUS=Фикс. Внеш. Индекс Дата] }
    { 140 ;   ;Interest Rate Type  ;Option        ;CaptionML=[ENU=Interest Rate Type;
                                                              RUS=Тип Процентной Ставки];
                                                   OptionCaptionML=[ENU=Simple,Fix.Ext.+Simple,Variable Ext.,Complex;
                                                                    RUS=Простой %,Фикс.Внеш.%+Простой%,Перемен.Внеш.%,Сложный %];
                                                   OptionString=Simple,Fix.Ext.+Simple,Variable Ext.,Complex }
    { 145 ;   ;Accrued Interest Amount;Decimal    ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Agreement Schedule".Amount WHERE (Source Type=FIELD(Source Type),
                                                                                                      Source No.=FIELD(Source No.),
                                                                                                      Agreement No.=FIELD(Agreement No.),
                                                                                                      Agreement Condition No.=FIELD(Condition No.),
                                                                                                      Date=FIELD(Date Filter)));
                                                   CaptionML=[ENU=Accrued Interest Amount;
                                                              RUS=Сумма Начисл. Процентов] }
    { 150 ;   ;Time to Run         ;Option        ;CaptionML=[ENU=Time to Run;
                                                              RUS=Срок Погашения];
                                                   OptionCaptionML=[ENU=Month,Quarter,Year;
                                                                    RUS=Месяц,Квартал,Год];
                                                   OptionString=Month,Quarter,Year }
    { 160 ;   ;Settlement Date     ;Date          ;CaptionML=[ENU=Settlement Date;
                                                              RUS=Дата Погашения] }
    { 170 ;   ;Blocked             ;Boolean       ;CaptionML=[ENU=Blocked;
                                                              RUS=Блокировка] }
    { 171 ;   ;Agreement Action    ;Option        ;OnValidate=BEGIN
                                                                IF "Agreement Action"<>xRec."Agreement Action" THEN
                                                                  "Condition Action" := "Condition Action"::" ";
                                                                IF "Agreement Action"="Agreement Action"::" " THEN
                                                                  "Condition Action" := "Condition Action"::" ";
                                                              END;

                                                   CaptionML=[ENU=Agreement Action;
                                                              RUS=Договор Действие];
                                                   OptionCaptionML=[ENU=Skip,Create New,Use Current;
                                                                    RUS=Пропустить,Создать Новый,Использовать Текущий];
                                                   OptionString=[ ,Create,Use] }
    { 172 ;   ;Changed by Source No.;Code20       ;TableRelation=IF (Source Type=CONST(Customer)) Customer.No.
                                                                 ELSE IF (Source Type=CONST(Vendor)) Vendor.No.;
                                                   CaptionML=[ENU=Changed by Source No.;
                                                              RUS=Изменено Источник Но.] }
    { 173 ;   ;Condition Action    ;Option        ;CaptionML=[ENU=Condition Action;
                                                              RUS=Условие Действие];
                                                   OptionCaptionML=[ENU=Skip,Create,Use;
                                                                    RUS=Пропустить,Создать,Использовать];
                                                   OptionString=[ ,Create,Use] }
    { 175 ;   ;Changed by Agreement No.;Code20    ;TableRelation=IF (Source Type=CONST(Customer)) "Customer Agreement".No. WHERE (Customer No.=FIELD(Source No.))
                                                                 ELSE IF (Source Type=CONST(Vendor)) "Vendor Agreement".No. WHERE (Vendor No.=FIELD(Source No.));
                                                   CaptionML=[ENU=Changed by Agreement No.;
                                                              RUS=Изменено Договор Но.] }
    { 180 ;   ;Changed by Condition No.;Integer   ;TableRelation="Agreement Detail"."Condition No." WHERE (Source Type=FIELD(Source Type),
                                                                                                           Source No.=FIELD(Source No.),
                                                                                                           Agreement No.=FIELD(Changed by Agreement No.));
                                                   CaptionML=[ENU=Changed Condition No.;
                                                              RUS=Изменено Условием Но.] }
    { 185 ;   ;Changed Condition No.;Integer      ;TableRelation=IF (Condition Type=CONST(Change)) "Agreement Detail"."Condition No." WHERE (Source Type=FIELD(Source Type),
                                                                                                                                             Source No.=FIELD(Source No.),
                                                                                                                                             Agreement No.=FIELD(Changed by Agreement No.));
                                                   CaptionML=[ENU=Changed by Condition No.;
                                                              RUS=Измененное Условие Но.] }
    { 190 ;   ;Calculation Processed;Boolean      ;CaptionML=[ENU=Calculation Processed;
                                                              RUS=Начисление Обработано] }
    { 200 ;   ;Recalc Charge       ;Boolean       ;CaptionML=[ENU=Recalc Charge;
                                                              RUS=Пересчет Начисления] }
    { 201 ;   ;Recalc Paying Off   ;Boolean       ;CaptionML=[ENU=Recalc Paying Off;
                                                              RUS=Пересчет Погашения] }
    { 300 ;   ;Cust. Principal Balance;Decimal    ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Detailed Cust. Ledg. Entry".Amount WHERE (Customer No.=FIELD(Source No.),
                                                                                                              Agreement No.=FIELD(Agreement No.),
                                                                                                              Agreement Condition No.=FIELD(Condition No.),
                                                                                                              Amount Type=CONST(Principal),
                                                                                                              Posting Date=FIELD(UPPERLIMIT(Date Filter)),
                                                                                                              Initial Entry Global Dim. 1=FIELD(Global Dimension 1 Filter),
                                                                                                              Initial Entry Global Dim. 2=FIELD(Global Dimension 2 Filter)));
                                                   CaptionML=[ENU=Cust. Principal Balance;
                                                              RUS=Клиент Задолженность по Телу];
                                                   Editable=No }
    { 301 ;   ;Cust. Principal Debit Amount;Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Detailed Cust. Ledg. Entry"."Debit Amount" WHERE (Customer No.=FIELD(Source No.),
                                                                                                                      Agreement No.=FIELD(Agreement No.),
                                                                                                                      Agreement Condition No.=FIELD(Condition No.),
                                                                                                                      Amount Type=CONST(Principal),
                                                                                                                      Posting Date=FIELD(Date Filter),
                                                                                                                      Initial Entry Global Dim. 1=FIELD(Global Dimension 1 Filter),
                                                                                                                      Initial Entry Global Dim. 2=FIELD(Global Dimension 2 Filter)));
                                                   CaptionML=RUS=Клиент Дебет Оборот по Телу;
                                                   Description=TDAPCOC-119;
                                                   Editable=No }
    { 302 ;   ;Cust. Principal Credit Amount;Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Detailed Cust. Ledg. Entry"."Credit Amount" WHERE (Customer No.=FIELD(Source No.),
                                                                                                                       Agreement No.=FIELD(Agreement No.),
                                                                                                                       Agreement Condition No.=FIELD(Condition No.),
                                                                                                                       Amount Type=CONST(Principal),
                                                                                                                       Posting Date=FIELD(Date Filter),
                                                                                                                       Initial Entry Global Dim. 1=FIELD(Global Dimension 1 Filter),
                                                                                                                       Initial Entry Global Dim. 2=FIELD(Global Dimension 2 Filter)));
                                                   CaptionML=RUS=Клиент Кредит Оборот по Телу;
                                                   Description=TDAPCOC-119;
                                                   Editable=No }
    { 310 ;   ;Cust. Principal Balance (LCY);Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Detailed Cust. Ledg. Entry"."Amount (LCY)" WHERE (Customer No.=FIELD(Source No.),
                                                                                                                      Agreement No.=FIELD(Agreement No.),
                                                                                                                      Agreement Condition No.=FIELD(Condition No.),
                                                                                                                      Amount Type=CONST(Principal),
                                                                                                                      Posting Date=FIELD(UPPERLIMIT(Date Filter)),
                                                                                                                      Initial Entry Global Dim. 1=FIELD(Global Dimension 1 Filter),
                                                                                                                      Initial Entry Global Dim. 2=FIELD(Global Dimension 2 Filter)));
                                                   CaptionML=[ENU=Cust. Principal Balance (LCY);
                                                              RUS=Клиент Задолженность по Телу (ВУЧ)];
                                                   Editable=No }
    { 311 ;   ;Cust. Princ. Deb. Amount (LCY);Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Detailed Cust. Ledg. Entry"."Debit Amount (LCY)" WHERE (Customer No.=FIELD(Source No.),
                                                                                                                            Agreement No.=FIELD(Agreement No.),
                                                                                                                            Agreement Condition No.=FIELD(Condition No.),
                                                                                                                            Amount Type=CONST(Principal),
                                                                                                                            Posting Date=FIELD(Date Filter),
                                                                                                                            Initial Entry Global Dim. 1=FIELD(Global Dimension 1 Filter),
                                                                                                                            Initial Entry Global Dim. 2=FIELD(Global Dimension 2 Filter)));
                                                   CaptionML=[ENU=Cust. Principal Balance (LCY);
                                                              RUS=Клиент Дебет Оборот Телу (ВУЧ)];
                                                   Description=TDAPCOC-119;
                                                   Editable=No }
    { 312 ;   ;Cust. Princ. Cr. Amount (LCY);Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Detailed Cust. Ledg. Entry"."Credit Amount (LCY)" WHERE (Customer No.=FIELD(Source No.),
                                                                                                                             Agreement No.=FIELD(Agreement No.),
                                                                                                                             Agreement Condition No.=FIELD(Condition No.),
                                                                                                                             Amount Type=CONST(Principal),
                                                                                                                             Posting Date=FIELD(Date Filter),
                                                                                                                             Initial Entry Global Dim. 1=FIELD(Global Dimension 1 Filter),
                                                                                                                             Initial Entry Global Dim. 2=FIELD(Global Dimension 2 Filter)));
                                                   CaptionML=[ENU=Cust. Principal Balance (LCY);
                                                              RUS=Клиент Кредит Оборот Телу (ВУЧ)];
                                                   Description=TDAPCOC-119;
                                                   Editable=No }
    { 320 ;   ;Cust. Interest Balance;Decimal     ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Detailed Cust. Ledg. Entry".Amount WHERE (Customer No.=FIELD(Source No.),
                                                                                                              Agreement No.=FIELD(Agreement No.),
                                                                                                              Agreement Condition No.=FIELD(Condition No.),
                                                                                                              Amount Type=CONST(Interest),
                                                                                                              Posting Date=FIELD(UPPERLIMIT(Date Filter)),
                                                                                                              Initial Entry Global Dim. 1=FIELD(Global Dimension 1 Filter),
                                                                                                              Initial Entry Global Dim. 2=FIELD(Global Dimension 2 Filter)));
                                                   CaptionML=[ENU=Cust. Interest Balance;
                                                              RUS=Клиент Задолженность по Процентам];
                                                   Editable=No }
    { 321 ;   ;Cust. Interest Debit Amount;Decimal;FieldClass=FlowField;
                                                   CalcFormula=Sum("Detailed Cust. Ledg. Entry"."Debit Amount" WHERE (Customer No.=FIELD(Source No.),
                                                                                                                      Agreement No.=FIELD(Agreement No.),
                                                                                                                      Agreement Condition No.=FIELD(Condition No.),
                                                                                                                      Amount Type=CONST(Interest),
                                                                                                                      Posting Date=FIELD(Date Filter),
                                                                                                                      Initial Entry Global Dim. 1=FIELD(Global Dimension 1 Filter),
                                                                                                                      Initial Entry Global Dim. 2=FIELD(Global Dimension 2 Filter)));
                                                   CaptionML=[ENU=Cust. Interest Balance;
                                                              RUS=Клиент Дебет Оборот по Процентам];
                                                   Description=TDAPCOC-119;
                                                   Editable=No }
    { 322 ;   ;Cust. Interest Credit Amount;Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Detailed Cust. Ledg. Entry"."Credit Amount" WHERE (Customer No.=FIELD(Source No.),
                                                                                                                       Agreement No.=FIELD(Agreement No.),
                                                                                                                       Agreement Condition No.=FIELD(Condition No.),
                                                                                                                       Amount Type=CONST(Interest),
                                                                                                                       Posting Date=FIELD(Date Filter),
                                                                                                                       Initial Entry Global Dim. 1=FIELD(Global Dimension 1 Filter),
                                                                                                                       Initial Entry Global Dim. 2=FIELD(Global Dimension 2 Filter)));
                                                   CaptionML=[ENU=Cust. Interest Balance;
                                                              RUS=Клиент Кредит Оборот по Процентам];
                                                   Description=TDAPCOC-119;
                                                   Editable=No }
    { 330 ;   ;Cust. Interest Balance (LCY);Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Detailed Cust. Ledg. Entry"."Amount (LCY)" WHERE (Customer No.=FIELD(Source No.),
                                                                                                                      Agreement No.=FIELD(Agreement No.),
                                                                                                                      Agreement Condition No.=FIELD(Condition No.),
                                                                                                                      Amount Type=CONST(Interest),
                                                                                                                      Posting Date=FIELD(UPPERLIMIT(Date Filter)),
                                                                                                                      Initial Entry Global Dim. 1=FIELD(Global Dimension 1 Filter),
                                                                                                                      Initial Entry Global Dim. 2=FIELD(Global Dimension 2 Filter)));
                                                   CaptionML=[ENU=Cust. Interest Balance (LCY);
                                                              RUS=Клиент Задолженность по Процентам(ВУЧ)];
                                                   Editable=No }
    { 331 ;   ;Cust. Int. Dt. Amount (LCY);Decimal;FieldClass=FlowField;
                                                   CalcFormula=Sum("Detailed Cust. Ledg. Entry"."Debit Amount (LCY)" WHERE (Customer No.=FIELD(Source No.),
                                                                                                                            Agreement No.=FIELD(Agreement No.),
                                                                                                                            Agreement Condition No.=FIELD(Condition No.),
                                                                                                                            Amount Type=CONST(Interest),
                                                                                                                            Posting Date=FIELD(Date Filter),
                                                                                                                            Initial Entry Global Dim. 1=FIELD(Global Dimension 1 Filter),
                                                                                                                            Initial Entry Global Dim. 2=FIELD(Global Dimension 2 Filter)));
                                                   CaptionML=[ENU=Cust. Interest Balance (LCY);
                                                              RUS=Клиент Дебет Оборот по Процентам (ВУЧ)];
                                                   Description=TDAPCOC-119;
                                                   Editable=No }
    { 332 ;   ;Cust. Int. Cr. Amount (LCY);Decimal;FieldClass=FlowField;
                                                   CalcFormula=Sum("Detailed Cust. Ledg. Entry"."Credit Amount (LCY)" WHERE (Customer No.=FIELD(Source No.),
                                                                                                                             Agreement No.=FIELD(Agreement No.),
                                                                                                                             Agreement Condition No.=FIELD(Condition No.),
                                                                                                                             Amount Type=CONST(Interest),
                                                                                                                             Posting Date=FIELD(Date Filter),
                                                                                                                             Initial Entry Global Dim. 1=FIELD(Global Dimension 1 Filter),
                                                                                                                             Initial Entry Global Dim. 2=FIELD(Global Dimension 2 Filter)));
                                                   CaptionML=[ENU=Cust. Interest Balance (LCY);
                                                              RUS=Клиент Кредит Оборот по Процентам (ВУЧ)];
                                                   Description=TDAPCOC-119;
                                                   Editable=No }
    { 350 ;   ;Vendor Principal Balance;Decimal   ;FieldClass=FlowField;
                                                   CalcFormula=-Sum("Detailed Vendor Ledg. Entry".Amount WHERE (Vendor No.=FIELD(Source No.),
                                                                                                                Agreement No.=FIELD(Agreement No.),
                                                                                                                Agreement Condition No.=FIELD(Condition No.),
                                                                                                                Amount Type=CONST(Principal),
                                                                                                                Posting Date=FIELD(UPPERLIMIT(Date Filter)),
                                                                                                                Initial Entry Global Dim. 1=FIELD(Global Dimension 1 Filter),
                                                                                                                Initial Entry Global Dim. 2=FIELD(Global Dimension 2 Filter)));
                                                   CaptionML=[ENU=Vendor Principal Balance;
                                                              RUS=Поставщик Задолженность по Телу];
                                                   Editable=No }
    { 351 ;   ;Vendor Principal Debit Amount;Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=-Sum("Detailed Vendor Ledg. Entry"."Debit Amount" WHERE (Vendor No.=FIELD(Source No.),
                                                                                                                        Agreement No.=FIELD(Agreement No.),
                                                                                                                        Agreement Condition No.=FIELD(Condition No.),
                                                                                                                        Amount Type=CONST(Principal),
                                                                                                                        Posting Date=FIELD(Date Filter),
                                                                                                                        Initial Entry Global Dim. 1=FIELD(Global Dimension 1 Filter),
                                                                                                                        Initial Entry Global Dim. 2=FIELD(Global Dimension 2 Filter)));
                                                   CaptionML=RUS=Пост. Дебет Оборот по Телу;
                                                   Description=TDAPCOC-119;
                                                   Editable=No }
    { 352 ;   ;Vendor Principal Credit Amount;Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=-Sum("Detailed Vendor Ledg. Entry"."Credit Amount" WHERE (Vendor No.=FIELD(Source No.),
                                                                                                                         Agreement No.=FIELD(Agreement No.),
                                                                                                                         Agreement Condition No.=FIELD(Condition No.),
                                                                                                                         Amount Type=CONST(Principal),
                                                                                                                         Posting Date=FIELD(Date Filter),
                                                                                                                         Initial Entry Global Dim. 1=FIELD(Global Dimension 1 Filter),
                                                                                                                         Initial Entry Global Dim. 2=FIELD(Global Dimension 2 Filter)));
                                                   CaptionML=RUS=Пост. Кредит Оборот по Телу;
                                                   Description=TDAPCOC-119;
                                                   Editable=No }
    { 360 ;   ;Vendor Principal Balance (LCY);Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=-Sum("Detailed Vendor Ledg. Entry"."Amount (LCY)" WHERE (Vendor No.=FIELD(Source No.),
                                                                                                                        Agreement No.=FIELD(Agreement No.),
                                                                                                                        Agreement Condition No.=FIELD(Condition No.),
                                                                                                                        Amount Type=CONST(Principal),
                                                                                                                        Posting Date=FIELD(UPPERLIMIT(Date Filter)),
                                                                                                                        Initial Entry Global Dim. 1=FIELD(Global Dimension 1 Filter),
                                                                                                                        Initial Entry Global Dim. 2=FIELD(Global Dimension 2 Filter)));
                                                   CaptionML=[ENU=Vendor Principal Balance (LCY);
                                                              RUS=Поставщик Задолженность по Телу (ВУЧ)];
                                                   Editable=No }
    { 361 ;   ;Vend. Princ. Deb. Amount (LCY);Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=-Sum("Detailed Vendor Ledg. Entry"."Debit Amount (LCY)" WHERE (Vendor No.=FIELD(Source No.),
                                                                                                                              Agreement No.=FIELD(Agreement No.),
                                                                                                                              Agreement Condition No.=FIELD(Condition No.),
                                                                                                                              Amount Type=CONST(Principal),
                                                                                                                              Posting Date=FIELD(Date Filter),
                                                                                                                              Initial Entry Global Dim. 1=FIELD(Global Dimension 1 Filter),
                                                                                                                              Initial Entry Global Dim. 2=FIELD(Global Dimension 2 Filter)));
                                                   CaptionML=RUS=Пост. Дебет Оборот по Телу (ВУЧ);
                                                   Description=TDAPCOC-119;
                                                   Editable=No }
    { 362 ;   ;Vend. Princ. Cr. Amount (LCY);Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=-Sum("Detailed Vendor Ledg. Entry"."Credit Amount (LCY)" WHERE (Vendor No.=FIELD(Source No.),
                                                                                                                               Agreement No.=FIELD(Agreement No.),
                                                                                                                               Agreement Condition No.=FIELD(Condition No.),
                                                                                                                               Amount Type=CONST(Principal),
                                                                                                                               Posting Date=FIELD(Date Filter),
                                                                                                                               Initial Entry Global Dim. 1=FIELD(Global Dimension 1 Filter),
                                                                                                                               Initial Entry Global Dim. 2=FIELD(Global Dimension 2 Filter)));
                                                   CaptionML=RUS=Пост. Кредит Оборот по Телу (ВУЧ);
                                                   Description=TDAPCOC-119;
                                                   Editable=No }
    { 370 ;   ;Vendor Interest Balance;Decimal    ;FieldClass=FlowField;
                                                   CalcFormula=-Sum("Detailed Vendor Ledg. Entry".Amount WHERE (Vendor No.=FIELD(Source No.),
                                                                                                                Agreement No.=FIELD(Agreement No.),
                                                                                                                Agreement Condition No.=FIELD(Condition No.),
                                                                                                                Amount Type=CONST(Interest),
                                                                                                                Posting Date=FIELD(UPPERLIMIT(Date Filter)),
                                                                                                                Initial Entry Global Dim. 1=FIELD(Global Dimension 1 Filter),
                                                                                                                Initial Entry Global Dim. 2=FIELD(Global Dimension 2 Filter)));
                                                   CaptionML=[ENU=Vendor Interest Balance;
                                                              RUS=Поставщик Задолженность по Процентам];
                                                   Editable=No }
    { 371 ;   ;Vendor Interest Debit Amount;Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=-Sum("Detailed Vendor Ledg. Entry"."Debit Amount" WHERE (Vendor No.=FIELD(Source No.),
                                                                                                                        Agreement No.=FIELD(Agreement No.),
                                                                                                                        Agreement Condition No.=FIELD(Condition No.),
                                                                                                                        Amount Type=CONST(Interest),
                                                                                                                        Posting Date=FIELD(Date Filter),
                                                                                                                        Initial Entry Global Dim. 1=FIELD(Global Dimension 1 Filter),
                                                                                                                        Initial Entry Global Dim. 2=FIELD(Global Dimension 2 Filter)));
                                                   CaptionML=[ENU=Cust. Interest Balance;
                                                              RUS=Пост. Дебет Оборот по Процентам];
                                                   Description=TDAPCOC-119;
                                                   Editable=No }
    { 372 ;   ;Vendor Interest Credit Amount;Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=-Sum("Detailed Vendor Ledg. Entry"."Credit Amount" WHERE (Vendor No.=FIELD(Source No.),
                                                                                                                         Agreement No.=FIELD(Agreement No.),
                                                                                                                         Agreement Condition No.=FIELD(Condition No.),
                                                                                                                         Amount Type=CONST(Interest),
                                                                                                                         Posting Date=FIELD(Date Filter),
                                                                                                                         Initial Entry Global Dim. 1=FIELD(Global Dimension 1 Filter),
                                                                                                                         Initial Entry Global Dim. 2=FIELD(Global Dimension 2 Filter)));
                                                   CaptionML=[ENU=Cust. Interest Balance;
                                                              RUS=Пост. Кредит Оборот по Процентам];
                                                   Description=TDAPCOC-119;
                                                   Editable=No }
    { 380 ;   ;Vendor Interest Balance (LCY);Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=-Sum("Detailed Vendor Ledg. Entry"."Amount (LCY)" WHERE (Vendor No.=FIELD(Source No.),
                                                                                                                        Agreement No.=FIELD(Agreement No.),
                                                                                                                        Agreement Condition No.=FIELD(Condition No.),
                                                                                                                        Amount Type=CONST(Interest),
                                                                                                                        Posting Date=FIELD(UPPERLIMIT(Date Filter)),
                                                                                                                        Initial Entry Global Dim. 1=FIELD(Global Dimension 1 Filter),
                                                                                                                        Initial Entry Global Dim. 2=FIELD(Global Dimension 2 Filter)));
                                                   CaptionML=[ENU=Vendor Interest Balance (LCY);
                                                              RUS=Поставщик Задолженность по Процентам (ВУЧ)];
                                                   Editable=No }
    { 381 ;   ;Vend. Int. Debit Amount (LCY);Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=-Sum("Detailed Vendor Ledg. Entry"."Debit Amount (LCY)" WHERE (Vendor No.=FIELD(Source No.),
                                                                                                                              Agreement No.=FIELD(Agreement No.),
                                                                                                                              Agreement Condition No.=FIELD(Condition No.),
                                                                                                                              Amount Type=CONST(Interest),
                                                                                                                              Posting Date=FIELD(Date Filter),
                                                                                                                              Initial Entry Global Dim. 1=FIELD(Global Dimension 1 Filter),
                                                                                                                              Initial Entry Global Dim. 2=FIELD(Global Dimension 2 Filter)));
                                                   CaptionML=[ENU=Cust. Interest Balance;
                                                              RUS=Пост. Дебет Оборот по Процентам (ВУЧ)];
                                                   Description=TDAPCOC-119;
                                                   Editable=No }
    { 382 ;   ;Vend. Int. Credit Amount (LCY);Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=-Sum("Detailed Vendor Ledg. Entry"."Credit Amount (LCY)" WHERE (Vendor No.=FIELD(Source No.),
                                                                                                                               Agreement No.=FIELD(Agreement No.),
                                                                                                                               Agreement Condition No.=FIELD(Condition No.),
                                                                                                                               Amount Type=CONST(Interest),
                                                                                                                               Posting Date=FIELD(Date Filter),
                                                                                                                               Initial Entry Global Dim. 1=FIELD(Global Dimension 1 Filter),
                                                                                                                               Initial Entry Global Dim. 2=FIELD(Global Dimension 2 Filter)));
                                                   CaptionML=[ENU=Cust. Interest Balance;
                                                              RUS=Пост. Кредит Оборот по Процентам (ВУЧ)];
                                                   Description=TDAPCOC-119;
                                                   Editable=No }
    { 400 ;   ;Date Filter         ;Date          ;FieldClass=FlowFilter;
                                                   CaptionML=[ENU=Date Filter;
                                                              RUS=Дата Фильтр] }
    { 410 ;   ;Global Dimension 1 Filter;Code20   ;FieldClass=FlowFilter;
                                                   TableRelation="Dimension Value".Code WHERE (Global Dimension No.=CONST(1));
                                                   CaptionML=[ENU=Global Dimension 1 Filter;
                                                              RUS=Глобал. Измерение 1 Фильтр];
                                                   CaptionClass='1,3,1' }
    { 420 ;   ;Global Dimension 2 Filter;Code20   ;FieldClass=FlowFilter;
                                                   TableRelation="Dimension Value".Code WHERE (Global Dimension No.=CONST(2));
                                                   CaptionML=[ENU=Global Dimension 2 Filter;
                                                              RUS=Глобал. Измерение 2 Фильтр];
                                                   CaptionClass='1,3,2' }
    { 430 ;   ;Last Change Date    ;DateTime      ;CaptionML=[ENU=Last Change Date;
                                                              RUS=Последнее Изменение Дата] }
    { 431 ;   ;Interest Last Date  ;Date          ;CaptionML=[ENU=Interest Last Date;
                                                              RUS=Проценты Последняя Дата] }
    { 50010;  ;Customer Balance    ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Detailed Cust. Ledg. Entry".Amount WHERE (Customer No.=FIELD(Source No.),
                                                                                                              Agreement No.=FIELD(Agreement No.),
                                                                                                              Agreement Condition No.=FIELD(Condition No.),
                                                                                                              Posting Date=FIELD(UPPERLIMIT(Date Filter)),
                                                                                                              Initial Entry Global Dim. 1=FIELD(Global Dimension 1 Filter),
                                                                                                              Initial Entry Global Dim. 2=FIELD(Global Dimension 2 Filter),
                                                                                                              Customer Posting Group=FIELD(Posting Group Filter)));
                                                   CaptionML=[ENU=Customer Balance;
                                                              RUS=Клиент Баланс];
                                                   Description=NC NCS-1597 }
    { 50011;  ;Vendor Balance      ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=-Sum("Detailed Vendor Ledg. Entry".Amount WHERE (Vendor No.=FIELD(Source No.),
                                                                                                                Agreement No.=FIELD(Agreement No.),
                                                                                                                Agreement Condition No.=FIELD(Condition No.),
                                                                                                                Posting Date=FIELD(UPPERLIMIT(Date Filter)),
                                                                                                                Initial Entry Global Dim. 1=FIELD(Global Dimension 1 Filter),
                                                                                                                Initial Entry Global Dim. 2=FIELD(Global Dimension 2 Filter),
                                                                                                                Vendor Posting Group=FIELD(Posting Group Filter)));
                                                   CaptionML=[ENU=Vendor Balance;
                                                              RUS=Поставщик Баланс];
                                                   Description=NC NCS-1597 }
    { 50012;  ;Posting Group Filter;Code20        ;FieldClass=FlowFilter;
                                                   CaptionML=[ENU=Posting Group Filter;
                                                              RUS=Учётная Группа Фильтр];
                                                   Description=NC NCS-1597 }
  }
  KEYS
  {
    {    ;Source Type,Source No.,Agreement No.,Condition No.;
                                                   Clustered=Yes }
    {    ;Source Type,Source No.,Agreement No.,Changed Condition No. }
    {    ;Source Type,Source No.,Agreement No.,Action Date }
    {    ;Source Type,Source No.,Agreement No.,Use Default }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      VendorAgreement@1000000000 : Record 14901;
      CustomerAgreement@1000000001 : Record 14902;
      AgreementSchedule@1101495000 : Record 50097;
      Text001@1101495002 : TextConst 'ENU=You cannot delete Agreement Detail if you already have ledger entries.;RUS=Невозможно удалить условие договора, для которого уже есть учтенные операции.';
      CustLedgEntry@1101495001 : Record 21;
      VendLedgEntry@1101495003 : Record 25;

    PROCEDURE GetTermLine@1000000008(SourceType@1000000003 : Integer;SourceNo@1000000004 : Code[20];AgreementNo@1000000002 : Code[20];ConditionNo@1000000005 : Integer;VAR IsChanged@1000000006 : Boolean;VAR ChangedByConditionNo@1000000007 : Integer;VAR txtTermFilter@1000000008 : Text[1024]);
    VAR
      AgreementDetail1@1000000000 : Record 50096;
      AgreementDetail2@1000000001 : Record 50096;
    BEGIN
      AgreementDetail1.RESET;
      AgreementDetail1.SETRANGE("Agreement No.",AgreementNo);
      AgreementDetail1.SETRANGE("Source Type",SourceType);
      AgreementDetail1.SETRANGE("Source No.",SourceNo);
      AgreementDetail1.SETRANGE("Changed by Agreement No.",AgreementNo);
      AgreementDetail1.SETRANGE("Changed by Condition No.",ConditionNo);
      IF AgreementDetail1.FINDFIRST THEN BEGIN
        txtTermFilter :=txtTermFilter +'|'+ FORMAT(AgreementDetail1."Condition No.");
        AgreementDetail2.RESET;
        AgreementDetail2.SETRANGE("Agreement No.",AgreementNo);
        AgreementDetail2.SETRANGE("Source Type",SourceType);
        AgreementDetail2.SETRANGE("Source No.",SourceNo);
        AgreementDetail2.SETRANGE("Changed by Agreement No.",AgreementNo);
        AgreementDetail2.SETRANGE("Changed by Condition No.",AgreementDetail1."Condition No.");
        IF AgreementDetail2.FINDFIRST THEN BEGIN
          IsChanged := TRUE;
          ChangedByConditionNo := AgreementDetail2."Condition No.";
        END ELSE
          IsChanged := FALSE;
      END;
    END;

    PROCEDURE GetTermFilter@1000000009(VAR AgreementDetail@1000000003 : Record 50096) : Text[1024];
    VAR
      Changed@1000000000 : Boolean;
      ConditionNo@1000000002 : Integer;
      NextConditionNo@1000000001 : Integer;
      TermFilter@1000000004 : Text[1024];
      ChangedNo@1000000005 : Integer;
    BEGIN
      TermFilter :=FORMAT(AgreementDetail."Condition No.");
      Changed :=TRUE;
      ConditionNo := AgreementDetail."Condition No.";
      REPEAT
        ChangedNo := ChangedNo +1;
        GetTermLine(AgreementDetail."Source Type",
                    AgreementDetail."Source No.",
                    AgreementDetail."Agreement No.",
                    ConditionNo,
                    Changed,
                    NextConditionNo,
                    TermFilter);
        ConditionNo :=NextConditionNo;
      UNTIL (ChangedNo=50) OR (Changed=FALSE);

      IF ConditionNo<>AgreementDetail."Condition No." THEN
        TermFilter :=TermFilter +'|'+ FORMAT(ConditionNo);
      EXIT(TermFilter);
    END;

    PROCEDURE SynchroniseIt@1000000000(Mode@1000000000 : 'Insert,Modify,Delete,Rename');
    VAR
      VendorAgreement@1000000001 : Record 14901;
      CutomerAgreement@1000000002 : Record 14902;
    BEGIN
      // TD BMN 23.11.2012 NCS-712

      IF ("Agreement Type" = "Agreement Type"::Loans) AND ("Condition Type" = "Condition Type"::New) THEN
        CASE "Source Type" OF
          "Source Type"::Customer: BEGIN
                                     CutomerAgreement.GET("Source No.", "Agreement No.");
                                     CutomerAgreement."Interest Rate" := "Interest Rate";
                                     CutomerAgreement."Interest Rate Type" := "Interest Rate Type";
                                     CutomerAgreement.MODIFY(TRUE);
                                   END;
          "Source Type"::Vendor: BEGIN
                                     VendorAgreement.GET("Source No.", "Agreement No.");
                                     VendorAgreement."Interest Rate" := "Interest Rate";
                                     VendorAgreement."Interest Rate Type" := "Interest Rate Type";
                                     VendorAgreement.MODIFY(TRUE);
                                   END;
        END;
    END;

    BEGIN
    {
      NC MLN02 EB создана таблица
      NC MLN09.2 DP Изменение триггера OnDelete, Проверки при удалении, удаление графика начислений
      NC MLN09.4 DP Добавлены поля "Use Default", "Interest Calc. Starting Date"
      TDAPCOC-119>
        Set property OnlyMaxLimit for date filter for flowfield called like *Balance*
        Add Fields
          "Cust. Principal Debit Amount"
          "Cust. Principal Credit Amount"
          "Cust. Princ. Deb. Amount (LCY)"
          "Cust. Princ. Cr. Amount (LCY)"
          "Cust. Interest Debit Amount"
          "Cust. Interest Credit Amount"
          "Cust. Int. Dt. Amount (LCY)"
          "Cust. Int. Cr. Amount (LCY)"
          "Vendor Principal Debit Amount"
          "Vendor Principal Credit Amount"
          "Vend. Princ. Deb. Amount (LCY)"
          "Vend. Princ. Cr. Amount (LCY)"
          "Vendor Interest Debit Amount"
          "Vendor Interest Credit Amount"
          "Vend. Int. Debit Amount (LCY)"
          "Vend. Int. Credit Amount (LCY)"
      TD BMN 23.11.2012 NCS-712 "Интеграция данных из договоров OFF - IFRS"
      NC NCS-1597 USE Добавлены поля Posting Group Filter, Vendor Balance, Customer Balance
    }
    END.
  }
}

