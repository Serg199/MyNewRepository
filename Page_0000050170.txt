OBJECT Page 50170 Agreement Details Turnover
{
  OBJECT-PROPERTIES
  {
    Date=14.08.17;
    Time=11:54:26;
    Modified=Yes;
    Version List=NOS-26;
  }
  PROPERTIES
  {
    CaptionML=[ENU=Agreement Details Turnover;
               RUS=Договор Условия Ведомость];
    SourceTable=Table50096;
    DelayedInsert=Yes;
    PageType=Worksheet;
    OnOpenPage=BEGIN
                 GLSetup.GET; // NC NOS-26 SPA
                 g_recSalesSetup.GET;
                 g_recPurchSetup.GET;

                 //NC NOS-26 > ENK
                 {
                 CurrForm."Cust. Principal Balance".VISIBLE(FALSE);
                 CurrForm."Cust. Principal Balance (LCY)".VISIBLE(FALSE);
                 CurrForm."Cust. Interest Balance".VISIBLE(FALSE);
                 CurrForm."Cust. Interest Balance (LCY)".VISIBLE(FALSE);
                 //TDRAAPCOC-119>
                 CurrForm."Cust. Principal Debit Amount".VISIBLE(FALSE);
                 CurrForm."Cust. Principal Credit Amount".VISIBLE(FALSE);
                 CurrForm."Cust. Princ. Deb. Amount (LCY)".VISIBLE(FALSE);
                 CurrForm."Cust. Princ. Cr. Amount (LCY)".VISIBLE(FALSE);
                 CurrForm."Cust. Interest Debit Amount".VISIBLE(FALSE);
                 CurrForm."Cust. Interest Credit Amount".VISIBLE(FALSE);
                 CurrForm."Cust. Int. Dt. Amount (LCY)".VISIBLE(FALSE);
                 CurrForm."Cust. Int. Cr. Amount (LCY)".VISIBLE(FALSE);
                 CurrForm."Vendor Principal Debit Amount".VISIBLE(TRUE);
                 CurrForm."Vendor Principal Credit Amount".VISIBLE(TRUE);
                 CurrForm."Vend. Princ. Deb. Amount (LCY)".VISIBLE(TRUE);
                 CurrForm."Vend. Princ. Cr. Amount (LCY)".VISIBLE(TRUE);
                 CurrForm."Vendor Interest Debit Amount".VISIBLE(TRUE);
                 CurrForm."Vendor Interest Credit Amount".VISIBLE(TRUE);
                 CurrForm."Vend. Int. Debit Amount (LCY)".VISIBLE(TRUE);
                 CurrForm."Vend. Int. Credit Amount (LCY)".VISIBLE(TRUE);
                 //TDRAAPCOC-119<

                 //NC NCS-1597 > USE
                 CurrForm."Vendor Balance".VISIBLE(TRUE);
                 CurrForm."Vendor Reserve".VISIBLE(TRUE);
                 CurrForm."Customer Balance".VISIBLE(FALSE);
                 CurrForm."Customer Reserve".VISIBLE(FALSE);
                 //NC NCS-1597 < USE

                 CurrForm."Vendor Principal Balance".VISIBLE(TRUE);
                 CurrForm."Vendor Principal Balance (LCY)".VISIBLE(TRUE);
                 CurrForm."Vendor Interest Balance".VISIBLE(TRUE);
                 CurrForm."Vendor Interest Balance (LCY)".VISIBLE(TRUE);
                 }
                 "Cust. Principal Balance VISIBLE" := FALSE;
                 "Cust. Principal Balance (LCY) VISIBLE" := FALSE;
                 "Cust. Interest Balance VISIBLE" := FALSE;
                 "Cust. Interest Balance (LCY) VISIBLE" := FALSE;
                 //TDRAAPCOC-119>
                 "Cust. Principal Debit Amount VISIBLE" := FALSE;
                 "Cust. Principal Credit Amount VISIBLE" := FALSE;
                 "Cust. Princ. Deb. Amount (LCY) VISIBLE" := FALSE;
                 "Cust. Princ. Cr. Amount (LCY) VISIBLE" := FALSE;
                 "Cust. Interest Debit Amount VISIBLE" := FALSE;
                 "Cust. Interest Credit Amount VISIBLE" := FALSE;
                 "Cust. Int. Dt. Amount (LCY) VISIBLE" := FALSE;
                 "Cust. Int. Cr. Amount (LCY) VISIBLE" := FALSE;
                 "Vendor Principal Debit Amount VISIBLE" := TRUE;
                 "Vendor Principal Credit Amount VISIBLE" := TRUE;
                 "Vend. Princ. Deb. Amount (LCY) VISIBLE" := TRUE;
                 "Vend. Princ. Cr. Amount (LCY) VISIBLE" := TRUE;
                 "Vendor Interest Debit Amount VISIBLE" := TRUE;
                 "Vendor Interest Credit Amount VISIBLE" := TRUE;
                 "Vend. Int. Debit Amount (LCY) VISIBLE" := TRUE;
                 "Vend. Int. Credit Amount (LCY) VISIBLE" := TRUE;
                 //TDRAAPCOC-119<

                 //NC NCS-1597 > USE
                 "Vendor Balance VISIBLE" := TRUE;
                 "Vendor Reserve VISIBLE" := TRUE;
                 "Customer Balance VISIBLE" := FALSE;
                 "Customer Reserve VISIBLE" := FALSE;
                 //NC NCS-1597 < USE

                 "Vendor Principal Balance VISIBLE" := TRUE;
                 "Vendor Principal Balance (LCY) VISIBLE" := TRUE;
                 "Vendor Interest Balance VISIBLE" := TRUE;
                 "Vendor Interest Balance (LCY) VISIBLE" := TRUE;
                 //NC NOS-26 < ENK

                 SourceType := SourceType::Vendor;
                 FILTERGROUP(2);
                 SETRANGE("Condition Type","Condition Type"::New);
                 FILTERGROUP(0);
                 SETRANGE("Source Type","Source Type"::Vendor);

                 IF GLPeriodLength = GLPeriodLength::"Accounting Period" THEN
                   FindUserPeriod('')
                 ELSE
                   FindPeriod('');
               END;

    OnAfterGetRecord=BEGIN
                       //TDAPCOC-119>
                       fn_CalculateAmounts;
                     END;

    ActionList=ACTIONS
    {
      { 1101495004;  ;ActionContainer;
                      Name=Agreement Details Turnover;
                      ActionContainerType=ActionItems }
      { 1101495005;1 ;ActionGroup;
                      CaptionML=[ENU=Navigate to;
                                 RUS=Перейти];
                      Image=Setup }
      { 1101495013;2 ;Action    ;
                      Name=Previous Period;
                      CaptionML=[ENU=Previous Period;
                                 RUS=Пред. период];
                      Promoted=Yes;
                      Image=PreviousRecord;
                      PromotedCategory=Process;
                      OnAction=BEGIN
                                 FindPeriod('<=');
                               END;
                                }
      { 1101495012;2 ;Action    ;
                      Name=Today;
                      CaptionML=[ENU=Today;
                                 RUS=Сегодня];
                      Promoted=Yes;
                      Visible=FALSE;
                      Image=Delegate;
                      PromotedCategory=Process;
                      OnAction=BEGIN
                                 "Date Filter" :=  0D;   //workdate
                                 FindPeriod('');
                               END;
                                }
      { 1101495011;2 ;Action    ;
                      Name=Next Period;
                      CaptionML=[ENU=Next Period;
                                 RUS=След. период];
                      Promoted=Yes;
                      Image=NextRecord;
                      PromotedCategory=Process;
                      OnAction=BEGIN
                                 FindPeriod('>=');
                               END;
                                }
      { 1101495003;1 ;ActionGroup;
                      CaptionML=[ENU=Detail;
                                 RUS=Условие];
                      Image=Setup }
      { 1101495025;2 ;Action    ;
                      Name=Card;
                      ShortCutKey=Shift+F5;
                      CaptionML=[ENU=Card;
                                 RUS=Карточка];
                      RunObject=Page 50163;
                      RunPageLink=Source Type=FIELD(Source Type),
                                  Source No.=FIELD(Source No.),
                                  Agreement No.=FIELD(Agreement No.),
                                  Condition No.=FIELD(Condition No.);
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=Card;
                      PromotedCategory=Report }
      { 1101495006;2 ;Action    ;
                      Name=Schedule;
                      ShortCutKey=F9;
                      CaptionML=[ENU=Schedule;
                                 RUS=График];
                      RunObject=Page 50164;
                      RunPageLink=Source Type=FIELD(Source Type),
                                  Source No.=FIELD(Source No.),
                                  Agreement No.=FIELD(Agreement No.),
                                  Agreement Condition No.=FIELD(Condition No.) }
      { 1101495007;2 ;Separator  }
      { 1101495026;2 ;Action    ;
                      Name=Ledger Entries;
                      CaptionML=[ENU=Ledger Entries;
                                 RUS=Учтенные Операции];
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=BankAccountLedger;
                      PromotedCategory=Report;
                      OnAction=BEGIN
                                 CASE "Source Type" OF
                                   "Source Type"::Customer:
                                     BEGIN
                                       CustLedgerEntry.RESET;
                                       CustLedgerEntry.SETRANGE("Customer No.","Source No.");
                                       CustLedgerEntry.SETRANGE("Agreement No.","Agreement No.");
                                       CustLedgerEntry.SETRANGE("Agreement Condition No.","Condition No.");
                                       PAGE.RUN(0,CustLedgerEntry);
                                     END;
                                   "Source Type"::Vendor:
                                     BEGIN
                                       VendLedgerEntry.RESET;
                                       VendLedgerEntry.SETRANGE("Vendor No.","Source No.");
                                       VendLedgerEntry.SETRANGE("Agreement No.","Agreement No.");
                                       VendLedgerEntry.SETRANGE("Agreement Condition No.","Condition No.");
                                       PAGE.RUN(0,VendLedgerEntry);
                                     END;
                                 END;
                               END;
                                }
    }
  }
  CONTROLS
  {
    { 1101495000;0;Container;
                ContainerType=ContentArea }

    { 1101495018;1;Group  ;
                CaptionML=[ENU=Options;
                           RUS=Параметры] }

    { 1101495015;2;Field  ;
                Name=GLPeriodLength;
                CaptionML=[ENU=View by;
                           RUS=Просмотр по];
                OptionCaptionML=[ENU=Day,Week,Month,Quarter,Year,Accounting Period;
                                 RUS=День,Неделя,Месяц,Квартал,Год,Учетный период];
                SourceExpr=GLPeriodLength;
                OnValidate=BEGIN
                             FindPeriod('');
                           END;
                            }

    { 1101495017;2;Field  ;
                Name=Date Filter;
                CaptionML=[ENU=Date Filter;
                           RUS=Дата Фильтр];
                SourceExpr=DateFilter;
                OnValidate=BEGIN
                             //NC NOS-26 > SPA
                             SETFILTER("Date Filter",DateFilter);
                             DateFilter := GETFILTER("Date Filter");
                             CurrPage.UPDATE;
                             //NC NOS-26 < SPA
                           END;
                            }

    { 1101495021;2;Field  ;
                Name=Source Type Filter;
                CaptionML=[ENU=Source Type Filter;
                           RUS=Тип Источника Фильтр];
                OptionCaptionML=[ENU=" ,Customer,Vendor";
                                 RUS=" ,Клиент,Поставщик"];
                DecimalPlaces=0:0;
                SourceExpr=SourceType;
                OnValidate=BEGIN
                             //NC NOS-26 > ENK
                             {
                             // TDRA120830 >
                             CASE SourceType OF
                               SourceType::Customer:
                               BEGIN
                                 CurrForm."Cust. Principal Balance".VISIBLE(TRUE);
                                 CurrForm."Cust. Principal Balance (LCY)".VISIBLE(TRUE);
                                 CurrForm."Cust. Interest Balance".VISIBLE(TRUE);
                                 CurrForm."Cust. Interest Balance (LCY)".VISIBLE(TRUE);
                                 //TDRAAPCOC-119>
                                 CurrForm."Cust. Principal Debit Amount".VISIBLE(TRUE);
                                 CurrForm."Cust. Principal Credit Amount".VISIBLE(TRUE);
                                 CurrForm."Cust. Princ. Deb. Amount (LCY)".VISIBLE(TRUE);
                                 CurrForm."Cust. Princ. Cr. Amount (LCY)".VISIBLE(TRUE);
                                 CurrForm."Cust. Interest Debit Amount".VISIBLE(TRUE);
                                 CurrForm."Cust. Interest Credit Amount".VISIBLE(TRUE);
                                 CurrForm."Cust. Int. Dt. Amount (LCY)".VISIBLE(TRUE);
                                 CurrForm."Cust. Int. Cr. Amount (LCY)".VISIBLE(TRUE);
                                 CurrForm."Vendor Principal Debit Amount".VISIBLE(FALSE);
                                 CurrForm."Vendor Principal Credit Amount".VISIBLE(FALSE);
                                 CurrForm."Vend. Princ. Deb. Amount (LCY)".VISIBLE(FALSE);
                                 CurrForm."Vend. Princ. Cr. Amount (LCY)".VISIBLE(FALSE);
                                 CurrForm."Vendor Interest Debit Amount".VISIBLE(FALSE);
                                 CurrForm."Vendor Interest Credit Amount".VISIBLE(FALSE);
                                 CurrForm."Vend. Int. Debit Amount (LCY)".VISIBLE(FALSE);
                                 CurrForm."Vend. Int. Credit Amount (LCY)".VISIBLE(FALSE);
                                 //TDRAAPCOC-119<
                                 //NC NCS-1597 > USE
                                 CurrForm."Vendor Balance".VISIBLE(FALSE);
                                 CurrForm."Vendor Reserve".VISIBLE(FALSE);
                                 CurrForm."Customer Balance".VISIBLE(TRUE);
                                 CurrForm."Customer Reserve".VISIBLE(TRUE);
                                 //NC NCS-1597 < USE
                                 CurrForm."Vendor Principal Balance".VISIBLE(FALSE);
                                 CurrForm."Vendor Principal Balance (LCY)".VISIBLE(FALSE);
                                 CurrForm."Vendor Interest Balance".VISIBLE(FALSE);
                                 CurrForm."Vendor Interest Balance (LCY)".VISIBLE(FALSE);
                                 SETRANGE("Source Type","Source Type"::Customer);
                               END;
                               SourceType::Vendor:
                               BEGIN
                                 CurrForm."Cust. Principal Balance".VISIBLE(FALSE);
                                 CurrForm."Cust. Principal Balance (LCY)".VISIBLE(FALSE);
                                 CurrForm."Cust. Interest Balance".VISIBLE(FALSE);
                                 CurrForm."Cust. Interest Balance (LCY)".VISIBLE(FALSE);
                                 //TDRAAPCOC-119>
                                 CurrForm."Cust. Principal Debit Amount".VISIBLE(FALSE);
                                 CurrForm."Cust. Principal Credit Amount".VISIBLE(FALSE);
                                 CurrForm."Cust. Princ. Deb. Amount (LCY)".VISIBLE(FALSE);
                                 CurrForm."Cust. Princ. Cr. Amount (LCY)".VISIBLE(FALSE);
                                 CurrForm."Cust. Interest Debit Amount".VISIBLE(FALSE);
                                 CurrForm."Cust. Interest Credit Amount".VISIBLE(FALSE);
                                 CurrForm."Cust. Int. Dt. Amount (LCY)".VISIBLE(FALSE);
                                 CurrForm."Cust. Int. Cr. Amount (LCY)".VISIBLE(FALSE);
                                 CurrForm."Vendor Principal Debit Amount".VISIBLE(TRUE);
                                 CurrForm."Vendor Principal Credit Amount".VISIBLE(TRUE);
                                 CurrForm."Vend. Princ. Deb. Amount (LCY)".VISIBLE(TRUE);
                                 CurrForm."Vend. Princ. Cr. Amount (LCY)".VISIBLE(TRUE);
                                 CurrForm."Vendor Interest Debit Amount".VISIBLE(TRUE);
                                 CurrForm."Vendor Interest Credit Amount".VISIBLE(TRUE);
                                 CurrForm."Vend. Int. Debit Amount (LCY)".VISIBLE(TRUE);
                                 CurrForm."Vend. Int. Credit Amount (LCY)".VISIBLE(TRUE);
                                 //TDRAAPCOC-119<
                                 //NC NCS-1597 > USE
                                 CurrForm."Vendor Balance".VISIBLE(TRUE);
                                 CurrForm."Vendor Reserve".VISIBLE(TRUE);
                                 CurrForm."Customer Balance".VISIBLE(FALSE);
                                 CurrForm."Customer Reserve".VISIBLE(FALSE);
                                 //NC NCS-1597 < USE
                                 CurrForm."Vendor Principal Balance".VISIBLE(TRUE);
                                 CurrForm."Vendor Principal Balance (LCY)".VISIBLE(TRUE);
                                 CurrForm."Vendor Interest Balance".VISIBLE(TRUE);
                                 CurrForm."Vendor Interest Balance (LCY)".VISIBLE(TRUE);
                                 SETRANGE("Source Type","Source Type"::Vendor);
                               END;
                               SourceType::" ":
                               BEGIN
                                 CurrForm."Cust. Principal Balance".VISIBLE(TRUE);
                                 CurrForm."Cust. Principal Balance (LCY)".VISIBLE(TRUE);
                                 CurrForm."Cust. Interest Balance".VISIBLE(TRUE);
                                 CurrForm."Cust. Interest Balance (LCY)".VISIBLE(TRUE);
                                 CurrForm."Vendor Principal Balance".VISIBLE(TRUE);
                                 CurrForm."Vendor Principal Balance (LCY)".VISIBLE(TRUE);
                                 CurrForm."Vendor Interest Balance".VISIBLE(TRUE);
                                 CurrForm."Vendor Interest Balance (LCY)".VISIBLE(TRUE);
                                 //NC NCS-1597 > USE
                                 CurrForm."Vendor Balance".VISIBLE(TRUE);
                                 CurrForm."Vendor Reserve".VISIBLE(TRUE);
                                 CurrForm."Customer Balance".VISIBLE(TRUE);
                                 CurrForm."Customer Reserve".VISIBLE(TRUE);
                                 //NC NCS-1597 < USE
                                 SETRANGE("Source Type");
                               END;
                             END;
                             CurrForm.UPDATE;
                             }
                             SourceTypeFilterOnAfterValidate;
                             //NC NOS-26 < ENK
                           END;
                            }

    { 1101495070;2;Field  ;
                SourceExpr=GlobalDimension1Filter;
                CaptionClass='1,3,1';
                OnValidate=BEGIN
                             //NC NOS-26 > SPA
                             SETFILTER("Global Dimension 1 Filter",GlobalDimension1Filter);
                             CurrPage.UPDATE;
                             //NC NOS-26 < SPA
                           END;

                OnLookup=BEGIN
                           //NC NOS-26 > SPA
                           EXIT(LookUpDimFilter(GLSetup."Global Dimension 1 Code",Text));
                           //NC NOS-26 < SPA
                         END;
                          }

    { 1101495071;2;Field  ;
                SourceExpr=GlobalDimension2Filter;
                CaptionClass='1,3,2';
                OnValidate=BEGIN
                             //NC NOS-26 > SPA
                             SETFILTER("Global Dimension 2 Filter",GlobalDimension2Filter);
                             CurrPage.UPDATE;
                             //NC NOS-26 < SPA
                           END;

                OnLookup=BEGIN
                           //NC NOS-26 > SPA
                           EXIT(LookUpDimFilter(GLSetup."Global Dimension 2 Code",Text));
                           //NC NOS-26 < SPA
                         END;
                          }

    { 1101495001;1;Group  ;
                Name=Group;
                Editable=FALSE;
                GroupType=Repeater }

    { 1101495002;2;Field  ;
                Name=Source Type;
                CaptionML=[ENU=Source Type;
                           RUS=Источник Тип];
                OptionCaptionML=[ENU=Customer,Vendor;
                                 RUS=Клиент,Поставщик];
                SourceExpr="Source Type";
                Visible=false }

    { 1101495008;2;Field  ;
                SourceExpr="Source No." }

    { 1101495009;2;Field  ;
                CaptionML=[ENU=Project Code;
                           RUS=Проект Код];
                SourceExpr=g_codeProject;
                Visible=false }

    { 1101495010;2;Field  ;
                CaptionML=[ENU=Agreement Group;
                           RUS=Договор Группы];
                SourceExpr=g_codeAgrGroup;
                Visible=false }

    { 1101495014;2;Field  ;
                CaptionML=[ENU=Lender No.;
                           RUS=Заимодавец Но.];
                SourceExpr=g_codeLender;
                Visible=false }

    { 1101495016;2;Field  ;
                CaptionML=[ENU=Lender Name;
                           RUS=Заимодавец Название];
                SourceExpr=g_txtLender;
                Visible=false }

    { 1101495019;2;Field  ;
                CaptionML=[ENU=Borrower;
                           RUS=Заемщик];
                SourceExpr=g_codeBorrower;
                Visible=false }

    { 1101495020;2;Field  ;
                CaptionML=[ENU=Borrower Name;
                           RUS=Заемщик Название];
                SourceExpr=g_txtBorrower }

    { 1101495024;2;Field  ;
                CaptionML=[ENU=Agreement Description;
                           RUS=Договор Описание];
                SourceExpr=g_txtAgrDescr;
                Visible=false }

    { 1101495027;2;Field  ;
                CaptionML=[ENU=Agreement Date;
                           RUS=Дата Договора];
                SourceExpr=g_dateAgr;
                Visible=false }

    { 1101495028;2;Field  ;
                CaptionML=[ENU=Agreement Expire Date;
                           RUS=Дата Действия Договора];
                SourceExpr=g_dateExpireAgr;
                Visible=false }

    { 1101495029;2;Field  ;
                CaptionML=[ENU=Agreement Amount;
                           RUS=Договор Сумма];
                SourceExpr=g_decAgrAmount;
                Visible=false }

    { 1101495030;2;Field  ;
                CaptionML=[ENU=Agreement Currency Code;
                           RUS=Договор Код Валюты];
                SourceExpr=g_codeAgrCurrCode;
                Visible=false }

    { 1101495031;2;Field  ;
                SourceExpr="Agreement No." }

    { 1101495032;2;Field  ;
                SourceExpr="Condition No." }

    { 1101495033;2;Field  ;
                SourceExpr="Interest Rate" }

    { 1101495034;2;Field  ;
                SourceExpr="Currency Code" }

    { 1101495035;2;Field  ;
                SourceExpr="Posting Group" }

    { 1101495036;2;Field  ;
                SourceExpr=Blocked }

    { 1101495037;2;Field  ;
                SourceExpr="Accrued Interest Amount" }

    { 1101495038;2;Field  ;
                CaptionML=[ENU=Starting Balance Principal;
                           RUS=Начальное Сальдо Тело];
                SourceExpr=g_decStartingBalancePrinc;
                OnDrillDown=BEGIN
                              //TDAPCOC-119>
                              fn_DrillDown(0);
                            END;
                             }

    { 1101495039;2;Field  ;
                CaptionML=[ENU=Starting Balance Interest;
                           RUS=Начальное Сальдо Процент];
                SourceExpr=g_decStartingBalanceInt;
                OnDrillDown=BEGIN
                              //TDRAAPCOC-119>
                              fn_DrillDown(1);
                            END;
                             }

    { 1101495040;2;Field  ;
                CaptionML=[ENU=Starting Balance Principal (LCY);
                           RUS=Начальное Сальдо Тело (ВУЧ)];
                SourceExpr=g_decStartingBalancePrincLCY;
                OnDrillDown=BEGIN
                              //TDAPCOC-119>
                              fn_DrillDown(0);
                            END;
                             }

    { 1101495041;2;Field  ;
                CaptionML=[ENU=Starting Balance Interest (LCY);
                           RUS=Начальное Сальдо Процент (ВУЧ)];
                SourceExpr=g_decStartingBalanceIntLCY;
                OnDrillDown=BEGIN
                              //TDAPCOC-119>
                              fn_DrillDown(1);
                            END;
                             }

    { 1101495042;2;Field  ;
                SourceExpr="Cust. Principal Debit Amount";
                Visible="Cust. Principal Debit Amount visible" }

    { 1101495043;2;Field  ;
                SourceExpr="Cust. Principal Credit Amount";
                Visible="Cust. Principal Credit Amount visible" }

    { 1101495044;2;Field  ;
                SourceExpr="Cust. Princ. Deb. Amount (LCY)";
                Visible="Cust. Princ. Deb. Amount (LCY) visible" }

    { 1101495045;2;Field  ;
                SourceExpr="Cust. Princ. Cr. Amount (LCY)";
                Visible="Cust. Princ. Cr. Amount (LCY) visible" }

    { 1101495046;2;Field  ;
                SourceExpr="Cust. Interest Debit Amount";
                Visible="Cust. Interest Debit Amount visible" }

    { 1101495047;2;Field  ;
                SourceExpr="Cust. Interest Credit Amount";
                Visible="Cust. Interest Credit Amount visible" }

    { 1101495048;2;Field  ;
                SourceExpr="Cust. Int. Dt. Amount (LCY)";
                Visible="Cust. Int. Dt. Amount (LCY) visible" }

    { 1101495049;2;Field  ;
                SourceExpr="Cust. Int. Cr. Amount (LCY)";
                Visible="Cust. Int. Cr. Amount (LCY) visible" }

    { 1101495050;2;Field  ;
                SourceExpr="Cust. Principal Balance";
                Visible="Cust. Principal Balance visible" }

    { 1101495051;2;Field  ;
                SourceExpr="Cust. Principal Balance (LCY)";
                Visible="Cust. Principal Balance (LCY) visible" }

    { 1101495052;2;Field  ;
                SourceExpr="Cust. Interest Balance";
                Visible="Cust. Interest Balance visible" }

    { 1101495053;2;Field  ;
                SourceExpr="Cust. Interest Balance (LCY)";
                Visible="Cust. Interest Balance (LCY) visible" }

    { 1101495054;2;Field  ;
                SourceExpr="Vendor Principal Debit Amount";
                Visible="Vendor Principal Debit Amount visible" }

    { 1101495055;2;Field  ;
                SourceExpr="Vendor Principal Credit Amount";
                Visible="Vendor Principal Credit Amount visible" }

    { 1101495056;2;Field  ;
                SourceExpr="Vend. Princ. Deb. Amount (LCY)";
                Visible="Vend. Princ. Deb. Amount (LCY) visible" }

    { 1101495057;2;Field  ;
                SourceExpr="Vend. Princ. Cr. Amount (LCY)";
                Visible="Vend. Princ. Cr. Amount (LCY) visible" }

    { 1101495058;2;Field  ;
                SourceExpr="Vendor Interest Debit Amount";
                Visible="Vendor Interest Debit Amount visible" }

    { 1101495059;2;Field  ;
                SourceExpr="Vendor Interest Credit Amount";
                Visible="Vendor Interest Credit Amount visible" }

    { 1101495060;2;Field  ;
                SourceExpr="Vend. Int. Debit Amount (LCY)";
                Visible="Vend. Int. Debit Amount (LCY) visible" }

    { 1101495061;2;Field  ;
                SourceExpr="Vend. Int. Credit Amount (LCY)";
                Visible="Vend. Int. Credit Amount (LCY) visible" }

    { 1101495062;2;Field  ;
                SourceExpr="Vendor Principal Balance";
                Visible="Vendor Principal Balance visible" }

    { 1101495063;2;Field  ;
                Name=Vendor Principal Balance (LCY);
                SourceExpr="Vendor Principal Balance (LCY)";
                Visible="Vendor Principal Balance (LCY) visible" }

    { 1101495064;2;Field  ;
                SourceExpr="Vendor Interest Balance";
                Visible="Vendor Interest Balance visible" }

    { 1101495065;2;Field  ;
                SourceExpr="Vendor Interest Balance (LCY)";
                Visible="Vendor Interest Balance (LCY) visible" }

    { 1101495066;2;Field  ;
                CaptionML=[ENU=Vendor Balance;
                           RUS=Поставщик Баланс];
                SourceExpr=g_decVendBalance;
                OnDrillDown=VAR
                              l_recDetVendLedgEntry@1101495001 : Record 380;
                              l_recVendAgr@1101495000 : Record 14901;
                            BEGIN
                              //NC NCS-1597 > USE
                              IF l_recVendAgr.GET("Source No.","Agreement No.") THEN BEGIN
                                l_recDetVendLedgEntry.RESET;
                                l_recDetVendLedgEntry.SETCURRENTKEY("Vendor No.","Agreement No.","Vendor Posting Group","Posting Date",
                                                            "Initial Entry Global Dim. 2","Initial Entry Global Dim. 1","Agreement Condition No.");
                                l_recDetVendLedgEntry.SETRANGE("Vendor No.","Source No.");
                                l_recDetVendLedgEntry.SETRANGE("Agreement No.","Agreement No.");
                                //l_recDetVendLedgEntry.SETFILTER("Posting Date",GETFILTER("Date Filter"));

                                IF COPYSTR(GETFILTER("Date Filter"),1,2) <> '..' THEN BEGIN
                                  IF GETRANGEMAX("Date Filter") <> 0D THEN
                                    l_recDetVendLedgEntry.SETRANGE("Posting Date",0D,GETRANGEMAX("Date Filter"));
                                END ELSE
                                   EXIT;


                                l_recDetVendLedgEntry.SETFILTER("Vendor Posting Group",'%1|%2',l_recVendAgr."Vendor Posting Group",
                                                                                                l_recVendAgr."Interest Posting Group");
                                l_recDetVendLedgEntry.SETFILTER("Initial Entry Global Dim. 1",GETFILTER("Global Dimension 1 Filter"));
                                l_recDetVendLedgEntry.SETFILTER("Initial Entry Global Dim. 2",GETFILTER("Global Dimension 2 Filter"));
                                l_recDetVendLedgEntry.SETFILTER("Agreement Condition No.",'%1',"Condition No.");

                                PAGE.RUN(0,l_recDetVendLedgEntry);
                              END;
                              //NC NCS-1597 < USE
                            END;
                             }

    { 1101495067;2;Field  ;
                CaptionML=[ENU=Vendor Reserve;
                           RUS=Поставщик Резерв];
                SourceExpr=g_decVendReserve;
                OnDrillDown=VAR
                              l_recDetVendLedgEntry@1101495001 : Record 380;
                              l_recVendAgr@1101495000 : Record 14901;
                            BEGIN
                              //NC NCS-1597 > USE
                              IF l_recVendAgr.GET("Source No.","Agreement No.") THEN BEGIN
                                l_recDetVendLedgEntry.RESET;
                                l_recDetVendLedgEntry.SETCURRENTKEY("Vendor No.","Agreement No.","Vendor Posting Group","Posting Date",
                                                            "Initial Entry Global Dim. 2","Initial Entry Global Dim. 1","Agreement Condition No.");
                                l_recDetVendLedgEntry.SETRANGE("Vendor No.","Source No.");
                                l_recDetVendLedgEntry.SETRANGE("Agreement No.","Agreement No.");
                                //l_recDetVendLedgEntry.SETFILTER("Posting Date",GETFILTER("Date Filter"));

                                IF COPYSTR(GETFILTER("Date Filter"),1,2) <> '..' THEN BEGIN
                                  IF GETRANGEMAX("Date Filter") <> 0D THEN
                                    l_recDetVendLedgEntry.SETRANGE("Posting Date",0D,GETRANGEMAX("Date Filter"));
                                END ELSE
                                   EXIT;


                                l_recDetVendLedgEntry.SETFILTER("Vendor Posting Group",'%1|%2',l_recVendAgr."Reserve Posting Group",
                                                                                                l_recVendAgr."Reserve % Posting Group");
                                l_recDetVendLedgEntry.SETFILTER("Initial Entry Global Dim. 1",GETFILTER("Global Dimension 1 Filter"));
                                l_recDetVendLedgEntry.SETFILTER("Initial Entry Global Dim. 2",GETFILTER("Global Dimension 2 Filter"));
                                l_recDetVendLedgEntry.SETFILTER("Agreement Condition No.",'%1',"Condition No.");

                                PAGE.RUN(0,l_recDetVendLedgEntry);
                              END;
                              //NC NCS-1597 < USE
                            END;
                             }

    { 1101495068;2;Field  ;
                CaptionML=[ENU=Customer Balance;
                           RUS=Клиент Баланс];
                SourceExpr=g_decCustBalance;
                OnDrillDown=VAR
                              l_recDetCustLedgEntry@1101495001 : Record 379;
                              l_recCustAgr@1101495000 : Record 14902;
                            BEGIN
                              //NC NCS-1597 > USE
                              IF l_recCustAgr.GET("Source No.","Agreement No.") THEN BEGIN
                                l_recDetCustLedgEntry.RESET;
                                l_recDetCustLedgEntry.SETCURRENTKEY("Customer No.","Agreement No.","Customer Posting Group","Posting Date",
                                                            "Initial Entry Global Dim. 2","Initial Entry Global Dim. 1","Agreement Condition No.");
                                l_recDetCustLedgEntry.SETRANGE("Customer No.","Source No.");
                                l_recDetCustLedgEntry.SETRANGE("Agreement No.","Agreement No.");
                                //l_recDetCustLedgEntry.SETFILTER("Posting Date",GETFILTER("Date Filter"));

                                IF COPYSTR(GETFILTER("Date Filter"),1,2) <> '..' THEN BEGIN
                                  IF GETRANGEMAX("Date Filter") <> 0D THEN
                                    l_recDetCustLedgEntry.SETRANGE("Posting Date",0D,GETRANGEMAX("Date Filter"));
                                END ELSE
                                   EXIT;

                                l_recDetCustLedgEntry.SETFILTER("Customer Posting Group",'%1|%2',l_recCustAgr."Customer Posting Group",
                                                                                               l_recCustAgr."Interest Posting Group");
                                l_recDetCustLedgEntry.SETFILTER("Initial Entry Global Dim. 1",GETFILTER("Global Dimension 1 Filter"));
                                l_recDetCustLedgEntry.SETFILTER("Initial Entry Global Dim. 2",GETFILTER("Global Dimension 2 Filter"));
                                l_recDetCustLedgEntry.SETFILTER("Agreement Condition No.",'%1',"Condition No.");

                                PAGE.RUN(0,l_recDetCustLedgEntry);
                              END;
                              //NC NCS-1597 < USE
                            END;
                             }

    { 1101495069;2;Field  ;
                CaptionML=[ENU=Customer Reserve;
                           RUS=Клиент Резерв];
                SourceExpr=g_decCustReserve;
                OnDrillDown=VAR
                              l_recDetCustLedgEntry@1101495001 : Record 379;
                              l_recCustAgr@1101495000 : Record 14902;
                            BEGIN
                              //NC NCS-1597 > USE
                              IF l_recCustAgr.GET("Source No.","Agreement No.") THEN BEGIN
                                l_recDetCustLedgEntry.RESET;
                                l_recDetCustLedgEntry.SETCURRENTKEY("Customer No.","Agreement No.","Customer Posting Group","Posting Date",
                                                            "Initial Entry Global Dim. 2","Initial Entry Global Dim. 1","Agreement Condition No.");
                                l_recDetCustLedgEntry.SETRANGE("Customer No.","Source No.");
                                l_recDetCustLedgEntry.SETRANGE("Agreement No.","Agreement No.");
                                //l_recDetCustLedgEntry.SETFILTER("Posting Date",GETFILTER("Date Filter"));

                                IF COPYSTR(GETFILTER("Date Filter"),1,2) <> '..' THEN BEGIN
                                  IF GETRANGEMAX("Date Filter") <> 0D THEN
                                    l_recDetCustLedgEntry.SETRANGE("Posting Date",0D,GETRANGEMAX("Date Filter"));
                                END ELSE
                                   EXIT;

                                l_recDetCustLedgEntry.SETFILTER("Customer Posting Group",'%1|%2',l_recCustAgr."Reserve Posting Group",
                                                                                                l_recCustAgr."Reserve % Posting Group");
                                l_recDetCustLedgEntry.SETFILTER("Initial Entry Global Dim. 1",GETFILTER("Global Dimension 1 Filter"));
                                l_recDetCustLedgEntry.SETFILTER("Initial Entry Global Dim. 2",GETFILTER("Global Dimension 2 Filter"));
                                l_recDetCustLedgEntry.SETFILTER("Agreement Condition No.",'%1',"Condition No.");
                                PAGE.RUN(0,l_recDetCustLedgEntry);
                              END;
                              //NC NCS-1597 < USE
                            END;
                             }

  }
  CODE
  {
    VAR
      ">NOS-26"@1101495000 : Integer;
      CustLedgerEntry@1101495031 : Record 21;
      VendLedgerEntry@1101495030 : Record 25;
      UserSetup@1101495029 : Record 91;
      GLSetup@1101495028 : Record 98;
      DimValue@1101495027 : Record 349;
      g_recSalesSetup@1101495026 : Record 311;
      g_recPurchSetup@1101495025 : Record 312;
      g_decAgrAmount@1101495024 : Decimal;
      g_decStartingBalanceInt@1101495023 : Decimal;
      g_decStartingBalanceIntLCY@1101495022 : Decimal;
      g_decStartingBalancePrinc@1101495021 : Decimal;
      g_decStartingBalancePrincLCY@1101495020 : Decimal;
      g_codeProject@1101495019 : Code[20];
      g_codeAgrGroup@1101495018 : Code[20];
      g_codeBorrower@1101495017 : Code[30];
      g_codeAgrCurrCode@1101495016 : Code[10];
      g_codeLender@1101495015 : Code[30];
      SourceNo@1101495014 : Code[20];
      g_txtAgrDescr@1101495013 : Text[250];
      g_txtLender@1101495012 : Text[50];
      g_dateAgr@1101495011 : Date;
      g_dateExpireAgr@1101495010 : Date;
      SourceType@1101495009 : ' ,Customer,Vendor';
      GLPeriodLength@1101495008 : 'Day,Week,Month,Quarter,Year,Accounting Period';
      FormEditable@1101495007 : Boolean;
      g_boolShowLCY@1101495006 : Boolean;
      g_txtBorrower@1101495005 : Text[50];
      g_decCustReserve@1101495004 : Decimal;
      g_decVendReserve@1101495003 : Decimal;
      g_decCustBalance@1101495002 : Decimal;
      g_decVendBalance@1101495001 : Decimal;
      DateFilter@1101495032 : Text[30];
      "Cust. Principal Balance VISIBLE"@1101495033 : Boolean;
      "Cust. Principal Balance (LCY) VISIBLE"@1101495034 : Boolean;
      "Cust. Interest Balance VISIBLE"@1101495035 : Boolean;
      "Cust. Interest Balance (LCY) VISIBLE"@1101495036 : Boolean;
      "Cust. Principal Debit Amount VISIBLE"@1101495037 : Boolean;
      "Cust. Principal Credit Amount VISIBLE"@1101495038 : Boolean;
      "Cust. Princ. Deb. Amount (LCY) VISIBLE"@1101495039 : Boolean;
      "Cust. Princ. Cr. Amount (LCY) VISIBLE"@1101495040 : Boolean;
      "Cust. Interest Debit Amount VISIBLE"@1101495041 : Boolean;
      "Cust. Interest Credit Amount VISIBLE"@1101495042 : Boolean;
      "Cust. Int. Dt. Amount (LCY) VISIBLE"@1101495044 : Boolean;
      "Cust. Int. Cr. Amount (LCY) VISIBLE"@1101495043 : Boolean;
      "Vendor Principal Balance VISIBLE"@1101495045 : Boolean;
      "Vendor Principal Balance (LCY) VISIBLE"@1101495046 : Boolean;
      "Vendor Interest Balance VISIBLE"@1101495047 : Boolean;
      "Vendor Interest Balance (LCY) VISIBLE"@1101495048 : Boolean;
      "Vendor Principal Debit Amount VISIBLE"@1101495049 : Boolean;
      "Vendor Principal Credit Amount VISIBLE"@1101495050 : Boolean;
      "Vend. Princ. Deb. Amount (LCY) VISIBLE"@1101495051 : Boolean;
      "Vend. Princ. Cr. Amount (LCY) VISIBLE"@1101495052 : Boolean;
      "Vendor Interest Debit Amount VISIBLE"@1101495053 : Boolean;
      "Vendor Interest Credit Amount VISIBLE"@1101495054 : Boolean;
      "Vend. Int. Dt. Amount (LCY) VISIBLE"@1101495055 : Boolean;
      "Vend. Int. Cr. Amount (LCY) VISIBLE"@1101495056 : Boolean;
      "Vend. Int. Debit Amount (LCY) VISIBLE"@1101495057 : Boolean;
      "Vend. Int. Credit Amount (LCY) VISIBLE"@1101495058 : Boolean;
      "Vendor Balance VISIBLE"@1101495059 : Boolean;
      "Vendor Reserve VISIBLE"@1101495060 : Boolean;
      "Customer Balance VISIBLE"@1101495061 : Boolean;
      "Customer Reserve VISIBLE"@1101495062 : Boolean;
      GlobalDimension1Filter@1101495063 : Text;
      GlobalDimension2Filter@1101495064 : Text;

    LOCAL PROCEDURE ">>>NOS-26"@1101495001();
    BEGIN
    END;

    LOCAL PROCEDURE FindPeriod@1(SearchText@1210000 : Code[10]);
    VAR
      Calendar@1210001 : Record 2000000007;
      AccountingPeriod@1210002 : Record 50;
      PeriodFormManagement@1210003 : Codeunit 359;
    BEGIN
      IF GETFILTER("Date Filter") <> '' THEN BEGIN
        Calendar.SETFILTER("Period Start",GETFILTER("Date Filter"));
        IF NOT PeriodFormManagement.FindDate('+',Calendar,GLPeriodLength) THEN
          PeriodFormManagement.FindDate('+',Calendar,GLPeriodLength::Day);
        Calendar.SETRANGE("Period Start");
      END;
      PeriodFormManagement.FindDate(SearchText,Calendar,GLPeriodLength);
      IF Calendar."Period Start" = Calendar."Period End" THEN
        SETRANGE("Date Filter",Calendar."Period Start")
      ELSE
        SETRANGE("Date Filter",Calendar."Period Start",Calendar."Period End");
      DateFilter := GETFILTER("Date Filter"); // NC NOS-26 SPA
    END;

    LOCAL PROCEDURE FindUserPeriod@3(SearchText@1210000 : Code[10]);
    VAR
      Calendar@1210001 : Record 2000000007;
      "Accounting Period"@1210002 : Record 50;
      PeriodFormManagement@1210003 : Codeunit 359;
    BEGIN
      IF UserSetup.GET(USERID) THEN BEGIN
        SETRANGE("Date Filter",UserSetup."Allow Posting From",UserSetup."Allow Posting To");
        IF GETRANGEMIN("Date Filter") = GETRANGEMAX("Date Filter") THEN
          SETRANGE("Date Filter",GETRANGEMIN("Date Filter"));
      END ELSE BEGIN
        IF GETFILTER("Date Filter") <> '' THEN BEGIN
          Calendar.SETFILTER("Period Start",GETFILTER("Date Filter"));
          IF NOT PeriodFormManagement.FindDate('+',Calendar,GLPeriodLength) THEN
            PeriodFormManagement.FindDate('+',Calendar,GLPeriodLength::Day);
          Calendar.SETRANGE("Period Start");
        END;
        PeriodFormManagement.FindDate(SearchText,Calendar,GLPeriodLength);
        SETRANGE("Date Filter",Calendar."Period Start",Calendar."Period End");
        IF GETRANGEMIN("Date Filter") = GETRANGEMAX("Date Filter") THEN
          SETRANGE("Date Filter",GETRANGEMIN("Date Filter"));
      END;
      DateFilter := GETFILTER("Date Filter"); // NC NOS-26 SPA
    END;

    PROCEDURE fn_CalculateAmounts@1000000000();
    VAR
      l_recDefDimAdv@1000000001 : Record 50128;
      l_recAgrDetail@1000000004 : Record 50096;
      l_recVendAgr@1000000002 : Record 14901;
      l_recCustAgr@1000000003 : Record 14902;
      l_recVendor@1000000006 : Record 23;
      l_recCustomer@1000000007 : Record 18;
      l_codeProjectDim@1000000000 : Code[20];
      l_boolDateFilter@1000000005 : Boolean;
    BEGIN
      //TDRAAPCOC-119>
      g_codeProject := '';
      g_codeAgrGroup := '';
      g_codeLender := '';
      g_txtLender := '';
      g_codeBorrower := '';
      g_txtAgrDescr := '';
      g_dateAgr := 0D;
      g_dateExpireAgr := 0D;
      g_decAgrAmount := 0;
      g_codeAgrCurrCode := '';
      g_decStartingBalanceInt := 0;
      g_decStartingBalanceIntLCY := 0;
      g_decStartingBalancePrinc := 0;
      g_decStartingBalancePrincLCY := 0;

      //NC NCS-1597 > USE
      g_decCustReserve:=0;
      g_decVendReserve:=0;
      g_decCustBalance:=0;
      g_decVendBalance:=0;
      //NC NCS-1597 < USE

      IF (GETFILTER("Date Filter") <> '') AND (COPYSTR(GETFILTER("Date Filter"),1,2) <> '..') THEN
        IF GETRANGEMIN("Date Filter") <> 0D THEN BEGIN
          l_recAgrDetail.GET("Source Type","Source No.","Agreement No.","Condition No.");
          l_recAgrDetail.COPYFILTERS(Rec);
          l_recAgrDetail.SETRANGE("Date Filter",0D,GETRANGEMIN("Date Filter") - 1);
          l_boolDateFilter := TRUE;
        END;

      CASE "Source Type" OF
        "Source Type"::Customer:BEGIN
          l_codeProjectDim := g_recSalesSetup."Customer Project Dim. Code";
          IF l_recDefDimAdv.GET(DATABASE::"Customer Agreement","Source No.","Agreement No.",l_codeProjectDim)
            THEN g_codeProject := l_recDefDimAdv."Dimension Value Code";
          IF l_recCustAgr.GET("Source No.","Agreement No.") THEN BEGIN
            g_codeAgrGroup := l_recCustAgr."Agreement Group";
            g_txtAgrDescr := l_recCustAgr.Description;
            g_dateAgr := l_recCustAgr."Agreement Date";
            g_dateExpireAgr := l_recCustAgr."Expire Date";
            g_decAgrAmount := l_recCustAgr."Agreement Amount";
            g_codeAgrCurrCode := l_recCustAgr."Currency Code";
          END;
          g_codeLender := COMPANYNAME;
          g_txtLender :=  COMPANYNAME;
          g_codeBorrower := "Source No.";

      // TD BMN 03.07.2013 NCS-1053 >
          IF l_recCustomer.GET("Source No.") THEN
            g_txtBorrower :=  l_recCustomer.Name
          ELSE
            g_txtBorrower :=  "Source No.";
      // TD BMN 03.07.2013 NCS-1053 <

          IF l_boolDateFilter THEN BEGIN
            l_recAgrDetail.CALCFIELDS("Cust. Principal Balance","Cust. Interest Balance",
                                      "Cust. Principal Balance (LCY)","Cust. Interest Balance (LCY)");
            g_decStartingBalanceInt := "Cust. Interest Balance";
            g_decStartingBalanceIntLCY := "Cust. Interest Balance (LCY)";
            g_decStartingBalancePrinc := "Cust. Principal Balance";
            g_decStartingBalancePrincLCY := "Cust. Principal Balance (LCY)";
          END;

          //NC NCS-1597 > USE
          IF l_recCustAgr.GET("Source No.","Agreement No.") THEN BEGIN
            SETFILTER("Posting Group Filter",'%1|%2',l_recCustAgr."Reserve Posting Group",l_recCustAgr."Reserve % Posting Group");
            Rec.CALCFIELDS("Customer Balance");
            g_decCustReserve:="Customer Balance";
            //NC NCS-1597.2 > DP
            {
            SETFILTER("Posting Group Filter",'%1|%2',l_recCustAgr."Customer Posting Group",l_recCustAgr."Interest Posting Group");
            }
            SETRANGE("Posting Group Filter");
            //NC NCS-1597.2 < DP
            Rec.CALCFIELDS("Customer Balance");
            g_decCustBalance:="Customer Balance";
          END;
          //NC NCS-1597 < USE
        END;

        "Source Type"::Vendor:BEGIN
          l_codeProjectDim := g_recPurchSetup."Vendor Project Dim. Code";
          IF l_recDefDimAdv.GET(DATABASE::"Vendor Agreement","Source No.","Agreement No.",l_codeProjectDim)
            THEN g_codeProject := l_recDefDimAdv."Dimension Value Code";
          IF l_recVendAgr.GET("Source No.","Agreement No.") THEN BEGIN
            g_codeAgrGroup := l_recVendAgr."Agreement Group";
            g_txtAgrDescr := l_recVendAgr.Description;
            g_dateAgr := l_recVendAgr."Agreement Date";
            g_dateExpireAgr := l_recVendAgr."Expire Date";
            g_decAgrAmount := l_recVendAgr."Agreement Amount";
            g_codeAgrCurrCode := l_recVendAgr."Currency Code";
          END;
          g_codeLender := "Source No.";
          IF l_recVendor.GET("Source No.") THEN
            g_txtLender :=  l_recVendor.Name
          ELSE
            g_txtLender :=  "Source No.";
          g_codeBorrower := COMPANYNAME;

          g_txtBorrower := COMPANYNAME;  // TD BMN 03.07.2013 NCS-1053

          IF l_boolDateFilter THEN BEGIN
            l_recAgrDetail.CALCFIELDS("Vendor Principal Balance","Vendor Interest Balance",
                                      "Vendor Principal Balance (LCY)","Vendor Interest Balance (LCY)");
            g_decStartingBalanceInt := "Vendor Interest Balance";
            g_decStartingBalanceIntLCY := "Vendor Interest Balance (LCY)";
            g_decStartingBalancePrinc := "Vendor Principal Balance";
            g_decStartingBalancePrincLCY := "Vendor Principal Balance (LCY)";
          END;
          //NC NCS-1597 > USE
          IF l_recVendAgr.GET("Source No.","Agreement No.") THEN BEGIN
            SETFILTER("Posting Group Filter",'%1|%2',l_recVendAgr."Reserve Posting Group",l_recVendAgr."Reserve % Posting Group");
            Rec.CALCFIELDS("Vendor Balance");
            g_decVendReserve:="Vendor Balance";
            //NC NCS-1597.2 > DP
            {
            SETFILTER("Posting Group Filter",'%1|%2',l_recVendAgr."Vendor Posting Group",l_recVendAgr."Interest Posting Group");
            }
            SETRANGE("Posting Group Filter");
            //NC NCS-1597.2 < DP
            Rec.CALCFIELDS("Vendor Balance");
            g_decVendBalance:="Vendor Balance";
          END;
          //NC NCS-1597 < USE

        END;
      END;
    END;

    PROCEDURE fn_DrillDown@1000000001(p_optShow@1000000002 : 'StBalPrinc,StBalInt');
    VAR
      l_recDetCustLE@1000000000 : Record 379;
      l_recDetVendLE@1000000001 : Record 380;
    BEGIN
      //TDRAAPCOC-119>
      CASE SourceType OF
        SourceType::Customer:BEGIN
          l_recDetCustLE.SETCURRENTKEY("Customer No.","Agreement No.","Agreement Condition No.","Amount Type","Posting Date",
                                       "Initial Entry Global Dim. 1","Initial Entry Global Dim. 2");
          l_recDetCustLE.SETFILTER("Customer No.","Source No.");
          l_recDetCustLE.SETFILTER("Agreement No.","Agreement No.");
          l_recDetCustLE.SETFILTER("Agreement Condition No.",'%1',"Condition No.");
          CASE p_optShow OF
            p_optShow::StBalPrinc: BEGIN
              l_recDetCustLE.SETFILTER("Amount Type",'%1',l_recDetCustLE."Amount Type"::Principal);
              IF COPYSTR(GETFILTER("Date Filter"),1,2) <> '..' THEN BEGIN
                IF GETRANGEMIN("Date Filter") <> 0D THEN
                  l_recDetCustLE.SETRANGE("Posting Date",0D,GETRANGEMIN("Date Filter") - 1);
              END ELSE
                EXIT;
            END;
            p_optShow::StBalInt: BEGIN
              l_recDetCustLE.SETFILTER("Amount Type",'%1',l_recDetCustLE."Amount Type"::Interest);
              IF COPYSTR(GETFILTER("Date Filter"),1,2) <> '..' THEN BEGIN
                IF GETRANGEMIN("Date Filter") <> 0D THEN
                  l_recDetCustLE.SETRANGE("Posting Date",0D,GETRANGEMIN("Date Filter") - 1);
              END ELSE
                EXIT;
            END;
            ELSE
              ERROR('');
          END;
          l_recDetCustLE.SETFILTER("Initial Entry Global Dim. 1",GETFILTER("Global Dimension 1 Filter"));
          l_recDetCustLE.SETFILTER("Initial Entry Global Dim. 2",GETFILTER("Global Dimension 2 Filter"));
          PAGE.RUN(0,l_recDetCustLE);
        END;
        SourceType::Vendor:BEGIN
          l_recDetVendLE.SETCURRENTKEY("Vendor No.","Agreement No.","Agreement Condition No.","Amount Type","Posting Date",
                                       "Initial Entry Global Dim. 1","Initial Entry Global Dim. 2");
          l_recDetVendLE.SETFILTER("Vendor No.","Source No.");
          l_recDetVendLE.SETFILTER("Agreement No.","Agreement No.");
          l_recDetVendLE.SETFILTER("Agreement Condition No.",'%1',"Condition No.");
          CASE p_optShow OF
            p_optShow::StBalPrinc: BEGIN
              l_recDetVendLE.SETFILTER("Amount Type",'%1',l_recDetVendLE."Amount Type"::Principal);
              IF COPYSTR(GETFILTER("Date Filter"),1,2) <> '..' THEN BEGIN
                IF GETRANGEMIN("Date Filter") <> 0D THEN
                  l_recDetVendLE.SETRANGE("Posting Date",0D,GETRANGEMIN("Date Filter") - 1);
              END ELSE
                EXIT;
            END;
            p_optShow::StBalInt: BEGIN
              l_recDetVendLE.SETFILTER("Amount Type",'%1',l_recDetVendLE."Amount Type"::Interest);
              IF COPYSTR(GETFILTER("Date Filter"),1,2) <> '..' THEN BEGIN
                IF GETRANGEMIN("Date Filter") <> 0D THEN
                  l_recDetVendLE.SETRANGE("Posting Date",0D,GETRANGEMIN("Date Filter") - 1);
              END ELSE
                EXIT;
            END;
            ELSE
              ERROR('');
          END;
          l_recDetVendLE.SETFILTER("Initial Entry Global Dim. 1",GETFILTER("Global Dimension 1 Filter"));
          l_recDetVendLE.SETFILTER("Initial Entry Global Dim. 2",GETFILTER("Global Dimension 2 Filter"));
          PAGE.RUN(0,l_recDetVendLE);

        END;
      END;
    END;

    LOCAL PROCEDURE SourceTypeFilterOnAfterValidate@1101495002();
    BEGIN
      CASE SourceType OF
        SourceType::Customer:
        BEGIN
          "Cust. Principal Balance VISIBLE" := TRUE;
          "Cust. Principal Balance (LCY) VISIBLE" := TRUE;
          "Cust. Interest Balance VISIBLE" := TRUE;
          "Cust. Interest Balance (LCY) VISIBLE" := TRUE;
          //TDRAAPCOC-119>
          "Cust. Principal Debit Amount VISIBLE" := TRUE;
          "Cust. Principal Credit Amount VISIBLE" := TRUE;
          "Cust. Princ. Deb. Amount (LCY) VISIBLE" := TRUE;
          "Cust. Princ. Cr. Amount (LCY) VISIBLE" := TRUE;
          "Cust. Interest Debit Amount VISIBLE" := TRUE;
          "Cust. Interest Credit Amount VISIBLE" := TRUE;
          "Cust. Int. Dt. Amount (LCY) VISIBLE" := TRUE;
          "Cust. Int. Cr. Amount (LCY) VISIBLE" := TRUE;
          "Vendor Principal Debit Amount VISIBLE" := FALSE;
          "Vendor Principal Credit Amount VISIBLE" := FALSE;
          "Vend. Princ. Deb. Amount (LCY) VISIBLE" := FALSE;
          "Vend. Princ. Cr. Amount (LCY) VISIBLE" := FALSE;
          "Vendor Interest Debit Amount VISIBLE" := FALSE;
          "Vendor Interest Credit Amount VISIBLE" := FALSE;
          "Vend. Int. Debit Amount (LCY) VISIBLE" := FALSE;
          "Vend. Int. Credit Amount (LCY) VISIBLE" := FALSE;
          //TDRAAPCOC-119<
          //NC NCS-1597 > USE
          "Vendor Balance VISIBLE" := FALSE;
          "Vendor Reserve VISIBLE" := FALSE;
          "Customer Balance VISIBLE" := TRUE;
          "Customer Reserve VISIBLE" := TRUE;
          //NC NCS-1597 < USE
          "Vendor Principal Balance VISIBLE" := FALSE;
          "Vendor Principal Balance (LCY) VISIBLE" := FALSE;
          "Vendor Interest Balance VISIBLE" := FALSE;
          "Vendor Interest Balance (LCY) VISIBLE" := FALSE;
          SETRANGE("Source Type","Source Type"::Customer);
        END;
        SourceType::Vendor:
        BEGIN
          "Cust. Principal Balance VISIBLE" := FALSE;
          "Cust. Principal Balance (LCY) VISIBLE" := FALSE;
          "Cust. Interest Balance VISIBLE" := FALSE;
          "Cust. Interest Balance (LCY) VISIBLE" := FALSE;
          //TDRAAPCOC-119>
          "Cust. Principal Debit Amount VISIBLE" := FALSE;
          "Cust. Principal Credit Amount VISIBLE" := FALSE;
          "Cust. Princ. Deb. Amount (LCY) VISIBLE" := FALSE;
          "Cust. Princ. Cr. Amount (LCY) VISIBLE" := FALSE;
          "Cust. Interest Debit Amount VISIBLE" := FALSE;
          "Cust. Interest Credit Amount VISIBLE" := FALSE;
          "Cust. Int. Dt. Amount (LCY) VISIBLE" := FALSE;
          "Cust. Int. Cr. Amount (LCY) VISIBLE" := FALSE;
          "Vendor Principal Debit Amount VISIBLE" := TRUE;
          "Vendor Principal Credit Amount VISIBLE" := TRUE;
          "Vend. Princ. Deb. Amount (LCY) VISIBLE" := TRUE;
          "Vend. Princ. Cr. Amount (LCY) VISIBLE" := TRUE;
          "Vendor Interest Debit Amount VISIBLE" := TRUE;
          "Vendor Interest Credit Amount VISIBLE" := TRUE;
          "Vend. Int. Debit Amount (LCY) VISIBLE" := TRUE;
          "Vend. Int. Credit Amount (LCY) VISIBLE" := TRUE;
          //TDRAAPCOC-119<
          //NC NCS-1597 > USE
          "Vendor Balance VISIBLE" := TRUE;
          "Vendor Reserve VISIBLE" := TRUE;
          "Customer Balance VISIBLE" := FALSE;
          "Customer Reserve VISIBLE" := FALSE;
          //NC NCS-1597 < USE
          "Vendor Principal Balance VISIBLE" := TRUE;
          "Vendor Principal Balance (LCY) VISIBLE" := TRUE;
          "Vendor Interest Balance VISIBLE" := TRUE;
          "Vendor Interest Balance (LCY) VISIBLE" := TRUE;
          SETRANGE("Source Type","Source Type"::Vendor);
        END;
        SourceType::" ":
        BEGIN
          "Cust. Principal Balance VISIBLE" := TRUE;
          "Cust. Principal Balance (LCY) VISIBLE" := TRUE;
          "Cust. Interest Balance VISIBLE" := TRUE;
          "Cust. Interest Balance (LCY) VISIBLE" := TRUE;

          "Vendor Principal Balance VISIBLE" := TRUE;
          "Vendor Principal Balance (LCY) VISIBLE" := TRUE;
          "Vendor Interest Balance VISIBLE" := TRUE;
          "Vendor Interest Balance (LCY) VISIBLE" := TRUE;

          //NC NCS-1597 > USE
          "Vendor Balance VISIBLE" := FALSE;
          "Vendor Reserve VISIBLE" := FALSE;
          "Customer Balance VISIBLE" := FALSE;
          "Customer Reserve VISIBLE" := FALSE;
          //NC NCS-1597 < USE
          SETRANGE("Source Type");
        END;
      END;
      CurrPage.UPDATE;
    END;

    LOCAL PROCEDURE LookUpDimFilter@1101495000(Dim@1101495000 : Code[20];VAR Text@1101495001 : Text[250]) : Boolean;
    VAR
      DimVal@1101495003 : Record 349;
      DimValList@1101495002 : Page 560;
    BEGIN
      //NC NOS-26 > SPA
      IF Dim = '' THEN
        EXIT(FALSE);
      DimValList.LOOKUPMODE(TRUE);
      DimVal.SETRANGE("Dimension Code",Dim);
      DimValList.SETTABLEVIEW(DimVal);
      IF DimValList.RUNMODAL = ACTION::LookupOK THEN BEGIN
        DimValList.GETRECORD(DimVal);
        Text := DimValList.GetSelectionFilter;
      END;
      EXIT(TRUE);
      //NC NOS-26 < SPA
    END;

    BEGIN
    {
      NC MLN02 EB создана форма
      NC MLN05 DP Добавлен вызов формы с просмотром графика начисл. процентов
      // TDRA120830 > Modify Triggers on Control Source Type Filter
      //TDRAAPCOC-119>
        Add Control, init in fn_CalculateAmounts
        Add Function fn_CalculateAmounts
        Modify Trigger OnAfterGetRecord
        Add Function fn_DrillDown
      TD BMN 03.07.2013 NCS-1053 "Добавить колонку Заемщик Название на форму Кредиты Ведомость"
      NC NCS-1597 USE Выведены поля КЛиент Баланс, Клиент Резерв, Поставщик Баланс, Поставщие резерв,
                      Изменены триггеры OnOpenForm, CalculateAmounts, <Control1000000037>.OnAfterValidate
                      и триггеры OnDrillDown у новых полей
      NC NCS-1597 DP Изменена функция fn_CalculateAmounts
      -----
      NC NOS-26 ENK
      NC NOS-26 SPA Исправление ошибок по результатам тестирования
    }
    END.
  }
}

