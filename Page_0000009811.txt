OBJECT Page 9811 User ACS Setup
{
  OBJECT-PROPERTIES
  {
    Date=25.10.16;
    Time=12:00:00;
    Version List=NAVW110.00;
  }
  PROPERTIES
  {
    CaptionML=[ENU=User ACS Setup;
               RUS=Настройка ACS пользователя];
    InsertAllowed=No;
    DeleteAllowed=No;
    ModifyAllowed=Yes;
    SourceTable=Table2000000120;
    DataCaptionExpr="Full Name";
    PageType=Card;
    OnAfterGetRecord=BEGIN
                       NameID := IdentityManagement.GetNameIdentifier("User Security ID");
                       ACSStatus := IdentityManagement.GetACSStatus("User Security ID");
                       AuthenticationID := IdentityManagement.GetAuthenticationKey("User Security ID");
                     END;

    OnModifyRecord=BEGIN
                     IdentityManagement.SetAuthenticationKey("User Security ID",AuthenticationID);
                   END;

    ActionList=ACTIONS
    {
      { 7       ;    ;ActionContainer;
                      ActionContainerType=ActionItems }
      { 8       ;1   ;Action    ;
                      CaptionML=[ENU=Generate Auth Key;
                                 RUS=Генерировать ключ авторизации];
                      ToolTipML=[ENU=Generate an authentication key for Access Control Service authentication.;
                                 RUS=Генерация ключа проверки подлинности для проверки подлинности службы управления доступом.];
                      ApplicationArea=#Basic,#Suite;
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=Setup;
                      PromotedCategory=Process;
                      OnAction=VAR
                                 Convert@1001 : DotNet "'mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.Convert";
                                 UTF8Encoding@1002 : DotNet "'mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.Text.UTF8Encoding";
                                 CreatedGuid@1003 : Text;
                               BEGIN
                                 CreatedGuid := CREATEGUID;
                                 UTF8Encoding := UTF8Encoding.UTF8Encoding;

                                 AuthenticationID := Convert.ToBase64String(UTF8Encoding.GetBytes(CreatedGuid));

                                 IdentityManagement.SetAuthenticationKey("User Security ID",AuthenticationID);

                                 CurrPage.UPDATE;
                               END;
                                }
    }
  }
  CONTROLS
  {
    { 1   ;    ;Container ;
                Name=ACS;
                ContainerType=ContentArea }

    { 2   ;1   ;Group     ;
                Name=General;
                CaptionML=[ENU=General;
                           RUS=Общее];
                GroupType=Group }

    { 6   ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the user's name. If the user is required to present credentials when starting the client, this is the name that the user must present.;
                           RUS=Определяет имя пользователя. Если пользователю нужно указать учетные данные при запуске клиента, это имя, которое пользователь должен ввести.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr="User Name";
                Editable=FALSE }

    { 3   ;2   ;Field     ;
                CaptionML=[ENU=ACS Name ID;
                           RUS=Идентификатор имени ACS];
                ToolTipML=[ENU="Specifies the name identifier provided by the ACS security token. You cannot enter a value in this field; it is populated automatically when the user logs on for the first time..";
                           RUS="Определяет идентификатор имени, предоставляемый токеном безопасности ACS. Ввод значения в это поле невозможен; оно заполняется автоматически при первом входе пользователя."];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=NameID;
                Editable=FALSE }

    { 4   ;2   ;Field     ;
                CaptionML=[ENU=Authentication Key;
                           RUS=Ключ проверки подлинности];
                ToolTipML=[ENU=Specifies the authentication key that is generated after you choose Generate Auth Key in the User ACS Setup dialog box. After you configure your Azure deployment and your Microsoft Dynamics NAV components for ACS, send this value and the User Name value to the user, and then direct the user to provide these values when they log on to a Microsoft Dynamics NAV client.;
                           RUS=Определяет ключ проверки подлинности, который генерируется после выбора команды "Генерировать ключ авторизации" в диалоговом окне "Настройка ACS пользователя". После настройки развертывания Azure и компонентов Microsoft Dynamics NAV на использование ACS отправьте пользователю это значение и имя пользователя и сообщите ему, что эти данные нужно указать при входе в клиент Microsoft Dynamics NAV.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=AuthenticationID;
                OnValidate=BEGIN
                             IF NOT (AuthenticationID = '') THEN BEGIN
                               IF NOT IdentityManagement.ValidateAuthKeyStrength(AuthenticationID) THEN
                                 ERROR(WeakAuthKeyErr);
                             END;

                             IdentityManagement.SetAuthenticationKey("User Security ID",AuthenticationID);
                             ACSStatus := IdentityManagement.GetACSStatus("User Security ID");
                           END;
                            }

    { 5   ;2   ;Field     ;
                CaptionML=[ENU=ACS Status;
                           RUS=Статус ACS];
                ToolTipML=[ENU=Specifies the current authentication status of the user.;
                           RUS=Определяет текущий статус проверки подлинности пользователя.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=ACSStatus;
                Editable=FALSE }

  }
  CODE
  {
    VAR
      IdentityManagement@1005 : Codeunit 9801;
      NameID@1000 : Text[250] INDATASET;
      AuthenticationID@1001 : Text[80] INDATASET;
      ACSStatus@1002 : 'Disabled,Pending,Registered,Unknown';
      WeakAuthKeyErr@1003 : TextConst 'ENU=The authentication key you entered is too weak. It must be at least 8 characters long and contain both upper case and lower case letters and numbers. Choose the Generate Auth Key action to generate one for you.;RUS=Введенный ключ проверки подлинности небезопасен. Он должен быть не короче 8 символов и содержать буквы как в верхнем, так и в нижнем регистре, а также цифры. Для создания ключа можно воспользоваться функцией "Генерировать ключ проверки подлинности".';

    BEGIN
    END.
  }
}

